

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>J.U.S.T. Mirror to an Air-gapped Repository &mdash; VSI Common 0.2.2+1dev documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="J.U.S.T. Git Functions" href="just_git_functions.auto.html" />
    <link rel="prev" title="J.U.S.T. Default Run Functions" href="just_default_run_functions.auto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> VSI Common
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">J.U.S.T. Useful Simple Tasking</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../installation.html">J.U.S.T. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart_user.html">J.U.S.T. Quickstart Guide for Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html">Getting started developing with <code class="docutils literal notranslate"><span class="pre">just</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../just.auto.html">J.U.S.T.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../files.html">J.U.S.T. Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../just-tab.auto.html">Tab completion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../just_common.auto.html">Just Common Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../just_env.auto.html">Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../just_functions.auto.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../just_version.auto.html">Just Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../just_wrap.auto.html">J.U.S.T. Wrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_just.auto.html">New J.U.S.T.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../just_diff.auto.html">Updating a just environment</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">J.U.S.T. Plugins</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="docker/index.html">J.U.S.T. Docker Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="singularity/index.html">J.U.S.T. Singularity Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="container_functions.auto.html">Container Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="just_bashcov_functions.auto.html">J.U.S.T. Bash Coverage Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="just_ci_functions.auto.html">J.U.S.T. CI Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="just_default_run_functions.auto.html">J.U.S.T. Default Run Functions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">J.U.S.T. Mirror to an Air-gapped Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="just_git_functions.auto.html">J.U.S.T. Git Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="just_install_functions.auto.html">J.U.S.T. Install CI Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="just_makeself_functions.auto.html">J.U.S.T. Makeself Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="just_robodoc_functions.auto.html">J.U.S.T. Robodoc Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="just_sphinx_functions.auto.html">J.U.S.T. Sphinx Docs Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="just_test_functions.auto.html">J.U.S.T. Test Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../linux/index.html">Linux Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../windows/index.html">Windows Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tests/index.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/modules.html">vsi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docker/recipes/get-pipenv.auto.html">Get Pipenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docker/recipes/index.html">Docker recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../style.html">Contributing Style Guide</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VSI Common</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">J.U.S.T. Useful Simple Tasking</a> &raquo;</li>
        
          <li><a href="index.html">J.U.S.T. Plugins</a> &raquo;</li>
        
      <li>J.U.S.T. Mirror to an Air-gapped Repository</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/just/plugins/just_git_airgap_repo.auto.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="j-u-s-t-mirror-to-an-air-gapped-repository">
<h1>J.U.S.T. Mirror to an Air-gapped Repository<a class="headerlink" href="#j-u-s-t-mirror-to-an-air-gapped-repository" title="Permalink to this headline">¶</a></h1>
<dl class="bash file">
<dt id="file-just_git_airgap_repo.bsh">
<code class="sig-name descname">just_git_airgap_repo.bsh</code><a class="headerlink" href="#file-just_git_airgap_repo.bsh" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>While creating a git mirror is as simple as <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">--mirror</span></code>, unfortunately this command does not support git submodules or lfs. These functions help in creating and subsequently cloning a mirror of a project with submodules and/or git lfs.</p>
<p class="rubric">Example</p>
<p>Assume we have a project called simple_repo stored at <code class="docutils literal notranslate"><span class="pre">https://git-server.com/projectA/simple_repo.git</span></code> and vsi_common is a submodule of it.</p>
<p>This repository is recursively cloned to /src; it looks like</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/src/
  simple_repo/
    .gitmodules
    Justfile
    setup.env
    external/vsi_common/               <span class="c1"># submodule</span>
    external/vsi_common/docker/recipes <span class="c1"># sub-submodule</span>
</pre></div>
</div>
<p>Before this repository can be mirrored (which is not the same thing as a clone) and pushed to a new air-gapped git server, first, a little setup is necessary. This is because, after the air-gapped repository is (shallow) cloned, the submodules must be re-configured before they can be updated (recursively). This is handled by the <code class="docutils literal notranslate"><span class="pre">git_clone-airgap-repo</span></code> <code class="docutils literal notranslate"><span class="pre">just</span></code> target. However, this obviously cannot be called until the vsi_common submodule is itself initialized and updated. To accomplish this, a small function, <a class="reference internal" href="../../linux/git_airgap_submodule_helper.auto.html#function-git_airgap_submodule_helper.bsh git_airgap_submodule_update"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">git_airgap_submodule_helper.bsh</span> <span class="pre">git_airgap_submodule_update</span></code></a>, is orphan committed to the air-gapped repository so that it is available for this task.</p>
<p>As no <code class="docutils literal notranslate"><span class="pre">just</span></code> functions can be called yet, this function must be called in the file specified by <span class="target" id="index-0"></span><a class="reference internal" href="../just_common.auto.html#envvar-JUST_SETUP_SCRIPT"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SETUP_SCRIPT</span></code></a> (typically called setup.env). For example, the setup.env script, which typically looks like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">JUST_SETUP_SCRIPT</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>basename <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="nb">source</span> <span class="s2">&quot;</span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">/external/vsi_common/env.bsh&quot;</span>
</pre></div>
</div>
<p>would become:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">JUST_SETUP_SCRIPT</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>basename <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&quot;</span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">/external/vsi_common/env.bsh&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;&#39;just&#39; could not be loaded. Trying to setup the repository as an&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;air-gapped repository&quot;</span>
  <span class="c1"># source the contents of repo_map.env (in a bash 3.2 compatible way)</span>
  <span class="nb">source</span> /dev/stdin <span class="o">&lt;&lt;&lt;</span> <span class="se">\</span>
      <span class="s2">&quot;</span><span class="k">$(</span>git show origin/__just_git_mirror_info_file:repo_map.env <span class="m">2</span>&gt;/dev/null <span class="o">||</span> :<span class="k">)</span><span class="s2">&quot;</span>
  <span class="k">if</span> ! <span class="nb">declare</span> -Fx git_airgap_submodule_update<span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;ERROR the vsi_common submodule could not be found!&quot;</span>
    <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
  git_airgap_submodule_update external/vsi_common
<span class="k">fi</span>
<span class="nb">source</span> <span class="s2">&quot;</span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">/external/vsi_common/env.bsh&quot;</span>
</pre></div>
</div>
<p>This repository is now setup and can be mirrored and pushed to a new air-gapped git server:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">just</span> <span class="pre">git</span> <span class="pre">export-repo-guided</span></code> - This target asks a series of questions and then mirrors the repository and its submodules (recursively). In this case, there is only a single remote, <code class="docutils literal notranslate"><span class="pre">origin</span></code>, and a single branch, <code class="docutils literal notranslate"><span class="pre">master</span></code>; these are chosen automatically. We will save the the mirrored repositories to the output directory, <code class="docutils literal notranslate"><span class="pre">/mirrors</span></code>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The mirror is created from (the URL of) the remote—not directly from this clone itself.</p>
</div>
<ol class="arabic simple" start="2">
<li><p>Transfer <code class="docutils literal notranslate"><span class="pre">/mirrors/transfer_{date}.tgz</span></code> to your destination.</p></li>
<li><p>On the destination, create a directory, e.g., <code class="docutils literal notranslate"><span class="pre">/airgap</span></code>, and move the archive into it</p></li>
<li><p>Extract the archive (the archive will extract directly into this directory)</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">/airgap</span></code>, edit <code class="docutils literal notranslate"><span class="pre">repo_map.env</span></code> and set the <a class="reference internal" href="#var-just_git_airgap_repo.bsh create_repo_map JUST_GIT_AIRGAP_MIRROR_URL"><code class="xref bash bash-var docutils literal notranslate"><span class="pre">just_git_airgap_repo.bsh</span> <span class="pre">create_repo_map</span> <span class="pre">JUST_GIT_AIRGAP_MIRROR_URL</span></code></a> environment variable. For example,</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">JUST_GIT_AIRGAP_MIRROR_URL=https://git-airgap.com/projectA</span></code></p></li>
</ul>
</div></blockquote>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>If not already, initialize bare repositories on the air-gapped git server for simple_repo and its submodules. In this example, these should be located at</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">https://git-airgap.com/projectA/simple_repo.git</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">https://git-airgap.com/projectA/vsi_common.git</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">https://git-airgap.com/projectA/recipes.git</span></code></p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">setup.env</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">just</span> <span class="pre">git</span> <span class="pre">import-repo</span></code> - Push the mirrored repository and all its submodules to the new git server as defined by repo_map.env</p></li>
<li><p>Incremental updates can be pushed to the repositories using much the same process.</p></li>
</ol>
<p>A developer can then run:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://git-airgap.com/projectA/simple_repo.git</span></code> - Note: non-recursive</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">setup.env</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">just</span> <span class="pre">git</span> <span class="pre">clone-airgap-repo</span></code> - Clone submodules recursively from the new mirror</p></li>
</ol>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../../linux/git_mirror.auto.html#function-git_mirror git_mirror_main"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">git_mirror</span> <span class="pre">git_mirror_main</span></code></a>, <a class="reference internal" href="../../linux/git_mirror.auto.html#function-git_mirror git_push_main"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">git_mirror</span> <span class="pre">git_push_main</span></code></a>, and <a class="reference internal" href="../../linux/git_mirror.auto.html#function-git_mirror git_clone_main"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">git_mirror</span> <span class="pre">git_clone_main</span></code></a></p>
</div>
<p class="rubric">Bugs</p>
<p>The airgap’ed repository will not support <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">sync</span></code> because the value in the .gitmodules file has been re-configured</p>
<dl class="std envvar">
<dt id="envvar-GIT">
<code class="sig-name descname">GIT</code><a class="headerlink" href="#envvar-GIT" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Name/path of git executable</p>
<p>Instead of hard-coding “git” everywhere, use the variable <span class="target" id="index-1"></span><a class="reference internal" href="#envvar-GIT"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">GIT</span></code></a> so that when the need comes, it is easier to switch which executable gets called. Set to empty string to have any calls to git skipped.</p>
<p>All <a class="reference internal" href="#function-just_git_airgap_repo.bsh relocate_git_defaultify"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">relocate_git_defaultify</span></code></a> targets will be skipped if the value of <span class="target" id="index-2"></span><a class="reference internal" href="#envvar-GIT"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">GIT</span></code></a> is not found or empty.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using the GIT env variable in this file, do not surround it with quotes as you normally would. Although this prevents using a path to <code class="docutils literal notranslate"><span class="pre">git</span></code> with a space in it, in exchange, it may be possible (eventually) to enable a dry-run-ish capability if GIT is set to <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">git</span></code>.</p>
</div>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh log_unpushed_commits">
<code class="sig-name descname">log_unpushed_commits</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh log_unpushed_commits" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>List all unpushed commits to stdout</p>
<p>List all commits on branches/tags that have not been pushed to a remote. This is a set operation: it lists all the commits from a branch in the DAG except those reachable by a remote-tracking branch. It does not require an <em>associated</em> remote-tracking branch</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p>[<code class="docutils literal notranslate"><span class="pre">$1</span></code>] - A name of a remote to filter by; e.g., origin. If unset, then don’t filter</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">$2</span></code>] - A branch’s/tag’s name to filter by; e.g., master. If unset, then don’t filter</p></li>
</ul>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*stdout*</span></code> - Print all unpushed commits for tracking branches to stdout</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-just_git_airgap_repo.bsh log_outgoing_commits"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">log_outgoing_commits</span></code></a></p>
</div>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh get_tracking_branches">
<code class="sig-name descname">get_tracking_branches</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh get_tracking_branches" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Find remote- and corresponding local-tracking branches</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p>[<code class="docutils literal notranslate"><span class="pre">$1</span></code>] - A name of a remote to filter by; e.g., origin. If unset, then don’t filter</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">$2</span></code>] - A branch’s name to filter by; e.g., master. If unset, then don’t filter by branch name</p></li>
</ul>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">just_git_tracking_branches</span></code> - An array of local-tracking branch names</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">just_git_remote_tracking_branches</span></code> - A corresponding array of remote-tracking branch names</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">*stdout*</span></code>] - If <code class="docutils literal notranslate"><span class="pre">$2</span></code> is specified, print the respective remote-tracking branch, or the empty string if there is no tracking branch</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If any arguments are supplied, then the remote-tracking branch will be printed to <code class="docutils literal notranslate"><span class="pre">*stdout*</span></code>, otherwise, the tracking branches and corresponding remote-tracking branches will be saved to the output variables, <code class="docutils literal notranslate"><span class="pre">just_git_tracking_branches</span></code> and <code class="docutils literal notranslate"><span class="pre">just_git_remote_tracking_branches</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A branch cannot track multiple remotes.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>A branch that you create locally and then push to a remote is not configured as a local-tracking branch by default. You must use the -u flag with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code> or <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">branch</span></code>.</p></li>
<li><p>A branch cannot track multiple remotes.</p></li>
</ul>
</div>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh log_outgoing_commits">
<code class="sig-name descname">log_outgoing_commits</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh log_outgoing_commits" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>List all unpushed commits for tracking branches to stdout</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p>[<code class="docutils literal notranslate"><span class="pre">$1</span></code>] - A name of a remote to filter by; e.g., origin. If unset, then don’t filter</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">$2</span></code>] - A local-tracking branch’s name to filter by; e.g., master. If unset, then don’t filter by branch name</p></li>
</ul>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*stdout*</span></code> - Print all unpushed commits for tracking branches to stdout</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-just_git_airgap_repo.bsh log_unpushed_commits"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">log_unpushed_commits</span></code></a></p>
</div>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh convert_git_remote_http_to_git">
<code class="sig-name descname">convert_git_remote_http_to_git</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh convert_git_remote_http_to_git" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Change the remote url of a git repo to use the git&#64; syntax instead of https</p>
<p>In a git repository (or submodule), if the (last) URL of the remote is specified using the the <code class="docutils literal notranslate"><span class="pre">https://</span></code> protocol, convert it to the ssh transfer protocol (git&#64;..) to make pushing changes to a private remote server easier. Assume a very basic url format: <code class="docutils literal notranslate"><span class="pre">https://git-server.com/co/project.git</span></code> without port, query, or fragment sections. Warn if these exist. Do nothing if a pushurl is already configured</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p>[<code class="docutils literal notranslate"><span class="pre">$1</span></code>] - The name of a remote to convert. Default: origin</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This does not change a submodule’s tracked URL (i.e., the URL in the .gitmodules file) nor a submodule’s URL (i.e., .git/config:submodule), only the URL of the remote in .git/**/config (e.g., .git/modules/docker/recipes/config:remote)</p>
</div>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh is_submodule">
<code class="sig-name descname">is_submodule</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh is_submodule" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Output</dt>
<dd class="field-odd"><ul class="simple">
<li><p>Returns <code class="docutils literal notranslate"><span class="pre">0</span></code> if the PWD is in a submodule, <code class="docutils literal notranslate"><span class="pre">1</span></code> for it is not</p></li>
</ul>
</dd>
</dl>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh git_project_root_dir">
<code class="sig-name descname">git_project_root_dir</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh git_project_root_dir" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Output</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">*stdout*</span></code> - The absolute path to the root of the topmost superproject’s working tree.</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p>If the vsi_common repository is cloned (recursively) at <code class="docutils literal notranslate"><span class="pre">/src</span></code>, and then <a class="reference internal" href="#function-just_git_airgap_repo.bsh git_project_root_dir"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">git_project_root_dir</span></code></a> will output <code class="docutils literal notranslate"><span class="pre">/src/vsi_common</span></code>. This is true regardless of where in the work-tree the function is run from, including from within submodules, sub-submodules, etc.</p>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh git_project_git_dir">
<code class="sig-name descname">git_project_git_dir</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh git_project_git_dir" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Output</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">*stdout*</span></code> - The absolute path to the git directory of the topmost superproject.</p>
</dd>
</dl>
<p>If the vsi_common repository is cloned (recursively) at <code class="docutils literal notranslate"><span class="pre">/src</span></code>, and then <a class="reference internal" href="#function-just_git_airgap_repo.bsh git_project_git_dir"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">git_project_git_dir</span></code></a> will output <code class="docutils literal notranslate"><span class="pre">/src/vsi_common/.git</span></code>. This is true regardless of where in the work-tree the function is run from, including from within submodules, sub-submodules, etc.</p>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh submodule_summary">
<code class="sig-name descname">submodule_summary</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh submodule_summary" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Log the commits differing between each submodule’s tracked commit and its current working tree</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span> <span class="pre">--submodule=log</span></code>, compare the working tree of each submodule to the version committed to HEAD of the super project, and list any commits that are missing and/or now present in the submodule. For example, if an earlier commit in the submodule is checked out, there will be missing commits in the submodule according to the super project. Similarly, if a commit is made to the submodule, there will be new commits present in the submodule according to the super project. Of course, the commit graph could diverge in more complicated ways.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p>[<code class="docutils literal notranslate"><span class="pre">RECURSIVE</span></code>] - Should the submodules be iterated through recursively. Default: unset</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*stdout*</span></code> - Each submodule’s differences in terms of commits</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://git-scm.com/docs/git-diff#Documentation/git-diff.txt---submoduleltformatgt">https://git-scm.com/docs/git-diff#Documentation/git-diff.txt—submoduleltformatgt</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function iterates through each submodule in a depth-first traversal</p>
</div>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh get_submodule_displaypaths">
<code class="sig-name descname">get_submodule_displaypaths</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh get_submodule_displaypaths" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Get the displaypath to each submodule</p>
<p>Get what git refers to as the displaypath of the submodule: the relative path from the current working directory to the root of the containing repository and then to each submodule. This path is defined by the git-specified environment variable, displaypath (or prefix depending on git version).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p>[<code class="docutils literal notranslate"><span class="pre">RECURSIVE</span></code>] - Should the submodules be iterated through recursively. Default: unset</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><em>stdout</em> - The displaypath to each submodule (recursively); e.g., docker/recipes</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Submodule paths are not the same thing as submodule names.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function iterates through each submodule in the same order as <a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_urls"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_urls</span></code></a>, <a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_names"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_names</span></code></a> and <a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_toplevels"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_toplevels</span></code></a> (i.e., a depth-first traversal)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because this function uses <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">foreach</span></code>, it skips submodules that have been init’d but not updated.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_urls"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_urls</span></code></a></p>
</div>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh get_submodule_urls">
<code class="sig-name descname">get_submodule_urls</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh get_submodule_urls" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Get all submodule URLs</p>
<p>Get the (last) URL for each submodule (recursively) from its .git/**/config file (e.g., .git/modules/docker/recipes/config) for the specified remote (origin by default). Note: Since git 1.8, a remote can have multiple associated URLs (and pushurls) (see .git/config).</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p>[<code class="docutils literal notranslate"><span class="pre">$1</span></code>] - The name of a remote. Note: this same remote must exist in all submodules. Default: origin</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><p>[<code class="docutils literal notranslate"><span class="pre">RECURSIVE</span></code>] - Should the submodules be iterated through recursively. Default: unset</p>
</dd>
<dt class="field-odd">Output</dt>
<dd class="field-odd"><p><em>stdout</em> - The URL of each submodule (recursively); e.g., <a class="reference external" href="https://github.com/VisionSystemsInc/docker_recipes.git">https://github.com/VisionSystemsInc/docker_recipes.git</a></p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The ultimate source-of-truth of a submodule’s URL is in its .gitmodules file. If the URL is updated in this file, then the repository’s and submodule’s configurations will be out-of-date. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">sync</span></code> will update these configurations using the .gitmodules file and the default remote of the current branch, if set; otherwise origin. <a class="reference internal" href="#function-just_git_airgap_repo.bsh git_sync_submodules"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">git_sync_submodules</span></code></a> will do the same but using the specified remote.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function iterates through each submodule in the same order as <a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_displaypaths"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_displaypaths</span></code></a>, <a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_names"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_names</span></code></a> and <a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_toplevels"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_toplevels</span></code></a> (i.e., a depth-first traversal)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because this function uses <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">foreach</span></code>, it skips submodules that have been init’d but not updated. Cf. <a class="reference internal" href="../../linux/git_mirror.auto.html#function-git_mirror get_config_submodule_names"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">git_mirror</span> <span class="pre">get_config_submodule_names</span></code></a>, which will (non-recursively) list submodules that have only been init’d. The associated URL can then be queried for a given submodule name with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">--get</span> <span class="pre">submodule.&lt;name&gt;.url</span></code> as <a class="reference internal" href="../../linux/git_mirror.auto.html#function-git_mirror clone_submodules"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">git_mirror</span> <span class="pre">clone_submodules</span></code></a> does.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_displaypaths"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_displaypaths</span></code></a></p>
</div>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh get_submodule_names">
<code class="sig-name descname">get_submodule_names</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh get_submodule_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Get the name of each submodule</p>
<p>Get the name of the submodule as defined in the .gitmodules file. This name is, by default, the same as the path to the submodule; however, this is not necessarily the case.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p>[<code class="docutils literal notranslate"><span class="pre">RECURSIVE</span></code>] - Should the submodules be iterated through recursively. Default: unset</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><em>stdout</em> - The name of each submodule (recursively); e.g., docker/recipes</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Submodule names are not the same thing as submodule paths.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function iterates through each submodule in the same order as <a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_displaypaths"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_displaypaths</span></code></a>, <a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_urls"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_urls</span></code></a> and <a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_toplevels"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_toplevels</span></code></a> (i.e., a depth-first traversal)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because this function uses <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">foreach</span></code>, it skips submodules that have been init’d but not updated. Cf. <a class="reference internal" href="../../linux/git_mirror.auto.html#function-git_mirror get_config_submodule_names"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">git_mirror</span> <span class="pre">get_config_submodule_names</span></code></a> (it queries the current repository’s submodule names from its configuration), which will list submodules that have been init’d but not updated, and <a class="reference internal" href="just_git_functions.auto.html#function-just_git_functions.bsh submodule-helper-list"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_git_functions.bsh</span> <span class="pre">submodule-helper-list</span></code></a>, which will list all submodules, even those not init’d (it queries the current repository’s submodule names and paths from the .gitmodules file). Although these functions are not recursive, they both are used to recurse manually through all the submodules (albeit, in a different order than this function).</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_toplevels"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_toplevels</span></code></a></p>
</div>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh get_submodule_toplevels">
<code class="sig-name descname">get_submodule_toplevels</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh get_submodule_toplevels" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Get the path to the top-level directory of each submodule</p>
<p>Get the path to what git refers to as the top-level directory of the submodule; i.e., the absolute path to the top-level of the immediate superproject. For example, the vsi_common repository has a submodule at <code class="docutils literal notranslate"><span class="pre">docker/recipes</span></code>. If the repository is cloned in <code class="docutils literal notranslate"><span class="pre">/src</span></code>, then the top-level directory for the submodule docker/recipes is <code class="docutils literal notranslate"><span class="pre">/src/vsi_common</span></code>.</p>
<p>This function, along with <a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_names"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_names</span></code></a>, could be used to, for example, cd to the top-level of each immediate superproject and then query the repository’s submodule configuration using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">submodule.&lt;name&gt;.&lt;key&gt;</span></code>; e.g., <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">submodule.docker/recipes.url</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p>[<code class="docutils literal notranslate"><span class="pre">RECURSIVE</span></code>] - Should the submodules be iterated through recursively. Default: unset</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><em>stdout</em> - The top-level directory of each submodule (recursively); e.g., /src/vsi_common</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function iterates through each submodule in the same order as <a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_displaypaths"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_displaypaths</span></code></a>, <a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_urls"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_urls</span></code></a> and <a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_names"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_names</span></code></a> (i.e., a depth-first traversal)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because this function uses <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">foreach</span></code>, it skips submodules that have been init’d but not updated.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-just_git_airgap_repo.bsh get_submodule_names"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_submodule_names</span></code></a></p>
</div>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh create_repo_map">
<code class="sig-name descname">create_repo_map</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh create_repo_map" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Create the contents of the repo_map.env file</p>
<p>Create the repository mapping such that, once the <a class="reference internal" href="#var-just_git_airgap_repo.bsh create_repo_map JUST_GIT_AIRGAP_MIRROR_URL"><code class="xref bash bash-var docutils literal notranslate"><span class="pre">JUST_GIT_AIRGAP_MIRROR_URL</span></code></a> variable is defined, it can be sourced by <a class="reference internal" href="../../linux/git_mirror.auto.html#function-git_mirror git_push_main"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">git_mirror</span> <span class="pre">git_push_main</span></code></a> and <a class="reference internal" href="../../linux/git_mirror.auto.html#function-git_mirror git_clone_main"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">git_mirror</span> <span class="pre">git_clone_main</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Argument</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - The project’s repository name (e.g., vsi_common)</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><p>[<code class="docutils literal notranslate"><span class="pre">ASSOCIATIVE_REPO_MAP</span></code>] - Set to a value to create the repo map as an associative-array, <code class="docutils literal notranslate"><span class="pre">repos</span></code>, as opposed to two partitioned arrays (which is bash 3.2 compatible): <code class="docutils literal notranslate"><span class="pre">repo_urls</span></code> and <code class="docutils literal notranslate"><span class="pre">repo_paths</span></code>. (Default: unset; i.e., partitioned)</p>
</dd>
<dt class="field-odd">Output</dt>
<dd class="field-odd"><p><em>stdout</em> - The contents of the repo_map.env file. For example,</p>
</dd>
</dl>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># The urls are specified with the variable JUST_GIT_AIRGAP_MIRROR_URL,</span>
<span class="c1"># which must be set to the mirrored repositories&#39; new location on the</span>
<span class="c1"># air-gapped git server. Delay setting this variable until the archive has</span>
<span class="c1"># been moved to the destination in case the information must be controlled</span>
<span class="nv">JUST_GIT_AIRGAP_MIRROR_URL</span><span class="o">=</span>

<span class="nv">repo_paths</span><span class="o">=(</span>
  ./
  ./docker/recipes
<span class="o">)</span>
<span class="nv">repo_urls</span><span class="o">=(</span>
  <span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_GIT_AIRGAP_MIRROR_URL</span><span class="si">}</span><span class="s2">/vsi_common.git&quot;</span>
  <span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_GIT_AIRGAP_MIRROR_URL</span><span class="si">}</span><span class="s2">/recipes.git&quot;</span>
<span class="o">)</span>
</pre></div>
</div>
<p>If, for example, <a class="reference internal" href="#var-just_git_airgap_repo.bsh create_repo_map JUST_GIT_AIRGAP_MIRROR_URL"><code class="xref bash bash-var docutils literal notranslate"><span class="pre">JUST_GIT_AIRGAP_MIRROR_URL</span></code></a> was set to <code class="docutils literal notranslate"><span class="pre">https://git-server/projectA</span></code>, these urls would expand to:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">https://git-server/projectA/vsi_common.git</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">https://git-server/projectA/recipes.git</span></code></p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The user can override this function if it does not suit her needs</p>
</div>
<dl class="bash var">
<dt id="var-just_git_airgap_repo.bsh create_repo_map JUST_GIT_AIRGAP_MIRROR_URL">
<code class="sig-name descname">JUST_GIT_AIRGAP_MIRROR_URL</code><a class="headerlink" href="#var-just_git_airgap_repo.bsh create_repo_map JUST_GIT_AIRGAP_MIRROR_URL" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A variable used in the repo_map.env file created by <a class="reference internal" href="#function-just_git_airgap_repo.bsh create_repo_map"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">create_repo_map</span></code></a> to specify the mirrored repositories’ new location on the air-gapped git server</p>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh orphan_commit_repo_map">
<code class="sig-name descname">orphan_commit_repo_map</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh orphan_commit_repo_map" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Orphan commit the repo_map.env file</p>
<p>Given a repository mapping like the one produced by <a class="reference internal" href="#function-just_git_airgap_repo.bsh create_repo_map"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">create_repo_map</span></code></a>, make an orphan commit in the repository (on a branch named __just_git_mirror_info_file by default) to a file named repo_map.env.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - The contents of the repo_map.env file; i.e., the file that maps between the submodule’s path and its new URL</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">$2</span></code>] - The name of the branch on which to make the orphan commit. Default: __just_git_mirror_info_file</p></li>
</ul>
</dd>
</dl>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh add_import-repo_just_project">
<code class="sig-name descname">add_import-repo_just_project</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh add_import-repo_just_project" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Create a simple just project in the prep_dir</p>
<p>This function creates a simple just project (a README.md, setup.env, and Justfile that includes this plugin) in the air-gapped mirror cache (the prep_dir) created by the <code class="docutils literal notranslate"><span class="pre">git_export-repo</span></code> <code class="docutils literal notranslate"><span class="pre">just</span></code> target. This just project can be used to push (aka import) the mirrored repositories to their respective air-gapped git server by using the <code class="docutils literal notranslate"><span class="pre">git_import-repo</span></code> <code class="docutils literal notranslate"><span class="pre">just</span></code> target.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - The output directory (prep_dir) that caches the mirrored repositories and archive to be transferred</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">${1}/{README.md,setup.env,Justfile}</span></code></p>
</dd>
</dl>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh submodule-helper-relative-url">
<code class="sig-name descname">submodule-helper-relative-url</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh submodule-helper-relative-url" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Essentially <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule--helper</span> <span class="pre">relative-url</span></code> (if it existed)</p>
<p>Resolve a submodule’s relative URL based on the parent URL. This function works by creating a dummy git repository and submodule and then running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">init</span></code> (which runs a process similar to <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">sync</span></code>), after which, the resolved URL can be queried with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">submodule.submod.url</span></code>. We do this to avoid modifying the existing repository’s git configuration (e.g., <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">submodule.docker/recipes.url</span></code>).</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - URL of the parent repository; e.g., <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">remote.origin.url</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$2</span></code> - A relative submodule URL—typically from the .gitmodules file; e.g., <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">-f</span> <span class="pre">.gitmodules</span> <span class="pre">submodule.docker/recipes.url</span></code></p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">$3</span></code>] - Up path: path from the submodule to the parent repository; e.g., <code class="docutils literal notranslate"><span class="pre">../../</span></code>. Must have a trailing slash. (Not strictly necessary if <code class="docutils literal notranslate"><span class="pre">$1</span></code> is an absolute path)</p></li>
</ul>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><em>stdout</em> - Resolved URL</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is essentially a bash port of the function <a class="reference external" href="https://github.com/git/git/blob/v2.16.0/builtin/submodule--helper.c#L117">relative_url()</a> (called from <a class="reference external" href="https://github.com/git/git/blob/v2.16.0/builtin/submodule--helper.c#L180">resolve_relative_url()</a>, aka <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule--helper</span> <span class="pre">resolve-relative-url</span></code>, which itself is called from <a class="reference external" href="https://github.com/git/git/blob/v2.16.0/git-submodule.sh#L1014">cmd_sync()</a>, aka <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">sync</span></code>. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule--helper</span> <span class="pre">resolve-relative-url</span></code>, which is available in git 2.9 and after, does not allow us to specify (directly) the remote URL from which to resolve a relative URL: it resolves relative URLs based on the remote URL, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">remote.${remote_name}.url</span></code>, where remote_name is the default remote of the current branch, if set; otherwise origin.</p>
</div>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh git_sync_submodules">
<code class="sig-name descname">git_sync_submodules</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh git_sync_submodules" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">sync</span></code> but using a specific remote (<code class="docutils literal notranslate"><span class="pre">just_upstream</span></code> by default)</p>
<p>Like <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">sync</span></code>, synchronize the configured URL of each submodule in a repository (recursively) to the value specified in .gitmodules; however, instead of overwriting the default remote (origin), update the remote specified by JUST_GIT_UPSTREAM (<code class="docutils literal notranslate"><span class="pre">just_upstream</span></code> by default).</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p>[<code class="docutils literal notranslate"><span class="pre">$1</span></code>] - The project-repository’s remote. Default: origin</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><ul class="simple">
<li><p>[<code class="docutils literal notranslate"><span class="pre">JUST_GIT_UPSTREAM</span></code>] - The submodules’ remote to sync. When updating the URL in the submodules’ configuration, use this remote. Default: <code class="docutils literal notranslate"><span class="pre">just_upstream</span></code></p></li>
</ul>
</dd>
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p>[<code class="docutils literal notranslate"><span class="pre">RECURSIVE</span></code>] - Should the submodules be iterated through recursively. Default: unset</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Creates the just_upstream remote just like, and using the same procedure as, <a class="reference internal" href="just_git_functions.auto.html#function-just_git_functions.bsh safe_git_submodule_update"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_git_functions.bsh</span> <span class="pre">safe_git_submodule_update</span></code></a>; however, importantly, it does not try to update the submodule to the expected SHA.</p>
</div>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh check_submodules_are_pushed_recursively">
<code class="sig-name descname">check_submodules_are_pushed_recursively</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh check_submodules_are_pushed_recursively" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Ensure all submodules have pushed the necessary changes to their public repo</p>
<p>Check each submodule (recursively) to see if the SHA tracked by its parent repository has been pushed to the URL tracked by the parent repository (per its .gitmodules file). Must be run from the root of a repository.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p>[<code class="docutils literal notranslate"><span class="pre">JUST_GIT_UPSTREAM</span></code>] - The submodule’s remote to sync. When fetching, use this remote’s URL. Default: <code class="docutils literal notranslate"><span class="pre">just_upstream</span></code></p></li>
</ul>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p>Return 0 if, for each submodule (recursively), the changes tracked by the parent repository have been made public; otherwise, return 1</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Creates a JUST_GIT_UPSTREAM remote. See <a class="reference internal" href="#function-just_git_airgap_repo.bsh git_sync_submodules"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">git_sync_submodules</span></code></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Cf. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">--recurse-submodules=check</span></code> (available since git 1.8.0) will check for unpushed commits in a submodule for its current committed state in the parent project. However, this only seems to work if it is used with a set of outgoing commits that contains a change to a submodule. And, despite its name, it does not seem to recurse into submodules.</p>
</div>
<dl class="bash function">
<dt id="function-just_git_airgap_repo.bsh relocate_git_defaultify">
<code class="sig-name descname">relocate_git_defaultify</code><a class="headerlink" href="#function-just_git_airgap_repo.bsh relocate_git_defaultify" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Git relocate plugin for just</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="just_git_functions.auto.html" class="btn btn-neutral float-right" title="J.U.S.T. Git Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="just_default_run_functions.auto.html" class="btn btn-neutral float-left" title="J.U.S.T. Default Run Functions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Vision Systems, Inc

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>