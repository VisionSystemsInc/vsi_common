<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>J.U.S.T. Entrypoint &mdash; VSI Common 0.2.2+1dev documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="J.U.S.T. Entrypoint Functions" href="just_entrypoint_functions.auto.html" />
    <link rel="prev" title="J.U.S.T. Docker Functions" href="just_docker_functions.auto.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            VSI Common
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">J.U.S.T. Useful Simple Tasking</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../installation.html">J.U.S.T. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart_user.html">J.U.S.T. Quickstart Guide for Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html">Getting started developing with <code class="docutils literal notranslate"><span class="pre">just</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just.auto.html">J.U.S.T.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../files.html">J.U.S.T. Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just-tab.auto.html">Tab completion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_common.auto.html">Just Common Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_env.auto.html">Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_functions.auto.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_version.auto.html">Just Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_wrap.auto.html">J.U.S.T. Wrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../new_just.auto.html">New J.U.S.T.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_diff.auto.html">Updating a just environment</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">J.U.S.T. Plugins</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">J.U.S.T. Docker Plugin</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="docker_compose_override.auto.html">Docker Compose Override</a></li>
<li class="toctree-l4"><a class="reference internal" href="docker_functions.auto.html">Docker Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="just_docker_functions.auto.html">J.U.S.T. Docker Functions</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">J.U.S.T. Entrypoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="just_entrypoint_functions.auto.html">J.U.S.T. Entrypoint Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="just_entrypoint_user_functions.auto.html">J.U.S.T. Entrypoint User Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../singularity/index.html">J.U.S.T. Singularity Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../container_functions.auto.html">Container Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_bashcov_functions.auto.html">J.U.S.T. Bash Coverage Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_ci_functions.auto.html">J.U.S.T. CI Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_default_run_functions.auto.html">J.U.S.T. Default Run Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_git_airgap_repo.auto.html">J.U.S.T. Mirror to an Air-gapped Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_git_functions.auto.html">J.U.S.T. Git Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_install_functions.auto.html">J.U.S.T. Install CI Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_makeself_functions.auto.html">J.U.S.T. Makeself Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_robodoc_functions.auto.html">J.U.S.T. Robodoc Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_sphinx_functions.auto.html">J.U.S.T. Sphinx Docs Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_test_functions.auto.html">J.U.S.T. Test Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../linux/index.html">Linux Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../windows/index.html">Windows Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tests/index.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/modules.html">vsi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docker/recipes/get-pipenv.auto.html">Get Pipenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docker/recipes/index.html">Docker recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../style.html">Contributing Style Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">VSI Common</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">J.U.S.T. Useful Simple Tasking</a></li>
          <li class="breadcrumb-item"><a href="../index.html">J.U.S.T. Plugins</a></li>
          <li class="breadcrumb-item"><a href="index.html">J.U.S.T. Docker Plugin</a></li>
      <li class="breadcrumb-item active">J.U.S.T. Entrypoint</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/just/plugins/docker/just_entrypoint.auto.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="j-u-s-t-entrypoint">
<h1>J.U.S.T. Entrypoint<a class="headerlink" href="#j-u-s-t-entrypoint" title="Permalink to this heading"></a></h1>
<dl class="bash file">
<dt class="sig sig-object bash" id="file-just_entrypoint.sh">
<span class="sig-name descname"><span class="pre">just_entrypoint.sh</span></span><a class="headerlink" href="#file-just_entrypoint.sh" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the default entrypoint for J.U.S.T. projects. By default, the docker entrypoint runs as root, which can introduce a number of obstacles and undesired side effects. Hard coding user information into images is slow and limited. <a class="reference internal" href="#file-just_entrypoint.sh"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">just_entrypoint.sh</span></code></a> will setup everything needed to dynamically make the user inside the container have your desired ids (by default, by querying your ids on the host).</p>
</div>
<p>The entrypoint is designed to take care of 5 major problems for you</p>
<ol class="arabic simple">
<li><p>Creating a user with the right UID/GID such that</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Files created in directories (volumes) mounted from the host will have the correct permissions</p></li>
<li><p>The container, if given access to the X11 daemon, will be allowed to draw windows (e.g., display figures)</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple">
<li><p>Fix initial permissions of internal volumes</p></li>
<li><p>Workaround NFS mounts when squash root is enabled. (Does not currently support kerberos auth)</p></li>
<li><p>Remove project environment variables ending in <code class="docutils literal notranslate"><span class="pre">_DOCKER</span></code></p></li>
<li><p>Remove <code class="docutils literal notranslate"><span class="pre">//</span></code> from the beginning of environment variables to handle the mingw/cygwin expansion workaround</p></li>
</ol>
<p>Here’s a walkthrough of how the entrypoint runs:</p>
<ol class="arabic simple">
<li><p>The entrypoint starts running as <code class="docutils literal notranslate"><span class="pre">root</span></code></p></li>
<li><p>Loads the just environment for root according to <span class="target" id="index-0"></span><a class="reference internal" href="../../just_functions.auto.html#envvar-JUST_SETTINGS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SETTINGS</span></code></a>. These variables will be removed by the time the entrypoint is executed as the user below, to prevent unexpected variable corruption.</p></li>
<li><p>Any files in <span class="target" id="index-1"></span><a class="reference internal" href="#envvar-JUST_ROOT_PATCH_DIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_ROOT_PATCH_DIR</span></code></a> will be executed (in alphabetical order) if they have the execute flag set, else they are sourced.</p></li>
<li><p>Runs <a class="reference internal" href="just_entrypoint_functions.auto.html#function-just_entrypoint_functions docker_setup_user"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_functions</span> <span class="pre">docker_setup_user</span></code></a> to set up the user with the appropriate ids. This is superior to other methods that would build an image with a UID and GID embedded in it, since you do not need to rebuild the image to have it adopt a different id. Furthermore, it will capture <em>all</em> your gids by default, which allows more corner cases to work correctly.</p></li>
<li><p>In the case that nfs is used, runs <a class="reference internal" href="just_entrypoint_functions.auto.html#function-just_entrypoint_functions docker_link_mounts"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_functions</span> <span class="pre">docker_link_mounts</span></code></a> in conjunction with <a class="reference internal" href="docker_functions.auto.html#function-docker_functions.bsh Just-docker-compose"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_functions.bsh</span> <span class="pre">Just-docker-compose</span></code></a> to create symlinks where nfs mounts should appear. First, <a class="reference internal" href="docker_functions.auto.html#function-docker_functions.bsh Just-docker-compose"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_functions.bsh</span> <span class="pre">Just-docker-compose</span></code></a> will identify nfs mounts and mount the root of an nfs mount point (assuming squash_root is typically enabled) to a secondary location, and add the mount point to <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_LINKS</span></code>. Then, <a class="reference internal" href="just_entrypoint_functions.auto.html#function-just_entrypoint_functions docker_link_mounts"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_functions</span> <span class="pre">docker_link_mounts</span></code></a> uses the information encoded in <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_LINKS</span></code> to create symlinks to the nfs subdirectories in the locations they were originally supposed to be mounted.</p></li>
<li><p>Runs <a class="reference internal" href="just_entrypoint_functions.auto.html#function-just_entrypoint_functions docker_setup_data_volumes"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_functions</span> <span class="pre">docker_setup_data_volumes</span></code></a> to fix initial permission issues for internal data volumes. When an empty internal data volume is initially created by docker, the folder is owned and writable by root. This changes the folder to match the desired user’s permissions. <a class="reference internal" href="docker_functions.auto.html#function-docker_functions.bsh Just-docker-compose"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_functions.bsh</span> <span class="pre">Just-docker-compose</span></code></a> automatically determines the list of internal data volumes and passes them in as <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_INTERNAL_VOLUMES</span></code>, which it then passes into <a class="reference internal" href="just_entrypoint_functions.auto.html#function-just_entrypoint_functions docker_setup_data_volumes"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_functions</span> <span class="pre">docker_setup_data_volumes</span></code></a> as <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHOWN_DIRS</span></code> and <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHMOD_DIRS</span></code></p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHOWN_DIRS</span></code> - recursively chowns all the files in the volumes listed to match the user. This could be slow with many files, but it only executes when the volumes permissions are bad, typically only the first time the container is started. If you need to customized/disable this feature, set and pass the environment variable <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHOWN_DIRS</span></code> into the container to specify which directories to chown. This will override the default of <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_INTERNAL_VOLUMES</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHMOD_DIRS</span></code> - non-recursively chmod the directories listed to 777 so that any initial ownership issues are avoided. Can also be customized/disabled by passing a value in for <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHMOD_DIRS</span></code>, but being non-recursive, this should never have a noticeable time penalty.</p></li>
<li><p>These two features give volumes a much more desirable default behavior for non-root users.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Next, the entrypoint (and everything else from here on) is re-executed as the user that was created in <a class="reference internal" href="just_entrypoint_functions.auto.html#function-just_entrypoint_functions docker_setup_user"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_functions</span> <span class="pre">docker_setup_user</span></code></a>. If you need to give the user root privileges, the suggested method is to give <code class="docutils literal notranslate"><span class="pre">gosu</span></code> special permissions (<code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">u+s</span> <span class="pre">/usr/local/bin/gosu</span></code>) and use <code class="docutils literal notranslate"><span class="pre">gosu</span> <span class="pre">root</span> <span class="pre">{command}</span></code>. However, this is not suggested when deploying.</p></li>
<li><p>Loads the settings for the project/user according to <span class="target" id="index-2"></span><a class="reference internal" href="../../just_functions.auto.html#envvar-JUST_SETTINGS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SETTINGS</span></code></a>.</p></li>
<li><p>If <span class="target" id="index-3"></span><a class="reference internal" href="../../just_functions.auto.html#envvar-JUST_PROJECT_PREFIX"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_PROJECT_PREFIX</span></code></a> is set, runs <a class="reference internal" href="just_entrypoint_user_functions.auto.html#function-just_entrypoint_user_functions.bsh filter_docker_variables"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_user_functions.bsh</span> <span class="pre">filter_docker_variables</span></code></a> to remove project variables ending in <code class="docutils literal notranslate"><span class="pre">_DOCKER</span></code>. This can be disabled by setting <code class="docutils literal notranslate"><span class="pre">JUST_FILTER_DOCKER</span></code> to <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">//</span></code> with <cite>/</cite> in project variables if running on Windows using mingw or cygwin. Cygwin-like systems have a habit of <a class="reference external" href="http://mingw.org/wiki/Posix_path_conversion">expanding variables</a>. Extra slashes are added in project environment files using <span class="target" id="index-4"></span><a class="reference internal" href="../../just_env.auto.html#envvar-JUST_PATH_ESC"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_PATH_ESC</span></code></a>, which cygwin-like systems evaluate as a <code class="docutils literal notranslate"><span class="pre">/</span></code>, else empty. An unfortunate side effect of this is the <cite>//</cite> is still in the container. While this is usually harmless, there are cases when the extra slash in the variables cause code to crash.</p></li>
<li><p>Any files in <span class="target" id="index-5"></span><a class="reference internal" href="#envvar-JUST_USER_PATCH_DIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_USER_PATCH_DIR</span></code></a> will be executed if they have the execute flag set, else they are sourced.</p></li>
<li><p>If <span class="target" id="index-6"></span><a class="reference internal" href="../../just.auto.html#envvar-JUSTFILE"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUSTFILE</span></code></a> was passed in, this signifies to the entrypoint that an internal just call will be used. This means <code class="docutils literal notranslate"><span class="pre">just</span></code> is prepended to the command to <code class="docutils literal notranslate"><span class="pre">exec</span></code>, so you don’t have to.</p></li>
<li><p>If <span class="target" id="index-7"></span><a class="reference internal" href="../../just.auto.html#envvar-JUSTFILE"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUSTFILE</span></code></a> is not set, the command arguments are run using <code class="docutils literal notranslate"><span class="pre">exec</span></code></p></li>
</ol>
<p>The function <code class="docutils literal notranslate"><span class="pre">sudo</span></code> that calls <code class="docutils literal notranslate"><span class="pre">gosu</span></code> is also exported, for ease of use.</p>
<p>If you have your own entrypoint that you want to daisy-chain with the just entrypoint, changing the <code class="docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code> field in the docker file will allow this.</p>
<div class="highlight-dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">ENTRYPOINT</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;/usr/local/bin/tini&quot;</span>,<span class="w"> </span><span class="s2">&quot;--&quot;</span>,<span class="w"> </span><span class="s2">&quot;/usr/bin/env&quot;</span>,
<span class="w">            </span><span class="s2">&quot;bash&quot;</span>,<span class="w"> </span><span class="s2">&quot;/vsi/linux/just_files/just_entrypoint.sh&quot;</span>,
<span class="w">            </span><span class="s2">&quot;bash&quot;</span>,<span class="w"> </span><span class="s2">&quot;/my_entrypoint.sh&quot;</span><span class="o">]</span>

<span class="k">CMD</span><span class="w"> </span>some_command
</pre></div>
</div>
<p>If a project needs to customize the behavior more than is possible, the developer is encouraged to copy the original file into their project, customize it, add it to the image, and call that entrypoint instead of the one in vsi_common.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="w"> </span>-eu

:<span class="w"> </span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="p">=/vsi</span><span class="si">}</span>
:<span class="w"> </span><span class="si">${</span><span class="nv">DOCKER_USERNAME</span><span class="p">=user</span><span class="si">}</span>

:<span class="w"> </span><span class="si">${</span><span class="nv">JUST_ENTRYPOINT_LOCAL_CWD</span><span class="p">=</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}}</span>
<span class="nb">export</span><span class="w"> </span>JUST_ENTRYPOINT_LOCAL_CWD
<span class="nb">cd</span><span class="w"> </span>/

<span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/elements.bsh&quot;</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_DEBUG_ENTRYPOINT</span><span class="p">+set</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="c1"># No quotes here, so allow things like: JUST_DEBUG_ENTRYPOINT=&quot;source /foo/bar/something&quot;</span>
<span class="w">  </span><span class="si">${</span><span class="nv">JUST_DEBUG_ENTRYPOINT</span><span class="k">:-</span><span class="nv">bash</span><span class="si">}</span>
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;/.singularity.d&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;/.dockerenv&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">ALREADY_RUN_ONCE</span><span class="o">=</span><span class="m">1</span>

<span class="w">  </span><span class="c1"># Singularity specific fix. In old versions with no --nvccli, we have to use --nv and it&#39;s broken</span>
<span class="w">  </span><span class="nv">ld_dirs</span><span class="o">=(</span>/lib<span class="w"> </span>/usr/local/lib<span class="w"> </span>/usr/lib<span class="o">)</span><span class="w"> </span><span class="c1"># default from alpine, no 64</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;/etc/ld.so.cache&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>mount<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>awk<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>grep<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span><span class="nv">ldconfig_list</span><span class="o">=</span><span class="k">$(</span>ldconfig<span class="w"> </span>-p<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="c1"># Find every library mounted in /.singularity.d/libs without the words cuda, nvidia, or nv.</span>
<span class="w">    </span><span class="c1"># These are the problem .so files that should never have been mounted</span>
<span class="w">    </span><span class="nv">library_list</span><span class="o">=(</span><span class="k">$(</span>mount<span class="w"> </span><span class="p">|</span><span class="w">  </span>awk<span class="w"> </span><span class="s1">&#39;/\.singularity\.d\/libs\// &amp;&amp; !($3~/nvidia|nv|cuda/) {</span>
<span class="s1">                                    split($3, a, &quot;/&quot;);</span>
<span class="s1">                                    split(a[4], b, &quot;\\.so&quot;);</span>
<span class="s1">                                    print b[1]}&#39;</span><span class="k">)</span><span class="o">)</span>

<span class="w">    </span><span class="c1"># Find the directory names of these problem .so files</span>
<span class="w">    </span><span class="nv">ld_dirs</span><span class="o">=(</span><span class="k">$(for</span><span class="w"> </span>library<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">library_list</span><span class="p">[@]+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">library_list</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">                  </span><span class="nv">libs</span><span class="o">=(</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ldconfig_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s2">&quot;/</span><span class="si">${</span><span class="nv">library</span><span class="si">}</span><span class="s2">\.so/&quot;</span><span class="s1">&#39; { print $NF }&#39;</span><span class="k">))</span>
<span class="w">                  </span><span class="k">for</span><span class="w"> </span>lib<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">libs</span><span class="p">[@]+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">libs</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">                    </span>dirname<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">lib</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                  </span><span class="k">done</span>
<span class="w">                </span><span class="k">done</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-u<span class="o">))</span>
<span class="w">  </span><span class="k">fi</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span><span class="si">${#</span><span class="nv">ld_dirs</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="c1"># Add these directories to LD_LIBRARY_PATH to override singularity</span>
<span class="w">    </span><span class="nv">IFS</span><span class="o">=</span>:<span class="w"> </span>remove_element<span class="w"> </span>LD_LIBRARY_PATH<span class="w"> </span>/.singularity.d/libs
<span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="p">-</span><span class="si">}${</span><span class="nv">LD_LIBRARY_PATH</span><span class="p">:+:</span><span class="si">}</span><span class="k">$(</span><span class="nv">IFS</span><span class="o">=</span>:<span class="p">;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ld_dirs</span><span class="p">[*]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">:/.singularity.d/libs&quot;</span>
<span class="w">  </span><span class="k">fi</span>
<span class="k">fi</span>

<span class="k">function</span><span class="w"> </span>load_just_settings<span class="o">()</span>
<span class="o">{</span>
<span class="w">  </span><span class="nb">local</span><span class="w"> </span>JUST_SETTINGSS
<span class="w">  </span><span class="nb">local</span><span class="w"> </span>just_settings

<span class="w">  </span><span class="nv">MIFS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_SETTINGS_SEPARATOR</span><span class="p">-///</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>split_s<span class="w"> </span>JUST_SETTINGSS<span class="w"> </span><span class="si">${</span><span class="nv">JUST_SETTINGS</span><span class="p">+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_SETTINGS</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span>just_settings<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">JUST_SETTINGSS</span><span class="p">[@]+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_SETTINGSS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/just_files/just_env&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">just_settings</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">  </span><span class="k">done</span>
<span class="o">}</span>
<span class="nv">PS4</span><span class="o">=</span><span class="s1">$&#39;+\x1b[0m${BASH_SOURCE[1]+}${BASH_SOURCE[0]##*/}:${LINENO}${FUNCNAME[0]:+:${FUNCNAME[0]}()}\t&#39;</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">bash_feature_declare_global</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nb">declare</span><span class="w"> </span>-i<span class="w"> </span><span class="nv">extra_args</span><span class="o">=</span><span class="m">0</span>
<span class="w">  </span><span class="nb">declare</span><span class="w"> </span>-i<span class="w"> </span>get_args_args_used
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ALREADY_RUN_ONCE</span><span class="p">+set</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;set&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">+set</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">0</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="c1"># sh compatibility</span>
<span class="w">  </span><span class="k">fi</span>

<span class="w">  </span><span class="o">(</span>
<span class="w">    </span><span class="c1"># TODO: This will not source local.env if the src directory were on an nfs</span>
<span class="w">    </span><span class="c1"># Not sure ADDing the local files in the Dockerfile is the &quot;right&quot; solution</span>
<span class="w">    </span>load_just_settings

<span class="w">    </span><span class="c1"># Sorted: https://serverfault.com/a/122743/321910</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>patch<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_ROOT_PATCH_DIR</span><span class="p">-/usr/local/share/just/root_run_patch</span><span class="si">}</span><span class="s2">&quot;</span>/*<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-x<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">patch</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="c1"># https://www.endpoint.com/blog/2016/12/12/bash-loop-wildcards-nullglob-failglob</span>
<span class="w">            </span><span class="c1"># check -e incase glob doesn&#39;t expand</span>
<span class="w">      </span><span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">patch</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">      </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span><span class="c1"># Create the user and associated groups and handle nfs symlinks</span>
<span class="w">    </span><span class="c1"># Setup the container to be more friendly to non-root users and</span>
<span class="w">    </span><span class="c1"># add other advanced J.U.S.T. features</span>
<span class="w">    </span><span class="nv">JUST_DOCKER_ENTRYPOINT_CHOWN_DIRS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_DOCKER_ENTRYPOINT_CHOWN_DIRS</span><span class="p">-</span><span class="si">${</span><span class="nv">JUST_DOCKER_ENTRYPOINT_INTERNAL_VOLUMES</span><span class="p">-</span><span class="si">}}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">JUST_DOCKER_ENTRYPOINT_CHMOD_DIRS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_DOCKER_ENTRYPOINT_CHMOD_DIRS</span><span class="p">-</span><span class="si">${</span><span class="nv">JUST_DOCKER_ENTRYPOINT_INTERNAL_VOLUMES</span><span class="p">-</span><span class="si">}}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/usr/bin/env<span class="w"> </span>bash<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/just_files/just_entrypoint_functions&quot;</span>
<span class="w">  </span><span class="o">)</span>
<span class="w">  </span><span class="c1"># Rerun entrypoint as user now, (skipping the root part via ALREADY_RUN_ONCE)</span>
<span class="w">  </span><span class="nv">ALREADY_RUN_ONCE</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nb">exec</span><span class="w"> </span>gosu<span class="w"> </span><span class="si">${</span><span class="nv">DOCKER_USERNAME</span><span class="si">}</span><span class="w"> </span>/usr/bin/env<span class="w"> </span>bash<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="si">${</span><span class="p">@+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
<span class="k">fi</span>

<span class="k">function</span><span class="w"> </span>sudo<span class="o">()</span>
<span class="o">{</span>
<span class="w">  </span>gosu<span class="w"> </span>root<span class="w"> </span><span class="si">${</span><span class="p">@+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
<span class="o">}</span>
<span class="nb">export</span><span class="w"> </span>-f<span class="w"> </span>sudo

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUSTFILE</span><span class="p">:+set</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nv">run_just</span><span class="o">=</span><span class="m">1</span>
<span class="k">else</span>
<span class="w">  </span><span class="nv">run_just</span><span class="o">=</span><span class="m">0</span>
<span class="k">fi</span>

load_just_settings

<span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/just_files/just_entrypoint_user_functions.bsh&quot;</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_PROJECT_PREFIX</span><span class="p">+set</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="c1"># Remove duplicate ${JUST_PROJECT_PREFIX}_*_DOCKER variables</span>
<span class="w">  </span>filter_docker_variables
<span class="k">fi</span>
docker_convert_paths

<span class="k">for</span><span class="w"> </span>patch<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_USER_PATCH_DIR</span><span class="p">-/usr/local/share/just/user_run_patch</span><span class="si">}</span><span class="s2">&quot;</span>/*<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-x<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">patch</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">          </span><span class="c1"># https://www.endpoint.com/blog/2016/12/12/bash-loop-wildcards-nullglob-failglob</span>
<span class="w">          </span><span class="c1"># check -e incase glob doesn&#39;t expand</span>
<span class="w">  </span><span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">patch</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">  </span><span class="k">fi</span>
<span class="k">done</span>

<span class="nb">unset</span><span class="w"> </span>shell
<span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_ENTRYPOINT_LOCAL_CWD</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nb">unset</span><span class="w"> </span>JUST_ENTRYPOINT_LOCAL_CWD

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">run_just</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/just&quot;</span>
<span class="w">  </span>just<span class="w"> </span><span class="si">${</span><span class="p">@+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
<span class="k">else</span>
<span class="w">  </span><span class="nb">exec</span><span class="w"> </span><span class="si">${</span><span class="p">@+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
<span class="k">fi</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="index-8"></span><a class="reference internal" href="../../just_functions.auto.html#envvar-JUST_SETTINGS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SETTINGS</span></code></a> - Location of project env settings file.</p></li>
<li><p><span class="target" id="index-9"></span><a class="reference internal" href="../../../index.html#envvar-VSI_COMMON_DIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">VSI_COMMON_DIR</span></code></a> - Optional, location of VSI dir, defaults to /vsi</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DOCKER_USERNAME</span></code> - Optional, username for new user, defaults to user</p></li>
</ul>
</dd>
<dt class="field-even">Internal Use<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ALREADY_RUN_ONCE</span></code> - Tracks if entrypoint has already sudo’d to user.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_INTERNAL_VOLUMES</span></code> - Passed from <a class="reference internal" href="docker_functions.auto.html#function-docker_functions.bsh Just-docker-compose"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_functions.bsh</span> <span class="pre">Just-docker-compose</span></code></a></p></li>
</ul>
</dd>
</dl>
<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-JUST_ROOT_PATCH_DIR">
<span class="sig-name descname"><span class="pre">JUST_ROOT_PATCH_DIR</span></span><a class="headerlink" href="#envvar-JUST_ROOT_PATCH_DIR" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#file-just_entrypoint.sh"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">just_entrypoint.sh</span></code></a> will source or execute (if the execute bit is set) every file in this directory as root on container start. In singularity, this step is skipped. The default is: <code class="docutils literal notranslate"><span class="pre">/usr/local/share/just/root_run_patch</span></code>.</p>
<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-JUST_USER_PATCH_DIR">
<span class="sig-name descname"><span class="pre">JUST_USER_PATCH_DIR</span></span><a class="headerlink" href="#envvar-JUST_USER_PATCH_DIR" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#file-just_entrypoint.sh"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">just_entrypoint.sh</span></code></a> will source or execute (if the execute bit is set) every file in this directory as the user on container start. The default is: <code class="docutils literal notranslate"><span class="pre">/usr/local/share/just/user_run_patch</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The intended use of <span class="target" id="index-10"></span><a class="reference internal" href="#envvar-JUST_ROOT_PATCH_DIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_ROOT_PATCH_DIR</span></code></a> and <span class="target" id="index-11"></span><a class="reference internal" href="#envvar-JUST_USER_PATCH_DIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_USER_PATCH_DIR</span></code></a> is to add files to them from either docker recipes or in the Dockerfile. While you can mount a folder or volume to this location, that is not the intent. For example, on Windows all files may appear to have execute permissions, which may not be what you want.</p>
</div>
<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-JUST_DEBUG_ENTRYPOINT">
<span class="sig-name descname"><span class="pre">JUST_DEBUG_ENTRYPOINT</span></span><a class="headerlink" href="#envvar-JUST_DEBUG_ENTRYPOINT" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#file-just_entrypoint.sh"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">just_entrypoint.sh</span></code></a> will execute the unquoted string specified by <span class="target" id="index-12"></span><a class="reference internal" href="#envvar-JUST_DEBUG_ENTRYPOINT"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_DEBUG_ENTRYPOINT</span></code></a> at the beginning of the script for the purposes of debugging. A typical value would be <code class="docutils literal notranslate"><span class="pre">/usr/local/bin/bash</span></code>, <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">-i</span></code>, or <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">/foo/bar/something</span></code>. If set to null, it will default to running <code class="docutils literal notranslate"><span class="pre">bash</span></code>.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="just_docker_functions.auto.html" class="btn btn-neutral float-left" title="J.U.S.T. Docker Functions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="just_entrypoint_functions.auto.html" class="btn btn-neutral float-right" title="J.U.S.T. Entrypoint Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Vision Systems, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>