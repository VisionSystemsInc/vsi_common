

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>J.U.S.T. Entrypoint &mdash; VSI Common 0.0.7 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="J.U.S.T. Entrypoint Functions" href="just_entrypoint_functions.auto.html" />
    <link rel="prev" title="J.U.S.T. Docker Functions" href="just_docker_functions.auto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> VSI Common
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">J.U.S.T. Useful Simple Tasking</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../installation.html">J.U.S.T. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart_user.html">J.U.S.T. Quickstart Guide for Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html">Getting started developing with <code class="docutils literal notranslate"><span class="pre">just</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just.auto.html">J.U.S.T.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../files.html">J.U.S.T. Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just-tab.auto.html">Tab completion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_common.auto.html">Just Common Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_env.auto.html">Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_functions.auto.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_wrap.auto.html">J.U.S.T. Wrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../new_just.auto.html">New J.U.S.T.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_diff.auto.html">Updating a just environment</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">J.U.S.T. Plugins</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">J.U.S.T. Docker Plugin</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="docker_compose_override.auto.html">Docker Compose Override</a></li>
<li class="toctree-l4"><a class="reference internal" href="docker_functions.auto.html">Docker Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="just_docker_functions.auto.html">J.U.S.T. Docker Functions</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">J.U.S.T. Entrypoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="just_entrypoint_functions.auto.html">J.U.S.T. Entrypoint Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="just_entrypoint_user_functions.auto.html">J.U.S.T. Entrypoint User Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../singularity/index.html">J.U.S.T. Singularity Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../container_functions.auto.html">Container Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_bashcov_functions.auto.html">J.U.S.T. Bash Coverage Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_git_functions.auto.html">J.U.S.T. Git Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_robodoc_functions.auto.html">J.U.S.T. Robodoc Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_sphinx_functions.auto.html">J.U.S.T. Sphinx Docs Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../linux/index.html">Linux Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../windows/index.html">Windows Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tests/index.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/modules.html">vsi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docker/recipes/get-pipenv.auto.html">Get Pipenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docker/recipes/index.html">Docker recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../style.html">Contributing Style Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">VSI Common</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">J.U.S.T. Useful Simple Tasking</a> &raquo;</li>
        
          <li><a href="../index.html">J.U.S.T. Plugins</a> &raquo;</li>
        
          <li><a href="index.html">J.U.S.T. Docker Plugin</a> &raquo;</li>
        
      <li>J.U.S.T. Entrypoint</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/just/plugins/docker/just_entrypoint.auto.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="j-u-s-t-entrypoint">
<h1>J.U.S.T. Entrypoint<a class="headerlink" href="#j-u-s-t-entrypoint" title="Permalink to this headline">¶</a></h1>
<dl class="file">
<dt id="file-just_entrypoint.sh">
<code class="sig-name descname">just_entrypoint.sh</code><a class="headerlink" href="#file-just_entrypoint.sh" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the default entrypoint for J.U.S.T. projects. By default, docker entrypoint runs as root, which can introduce a number of obstacles and undesired side effects. Hard coding user information into images is slow and limited. <a class="reference internal" href="#file-just_entrypoint.sh"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">just_entrypoint.sh</span></code></a> will setup everything needed to dynamically make the user inside the container have your desired ids (by default by querying your ids on the host).</p>
</div>
<p>The entrypoint is designed to take care of 5 major problems for you</p>
<ol class="arabic simple">
<li><p>Creating a user with the right UID/GID</p></li>
<li><p>Fix NFS mounts to work with nfs mounts with squash root enabled. (Does not currently support kerberos auth)</p></li>
<li><p>Fix initial permissions of internal volumes</p></li>
<li><p>Remove project environment variables ending in <code class="docutils literal notranslate"><span class="pre">_DOCKER</span></code></p></li>
<li><p>Remove <code class="docutils literal notranslate"><span class="pre">//</span></code> from the begining of environment variables to handle the mingw/cygwin expansion workaround</p></li>
</ol>
<p>Here’s a walkthrough of how the entrypoint runs:</p>
<ol class="arabic simple">
<li><p>The entrypoint starts running as <code class="docutils literal notranslate"><span class="pre">root</span></code></p></li>
<li><p>Loads the just environment only for root according to <span class="target" id="index-0"></span><a class="reference internal" href="../../just_functions.auto.html#envvar-JUST_SETTINGS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SETTINGS</span></code></a>. These values will be removed by the time the entrypoint is executeds as the user below, to prevent unexpected variable corruption.</p></li>
<li><p>Runs <a class="reference internal" href="just_entrypoint_functions.auto.html#function-just_entrypoint_functions docker_setup_user"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_functions</span> <span class="pre">docker_setup_user</span></code></a> to set up the user with the appropriate ids. This is superior to other methods that would build an image with a UID and GID embedded in it, since you do not need to rebuild the image to have it adapt to your ids. Furthermore, it will capture all your gids by default, working correctly in more corner cases.</p></li>
<li><p>Runs <a class="reference internal" href="just_entrypoint_functions.auto.html#function-just_entrypoint_functions docker_link_mounts"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_functions</span> <span class="pre">docker_link_mounts</span></code></a> in conjuntion with <a class="reference internal" href="docker_functions.auto.html#function-docker_functions.bsh Just-docker-compose"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_functions.bsh</span> <span class="pre">Just-docker-compose</span></code></a> to create symlinks where nfs mounts should appear, in the case that nfs is used. <a class="reference internal" href="docker_functions.auto.html#function-docker_functions.bsh Just-docker-compose"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_functions.bsh</span> <span class="pre">Just-docker-compose</span></code></a> will identify nfs mounts, and mount the root of an nfs mount point in case squash_root is used and set <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_LINKS</span></code>. <a class="reference internal" href="just_entrypoint_functions.auto.html#function-just_entrypoint_functions docker_link_mounts"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_functions</span> <span class="pre">docker_link_mounts</span></code></a> uses the information encoded in <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_LINKS</span></code> to create symlink where there were originally supposed to be mounted.</p></li>
<li><p>Runs <a class="reference internal" href="just_entrypoint_functions.auto.html#function-just_entrypoint_functions docker_setup_data_volumes"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_functions</span> <span class="pre">docker_setup_data_volumes</span></code></a> to fix initial permission issues for internal data volumes. When an empty internal data is initially created by docker, the folder is owned and writeable by root. This changes it to match the desired user’s permissions. <a class="reference internal" href="docker_functions.auto.html#function-docker_functions.bsh Just-docker-compose"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_functions.bsh</span> <span class="pre">Just-docker-compose</span></code></a> automaticlly determines the list of internal data volumes and passes them in as <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_INTERNAL_VOLUMES</span></code>, which is then passes into <a class="reference internal" href="just_entrypoint_functions.auto.html#function-just_entrypoint_functions docker_setup_data_volumes"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_functions</span> <span class="pre">docker_setup_data_volumes</span></code></a> as <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHOWN_DIRS</span></code> and <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHMOD_DIRS</span></code></p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHOWN_DIRS</span></code> - recursively chowns all the files in the volumes listed to match the user. This could be slow with many files, but it only executes when the volumes permissions are bad, typically only first time the container is started. If you need to customized/disable this feature, pass the environment variable <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHOWN_DIRS</span></code> into the container, and it will override the default of using <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_INTERNAL_VOLUMES</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHMOD_DIRS</span></code> - non-recursively chmod the directories listed to 777 so that any initial ownership issues are avoided. Can also be customized/disabled by passing a value in for the <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHMOD_DIRS</span></code> line, but being non-recursive, this should never have a noticeable time penalty.</p></li>
<li><p>These two features give volumes a much more desirable default behavior for non-root users.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Next the entrypoint (and everything else from here on) is re-executed as the user that was created in <a class="reference internal" href="just_entrypoint_functions.auto.html#function-just_entrypoint_functions docker_setup_user"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_functions</span> <span class="pre">docker_setup_user</span></code></a>. If you need to give the user root privliges, the suggested method is to use <code class="docutils literal notranslate"><span class="pre">gosu</span></code>. Giving <code class="docutils literal notranslate"><span class="pre">gosu</span></code> <code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">u+s</span> <span class="pre">/usr/local/bin/gosu</span></code> permissions will accomplish this, but should not be suggested for deployment situations.</p></li>
<li><p>Loads the just environment for the user accoring to <span class="target" id="index-1"></span><a class="reference internal" href="../../just_functions.auto.html#envvar-JUST_SETTINGS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SETTINGS</span></code></a>.</p></li>
<li><p>If <span class="target" id="index-2"></span><a class="reference internal" href="../../just.auto.html#envvar-JUSTFILE"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUSTFILE</span></code></a> is set, runs <a class="reference internal" href="just_entrypoint_user_functions.auto.html#function-just_entrypoint_user_functions filter_docker_variables"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_entrypoint_user_functions</span> <span class="pre">filter_docker_variables</span></code></a> to remove project variables ending in <code class="docutils literal notranslate"><span class="pre">_DOCKER</span></code></p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">//</span></code> with <cite>/</cite> in project variables if running on windows using mingw or cygwin. Cygwin-like systems have a habit of <a class="reference external" href="http://mingw.org/wiki/Posix_path_conversion">expanding variables</a>. Extra slashes are added in project environment files using <span class="target" id="index-3"></span><a class="reference internal" href="../../just_env.auto.html#envvar-JUST_PATH_ESC"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_PATH_ESC</span></code></a>, which cygwin-like systems evaluate as a <code class="docutils literal notranslate"><span class="pre">/</span></code>, else empty. An unfortunate side effect of this is the <cite>//</cite> is still in the container. While this is usually harmeless, there are cases when the extra slash in the variables cause code to crash.</p></li>
<li><p>If <span class="target" id="index-4"></span><a class="reference internal" href="../../just.auto.html#envvar-JUSTFILE"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUSTFILE</span></code></a> was passed in, this signifies to the entrypoint that an internal just call will be used. This means <code class="docutils literal notranslate"><span class="pre">just</span></code> is prepended to the command to <code class="docutils literal notranslate"><span class="pre">exec</span></code>, so you don’t have to.</p></li>
<li><p>If <span class="target" id="index-5"></span><a class="reference internal" href="../../just.auto.html#envvar-JUSTFILE"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUSTFILE</span></code></a> is not set, the command arguments are run using <code class="docutils literal notranslate"><span class="pre">exec</span></code></p></li>
</ol>
<p>The function <code class="docutils literal notranslate"><span class="pre">sudo</span></code> that calls <code class="docutils literal notranslate"><span class="pre">gosu</span></code> is also exported, for ease of use.</p>
<p>If you have your own entrypoint point you want to daisy-chain with the just entrypoint, changing the <code class="docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code> field in the docker file will allow this</p>
<div class="highlight-dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">ENTRYPOINT</span> <span class="o">[</span><span class="s2">&quot;/usr/local/bin/tini&quot;</span>, <span class="s2">&quot;--&quot;</span>, <span class="s2">&quot;/usr/bin/env&quot;</span>,
            <span class="s2">&quot;bash&quot;</span>, <span class="s2">&quot;/vsi/linux/just_entrypoint.sh&quot;</span>,
            <span class="s2">&quot;bash&quot;</span>, <span class="s2">&quot;/my_entrypoint.sh&quot;</span><span class="o">]</span>

<span class="k">CMD</span> some_command
</pre></div>
</div>
<p>If a project needs to customize the behavior more than is possible, the developer is encouraged to copy the original file into their project, customize it, add it to the image, and that entrypoint instead of the one in vsi_common</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> -eu

: <span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="p">=/vsi</span><span class="si">}</span>
: <span class="si">${</span><span class="nv">DOCKER_USERNAME</span><span class="p">=user</span><span class="si">}</span>

<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SINGULARITY_NAME</span><span class="p">+set</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="c1"># Disable the special docker magic in singularity</span>
  <span class="nb">export</span> <span class="nv">ALREADY_RUN_ONCE</span><span class="o">=</span><span class="m">1</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">ALREADY_RUN_ONCE</span><span class="p">+set</span><span class="si">}</span><span class="s2">&quot;</span> !<span class="o">=</span> <span class="s2">&quot;set&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="c1"># create the user and associated groups and handle nfs symlinks</span>

  <span class="o">(</span>
    <span class="c1"># TODO: This will not source local.env if the src directory were on an nfs</span>
    <span class="c1"># Not sure ADDing the local files in the Dockerfile is the &quot;right&quot; solution</span>
    <span class="nb">source</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/just_env&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_SETTINGS</span><span class="p">-/dev/null</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="c1"># Setup the container to be more friendly to non-root users and</span>
    <span class="c1"># add other advanced J.U.S.T. features</span>
    <span class="nv">JUST_DOCKER_ENTRYPOINT_CHOWN_DIRS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_DOCKER_ENTRYPOINT_CHOWN_DIRS</span><span class="p">-</span><span class="si">${</span><span class="nv">JUST_DOCKER_ENTRYPOINT_INTERNAL_VOLUMES</span><span class="p">-</span><span class="si">}}</span><span class="s2">&quot;</span> <span class="se">\</span>
    <span class="nv">JUST_DOCKER_ENTRYPOINT_CHMOD_DIRS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_DOCKER_ENTRYPOINT_CHMOD_DIRS</span><span class="p">-</span><span class="si">${</span><span class="nv">JUST_DOCKER_ENTRYPOINT_INTERNAL_VOLUMES</span><span class="p">-</span><span class="si">}}</span><span class="s2">&quot;</span> <span class="se">\</span>
    /usr/bin/env bash <span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/just_entrypoint_functions&quot;</span>
  <span class="o">)</span>

  <span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">+set</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">else</span>
    <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">0</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1">#sh compatibility</span>
  <span class="k">fi</span>

  <span class="c1"># Rerun entrypoint as user now, (skipping the root part via ALREADY_RUN_ONCE)</span>
  <span class="nv">ALREADY_RUN_ONCE</span><span class="o">=</span><span class="m">1</span> <span class="nb">exec</span> gosu <span class="si">${</span><span class="nv">DOCKER_USERNAME</span><span class="si">}</span> /usr/bin/env bash <span class="s2">&quot;</span><span class="si">${</span><span class="nv">file</span><span class="si">}</span><span class="s2">&quot;</span> <span class="si">${</span><span class="p">@+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
<span class="k">fi</span>

<span class="k">function</span> sudo<span class="o">()</span>
<span class="o">{</span>
  gosu root <span class="si">${</span><span class="p">@+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
<span class="o">}</span>
<span class="nb">export</span> -f sudo

<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUSTFILE</span><span class="p">+set</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nv">run_just</span><span class="o">=</span><span class="m">1</span>
<span class="k">else</span>
  <span class="nv">run_just</span><span class="o">=</span><span class="m">0</span>
<span class="k">fi</span>

<span class="nb">source</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/just_env&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_SETTINGS</span><span class="p">-/dev/null</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nb">source</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/just_entrypoint_user_functions&quot;</span>
<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_PROJECT_PREFIX</span><span class="p">+set</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="c1"># Remove duplicate ${JUST_PROJECT_PREFIX}_*_DOCKER variables</span>
  filter_docker_variables
<span class="k">fi</span>
docker_convert_paths

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">run_just</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">exec</span> /vsi/linux/just <span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">else</span>
  <span class="nb">exec</span> <span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">fi</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="index-6"></span><a class="reference internal" href="../../just_functions.auto.html#envvar-JUST_SETTINGS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SETTINGS</span></code></a> - Location of project env settings file.</p></li>
<li><p><span class="target" id="index-7"></span><a class="reference internal" href="../../../index.html#envvar-VSI_COMMON_DIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">VSI_COMMON_DIR</span></code></a> - Optional, location of VSI dir, defaults to /vsi</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DOCKER_USERNAME</span></code> - Optional, username for new user, defaults to user</p></li>
</ul>
</dd>
<dt class="field-even">Internal Use</dt>
<dd class="field-even"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ALREADY_RUN_ONCE</span></code> - Tracks if entrypoint has already sudoed to user.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_INTERNAL_VOLUMES</span></code> - Passed from <a class="reference internal" href="docker_functions.auto.html#function-docker_functions.bsh Just-docker-compose"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_functions.bsh</span> <span class="pre">Just-docker-compose</span></code></a></p></li>
</ul>
</dd>
</dl>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="just_entrypoint_functions.auto.html" class="btn btn-neutral float-right" title="J.U.S.T. Entrypoint Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="just_docker_functions.auto.html" class="btn btn-neutral float-left" title="J.U.S.T. Docker Functions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Vision Systems, Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>