

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>J.U.S.T. Entrypoint Functions &mdash; VSI Common 0.2.2+1dev documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="J.U.S.T. Entrypoint User Functions" href="just_entrypoint_user_functions.auto.html" />
    <link rel="prev" title="J.U.S.T. Entrypoint" href="just_entrypoint.auto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> VSI Common
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">J.U.S.T. Useful Simple Tasking</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../installation.html">J.U.S.T. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart_user.html">J.U.S.T. Quickstart Guide for Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html">Getting started developing with <code class="docutils literal notranslate"><span class="pre">just</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just.auto.html">J.U.S.T.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../files.html">J.U.S.T. Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just-tab.auto.html">Tab completion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_common.auto.html">Just Common Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_env.auto.html">Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_functions.auto.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_version.auto.html">Just Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_wrap.auto.html">J.U.S.T. Wrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../new_just.auto.html">New J.U.S.T.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_diff.auto.html">Updating a just environment</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">J.U.S.T. Plugins</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">J.U.S.T. Docker Plugin</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="docker_compose_override.auto.html">Docker Compose Override</a></li>
<li class="toctree-l4"><a class="reference internal" href="docker_functions.auto.html">Docker Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="just_docker_functions.auto.html">J.U.S.T. Docker Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="just_entrypoint.auto.html">J.U.S.T. Entrypoint</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">J.U.S.T. Entrypoint Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="just_entrypoint_user_functions.auto.html">J.U.S.T. Entrypoint User Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../singularity/index.html">J.U.S.T. Singularity Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../container_functions.auto.html">Container Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_bashcov_functions.auto.html">J.U.S.T. Bash Coverage Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_ci_functions.auto.html">J.U.S.T. CI Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_default_run_functions.auto.html">J.U.S.T. Default Run Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_git_functions.auto.html">J.U.S.T. Git Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_makeself_functions.auto.html">J.U.S.T. Makeself Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_robodoc_functions.auto.html">J.U.S.T. Robodoc Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_sphinx_functions.auto.html">J.U.S.T. Sphinx Docs Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_test_functions.auto.html">J.U.S.T. Test Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../linux/index.html">Linux Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../windows/index.html">Windows Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tests/index.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/modules.html">vsi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docker/recipes/get-pipenv.auto.html">Get Pipenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docker/recipes/index.html">Docker recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../style.html">Contributing Style Guide</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">VSI Common</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">J.U.S.T. Useful Simple Tasking</a> &raquo;</li>
        
          <li><a href="../index.html">J.U.S.T. Plugins</a> &raquo;</li>
        
          <li><a href="index.html">J.U.S.T. Docker Plugin</a> &raquo;</li>
        
      <li>J.U.S.T. Entrypoint Functions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/just/plugins/docker/just_entrypoint_functions.auto.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="j-u-s-t-entrypoint-functions">
<h1>J.U.S.T. Entrypoint Functions<a class="headerlink" href="#j-u-s-t-entrypoint-functions" title="Permalink to this headline">¶</a></h1>
<dl class="bash file">
<dt id="file-just_entrypoint_functions">
<code class="sig-name descname">just_entrypoint_functions</code><a class="headerlink" href="#file-just_entrypoint_functions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Functions to help write docker entrypoints</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p>See inputs for other SEE ALSO</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p><a class="reference internal" href="#file-just_entrypoint_functions"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">just_entrypoint_functions</span></code></a></p>
<p class="rubric">Usage</p>
<p>Can also be sourced to call individual functions. By default, calling
<a class="reference internal" href="#file-just_entrypoint_functions"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">just_entrypoint_functions</span></code></a> runs
- <a class="reference internal" href="#function-just_entrypoint_functions docker_setup_user"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_setup_user</span></code></a></p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-just_entrypoint_functions docker_setup_user"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_setup_user</span></code></a></p>
</div>
<dl class="bash function">
<dt id="function-just_entrypoint_functions docker_setup_user">
<code class="sig-name descname">docker_setup_user</code><a class="headerlink" href="#function-just_entrypoint_functions docker_setup_user" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Create user/group</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_ACCOUNTS_CREATE_USER</span></code>] - Enables the adding of a new user. If the particular username already exists, it is replaced. Default: 1</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_ACCOUNTS_CREATE_GROUPS</span></code>] - Enables the adding of new groups. The first group is set as the user’s primary group. Each subsequent group is set as an additional group, and the user is added as a member of each of these groups. If a group name already exists, an incrementing number is appended until the name does not exist. If the GID already exists, it is just used again. Default: 1</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_ACCOUNTS_POSIX_GROUPS</span></code>] - Enables filtering group names removing non-posix characters. This is important for operating systems like CentOS, etc… that actually follow the posix rules, unlike Debian. If 100% of the characters are non-posix, the name is based on DOCKER_UNNAMED_GROUP_NAME. Default: 1</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_USERNAME</span></code>] - The username used to create the new user. Default: user</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_UID</span></code>] - The UID used when creating the new user. Default: 1000</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_GROUP_NAMES</span></code>] - The group name(s) used when creating the groups for the new user. IFS delimited string (default: space, tab, newline). Default: user (only the primary group)</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_GIDS</span></code>] - The corresponding GID(s) used when creating the new groups. IFS delimited string. Default: 1000</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_UNNAMED_GROUP_NAME</span></code>] - The group name used for an unnamed group. Default: group</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_HOME</span></code>] - The home directory used when creating a new user. When the new directory is created, it is owned (non-recursively) by the UID/GID. Default: /home/${<code class="docutils literal notranslate"><span class="pre">DOCKER_USERNAME</span></code>}</p></li>
</ul>
</dd>
</dl>
<dl class="bash function">
<dt id="function-just_entrypoint_functions retry_as_user">
<code class="sig-name descname">retry_as_user</code><a class="headerlink" href="#function-just_entrypoint_functions retry_as_user" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>If the command fails, retry it as <code class="docutils literal notranslate"><span class="pre">DOCKER_USERNAME</span></code></p>
<p class="rubric">Usage</p>
<p>Try to run a command as the current user (root); if that fails, run the
command as <code class="docutils literal notranslate"><span class="pre">DOCKER_USERNAME</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - The command to execute</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_USERNAME</span></code>] - The username used to create the new user. Default: user</p>
</dd>
</dl>
<dl class="bash function">
<dt id="function-just_entrypoint_functions docker_link_mounts">
<code class="sig-name descname">docker_link_mounts</code><a class="headerlink" href="#function-just_entrypoint_functions docker_link_mounts" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Create symlinks based on <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_LINKS</span></code></p>
<p>When <a class="reference internal" href="docker_compose_override.auto.html#function-docker_compose_override generate_docker_compose_override"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_compose_override</span> <span class="pre">generate_docker_compose_override</span></code></a> processes mounts, the desired mount will not be possible in some cases, e.g., on nfs file systems with squash root enabled. Instead, the root of an nfs mount point is mounted into the container in a secondary location, and a symlink is created from the subdirectory to the original mount point. This function creates these symlinks based on the // separated string <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_LINKS</span></code>. e.g., “source//destination//source//destination”.</p>
<p class="rubric">Usage</p>
<p>Automatically called when <a class="reference internal" href="#file-just_entrypoint_functions"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">just_entrypoint_functions</span></code></a> is called. If <a class="reference internal" href="#file-just_entrypoint_functions"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">just_entrypoint_functions</span></code></a> is sourced, then <a class="reference internal" href="#function-just_entrypoint_functions docker_link_mounts"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_link_mounts</span></code></a> would need to be called separately.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p>[<code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_LINKS</span></code>] - // delimited string of symlinks to create, e.g., “source//destination//source//destination”</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_LINK_MOUNTS_FORCE</span></code>] - Adds a -f to ln commands. Disabled by default. Set this flag to enable.</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_LINK_MOUNTS_NOT_IN_MOUNTS</span></code>] - Prevents making symlinks in mounted subdirectories. This is not the default docker behavior, so this feature is disabled by default. Set this flag to enable.</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_USERNAME</span></code>] - The username used to create the new user. Default: user</p></li>
</ul>
</dd>
</dl>
<dl class="bash function">
<dt id="function-just_entrypoint_functions docker_setup_data_volumes">
<code class="sig-name descname">docker_setup_data_volumes</code><a class="headerlink" href="#function-just_entrypoint_functions docker_setup_data_volumes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Change permissions of data volumes to 777</p>
<p>When <a class="reference internal" href="docker_compose_override.auto.html#function-docker_compose_override generate_docker_compose_override"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_compose_override</span> <span class="pre">generate_docker_compose_override</span></code></a> processes
mounts, it determines the list of internal data volumes, and passes them
to the container in <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHMOD_DIRS</span></code>. This function
uses that variable to set all the directories’ permissions to 777. This is
useful for when a data volume is just created and it only had root
permissions</p>
<p class="rubric">Usage</p>
<p>Automatically called when just_entrypoint_functions is called. If
<a class="reference internal" href="#file-just_entrypoint_functions"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">just_entrypoint_functions</span></code></a> is sourced, then <a class="reference internal" href="#function-just_entrypoint_functions docker_setup_data_volumes"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_setup_data_volumes</span></code></a> would need
to be called separately.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p>[<code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHMOD_DIRS</span></code>] - // delimited string of folders corresponding to data volumes e.g., “/tmp/test1///dev/shm/2”</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHOWN_DIRS</span></code>] - // delimited string of folders corresponding to folders in volumes that should be owned by <code class="docutils literal notranslate"><span class="pre">`DOCKER_UID</span></code> and <code class="docutils literal notranslate"><span class="pre">DOCKER_GIDS[0]</span></code></p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_USERNAME</span></code>] - The username used to reown <code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_ENTRYPOINT_CHOWN_DIRS</span></code>. Default: user</p></li>
</ul>
</dd>
</dl>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="just_entrypoint_user_functions.auto.html" class="btn btn-neutral float-right" title="J.U.S.T. Entrypoint User Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="just_entrypoint.auto.html" class="btn btn-neutral float-left" title="J.U.S.T. Entrypoint" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Vision Systems, Inc

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>