

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Docker Functions &mdash; VSI Common 0.2.2+1dev documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="J.U.S.T. Docker Functions" href="just_docker_functions.auto.html" />
    <link rel="prev" title="Docker Compose Override" href="docker_compose_override.auto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> VSI Common
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">J.U.S.T. Useful Simple Tasking</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../installation.html">J.U.S.T. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart_user.html">J.U.S.T. Quickstart Guide for Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html">Getting started developing with <code class="docutils literal notranslate"><span class="pre">just</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just.auto.html">J.U.S.T.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../files.html">J.U.S.T. Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just-tab.auto.html">Tab completion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_common.auto.html">Just Common Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_env.auto.html">Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_functions.auto.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_version.auto.html">Just Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_wrap.auto.html">J.U.S.T. Wrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../new_just.auto.html">New J.U.S.T.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../just_diff.auto.html">Updating a just environment</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">J.U.S.T. Plugins</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">J.U.S.T. Docker Plugin</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="docker_compose_override.auto.html">Docker Compose Override</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Docker Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="just_docker_functions.auto.html">J.U.S.T. Docker Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="just_entrypoint.auto.html">J.U.S.T. Entrypoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="just_entrypoint_functions.auto.html">J.U.S.T. Entrypoint Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="just_entrypoint_user_functions.auto.html">J.U.S.T. Entrypoint User Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../singularity/index.html">J.U.S.T. Singularity Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../container_functions.auto.html">Container Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_bashcov_functions.auto.html">J.U.S.T. Bash Coverage Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_ci_functions.auto.html">J.U.S.T. CI Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_default_run_functions.auto.html">J.U.S.T. Default Run Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_git_functions.auto.html">J.U.S.T. Git Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_install_functions.auto.html">J.U.S.T. Install CI Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_makeself_functions.auto.html">J.U.S.T. Makeself Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_robodoc_functions.auto.html">J.U.S.T. Robodoc Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_sphinx_functions.auto.html">J.U.S.T. Sphinx Docs Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../just_test_functions.auto.html">J.U.S.T. Test Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../linux/index.html">Linux Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../windows/index.html">Windows Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tests/index.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/modules.html">vsi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docker/recipes/get-pipenv.auto.html">Get Pipenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docker/recipes/index.html">Docker recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../style.html">Contributing Style Guide</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">VSI Common</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">J.U.S.T. Useful Simple Tasking</a> &raquo;</li>
        
          <li><a href="../index.html">J.U.S.T. Plugins</a> &raquo;</li>
        
          <li><a href="index.html">J.U.S.T. Docker Plugin</a> &raquo;</li>
        
      <li>Docker Functions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/just/plugins/docker/docker_functions.auto.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="docker-functions">
<h1>Docker Functions<a class="headerlink" href="#docker-functions" title="Permalink to this headline">¶</a></h1>
<dl class="bash file">
<dt id="file-docker_functions.bsh">
<code class="sig-name descname">docker_functions.bsh</code><a class="headerlink" href="#file-docker_functions.bsh" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Set of functions to make using dockers easier</p>
<dl class="std envvar">
<dt id="envvar-DOCKER">
<code class="sig-name descname">DOCKER</code><a class="headerlink" href="#envvar-DOCKER" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Name/path of docker executable</p>
<p>Instead of hard-coding “docker” everywhere, use the variable <span class="target" id="index-0"></span><a class="reference internal" href="#envvar-DOCKER"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">DOCKER</span></code></a> so that
when the need comes, it is easier to switch which executable gets called.</p>
<dl class="std envvar">
<dt id="envvar-NVIDIA_DOCKER">
<code class="sig-name descname">NVIDIA_DOCKER</code><a class="headerlink" href="#envvar-NVIDIA_DOCKER" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Name/path of nvidia-docker executable</p>
<p>Instead of hard-coding “nvidia-docker” everywhere, use the variable
<span class="target" id="index-1"></span><a class="reference internal" href="#envvar-NVIDIA_DOCKER"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">NVIDIA_DOCKER</span></code></a> so that when the need comes, it is easier to switch which
executable gets called. Default to <span class="target" id="index-2"></span><a class="reference internal" href="#envvar-DOCKER"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">DOCKER</span></code></a> if nvidia-docker executable is not
in the path (hash-able)</p>
<dl class="bash var">
<dt id="var-docker_functions.bsh DOCKER_VOLUME_PATTERN">
<code class="sig-name descname">DOCKER_VOLUME_PATTERN</code><a class="headerlink" href="#var-docker_functions.bsh DOCKER_VOLUME_PATTERN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Regex pattern for matching docker volume short form</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<dl class="simple">
<dt>Works on:</dt><dd><p>C:*, c:/* .* /* - ‘^(([a-zA-Z]:[/])?[^:]*)’</p>
</dd>
<dt>Break the volume string up into <code class="docutils literal notranslate"><span class="pre">BASH_REMATCH</span></code></dt><dd><p>1 - Host path
3 - Docker path
5 - flags</p>
</dd>
</dl>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh is_dir_and_not_exist">
<code class="sig-name descname">is_dir_and_not_exist</code><a class="headerlink" href="#function-docker_functions.bsh is_dir_and_not_exist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - String to check</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p>Returns <code class="docutils literal notranslate"><span class="pre">0</span></code> for is a directory, and <code class="docutils literal notranslate"><span class="pre">1</span></code> for not a directory (is an internal mount)</p>
</dd>
</dl>
<p>See if the string looks like a non-existing directory</p>
<p>Docker currently creates directories that do not exist when mounting. This
has a few bad side effects, such as the directories end up being own by root.
In order to work around this “bug”, this function identifies if docker will
assume a string is a directory/file or an internal mount.</p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>is_dir_and_not_exist this_looks_like_an_internal_volume
is_dir_and_not_exist ./this_looks/like_a/directory
is_dir_and_not_exist /this_also_looks/like_a/directory

<span class="k">if</span> is_dir_and_not_exist <span class="si">${</span><span class="nv">my_mount</span><span class="si">}</span><span class="p">;</span> <span class="k">then</span>
  mkdir -p <span class="si">${</span><span class="nv">my_mount</span><span class="si">}</span>
<span class="k">fi</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-docker_functions.bsh docker_sanitize_volume"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_sanitize_volume</span></code></a></p>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh is_internal_docker_volume">
<code class="sig-name descname">is_internal_docker_volume</code><a class="headerlink" href="#function-docker_functions.bsh is_internal_docker_volume" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - String to check</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p>Returns <code class="docutils literal notranslate"><span class="pre">0</span></code> if it is a volume and <code class="docutils literal notranslate"><span class="pre">1</span></code> if it is not (i.e., it is a directory or invalid)</p>
</dd>
</dl>
<p>Checks to see if the string is a valid internal docker volume (as opposed to a Linux- or Windows-style directory)</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-docker_functions.bsh is_dir_and_not_exist"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">is_dir_and_not_exist</span></code></a></p>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh is_readonly_docker_volume">
<code class="sig-name descname">is_readonly_docker_volume</code><a class="headerlink" href="#function-docker_functions.bsh is_readonly_docker_volume" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - docker volume_flags string to check</p></li>
</ul>
</dd>
<dt class="field-even">Return Value</dt>
<dd class="field-even"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> if it is readonly</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> it if is writeable (according to docker flags only)</p></li>
</ul>
</dd>
</dl>
<p>Checks to see if a volume string contains the read only attribute. Can be used both for the docker volume syntax and the docker-compose short volume syntax</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is still possible the underlying directory is not writeable; this will not check that. Used mostly for docker volumes where this is not an issue.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#function-docker_functions.bsh docker_parse_volume_string"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_parse_volume_string</span></code></a></dt><dd><p>Parses a docker volume string and generates volume_flags</p>
</dd>
</dl>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh is_readonly_docker_compose_long_volume">
<code class="sig-name descname">is_readonly_docker_compose_long_volume</code><a class="headerlink" href="#function-docker_functions.bsh is_readonly_docker_compose_long_volume" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - A DOCKER_VOLUME_FLAGS string to check (Not the whole array)</p></li>
</ul>
</dd>
<dt class="field-even">Return Value</dt>
<dd class="field-even"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> if it is readonly</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> it if is writeable (according to docker flags only)</p></li>
</ul>
</dd>
</dl>
<p>Checks to see if a volume string contains the read only attribute. Can be used both for the docker-compose long volume syntax</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is still possible the underlying directory is not writeable, this will not check that. Used mostly for docker volumes, where this is not an issue.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt>docker-compose-volumes</dt><dd><p>Parses docker-compose volumes and generates DOCKER_VOLUME_FLAGS</p>
</dd>
</dl>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh container_get_label">
<code class="sig-name descname">container_get_label</code><a class="headerlink" href="#function-docker_functions.bsh container_get_label" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Container name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$2</span></code> - Label name</p></li>
</ul>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><ul class="simple">
<li><p><cite>stdout</cite> - Prints out the label value (and evaluates environment variables)</p></li>
<li><p>Return <code class="docutils literal notranslate"><span class="pre">1</span></code> if label is blank (possibly not set), <code class="docutils literal notranslate"><span class="pre">0</span></code> for label found</p></li>
</ul>
</dd>
</dl>
<p>Get a label value from a docker container</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Requires perl be installed</p>
</div>
<p class="rubric">Bugs</p>
<p>Cannot determine the difference between blank and unset labels. See <a class="reference internal" href="#function-docker_functions.bsh container_has_label"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">container_has_label</span></code></a> to handle that ambiguity.</p>
<dl class="bash function">
<dt id="function-docker_functions.bsh container_has_label">
<code class="sig-name descname">container_has_label</code><a class="headerlink" href="#function-docker_functions.bsh container_has_label" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Container name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$2</span></code> - Label name</p></li>
</ul>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p>Return <code class="docutils literal notranslate"><span class="pre">1</span></code> for label is unset, <code class="docutils literal notranslate"><span class="pre">0</span></code> for label is set</p>
</dd>
</dl>
<p>Check to see if a container contains a certain label</p>
<p><a class="reference internal" href="#function-docker_functions.bsh container_get_label"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">container_get_label</span></code></a> cannot tell whether a container
has a label or not when the label is blank. The go template filter does not
differentiate. This will verify if a blank label is set or unset.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Requires jq be installed</p>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh docker_premkdir">
<code class="sig-name descname">docker_premkdir</code><a class="headerlink" href="#function-docker_functions.bsh docker_premkdir" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Host directory name or docker volume</p>
</dd>
</dl>
<p>Convenient wrapper to deal with the <code class="docutils literal notranslate"><span class="pre">MINGW</span></code> screw ups</p>
<p>Preempt one of docker’s annoying behaviors of creating directories that
don’t exist with root:root ownership, and just make the directory yourself.</p>
<p>When the argument is a docker volume, nothing should happen. Docker auto
creates those just fine.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Always creates the directory with 777 permission. This is to maximize the
chances that it works. If you don’t want this, the easiest solution is to
create the directory yourself. This is more of a last resort. For this
reason, when the directory is created, a message is printed.</p>
<p>When a directory doesn’t exist, it is assumed it is a directory, and not a
file because this is the same behavior as docker.</p>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh docker_host_dir">
<code class="sig-name descname">docker_host_dir</code><a class="headerlink" href="#function-docker_functions.bsh docker_host_dir" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Directory name</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><cite>stdout</cite> - Converted directory name</p>
</dd>
</dl>
<p>Normalize <code class="docutils literal notranslate"><span class="pre">POSIX</span></code> path to native path</p>
<blockquote>
<div><dl class="simple">
<dt>On Windows:</dt><dd><p>Converts /d/foo/bar to D:foobar using cygpath</p>
</dd>
<dt>On everything else in the world:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">WYSIWYG</span></code></p>
</dd>
</dl>
</div></blockquote>
<dl class="bash function">
<dt id="function-docker_functions.bsh docker_parse_volume_string">
<code class="sig-name descname">docker_parse_volume_string</code><a class="headerlink" href="#function-docker_functions.bsh docker_parse_volume_string" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - The volume string (source:destination:flags)</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><ul class="simple">
<li><p>volume_host - Host path part of the string</p></li>
<li><p>volume_docker - Docker path part of the string</p></li>
<li><p>volume_flags - Extra optional flags part of the string; may be empty</p></li>
<li><p>Returns <code class="docutils literal notranslate"><span class="pre">1</span></code> if regex is not matched, else return <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
</ul>
</dd>
</dl>
<p>Split up the docker volume string</p>
<p>Docker volume strings can contain optional flags and, depending on windows
or <code class="docutils literal notranslate"><span class="pre">POSIX</span></code> operating systems, have different rules, etc… This function will
universally split the string up.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Based off of docker 17.12 syntax. If new flags are added, the regex must be
updated.</p>
<p>Not actually a bug, but a string like “d:/test:ro” would be parsed as host
path “D:test” and docker path “ro”, NOT internal volume “d”, docker path
“/test”, and flag read-only. This is not a bug because you can’t have a
single letter docker volume, so this shouldn’t work anyways.</p>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh docker_sanitize_volume">
<code class="sig-name descname">docker_sanitize_volume</code><a class="headerlink" href="#function-docker_functions.bsh docker_sanitize_volume" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - The host directory/volume name</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">$2</span></code>] - The docker directory (optional. If omitted, copies host directory)</p></li>
</ul>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><cite>stdout</cite> - The argument that should go with the -v to docker for mounting</p>
</dd>
</dl>
<p>Create a directory before docker gets a chance to</p>
<p>A number of things can go wrong with something as simple as mounting a directory. If the directory doesn’t exist, root will end up owning the directory (which is often not desired). Also, on MINGW Linux/Windows path expansion ends up being an error to docker on Windows. So this function will take care of both of these problems in an OS agnostic way.</p>
<p class="rubric">Usage</p>
<p>Mainly for the docker and docker-compose CLI -v flags</p>
<p class="rubric">Bugs</p>
<p>The docker directory is not optional if the host mount is a volume</p>
<dl class="bash function">
<dt id="function-docker_functions.bsh parse-docker">
<code class="sig-name descname">parse-docker</code><a class="headerlink" href="#function-docker_functions.bsh parse-docker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code>.. - Arguments to be sent to docker command</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><ul class="simple">
<li><p>docker_args - Arguments to docker, before the docker subcommand (run, up, down, etc…)</p></li>
<li><p>docker_command - Docker command specified</p></li>
<li><p>docker_command_args - Arguments for the specified command</p></li>
</ul>
</dd>
</dl>
<p>Parse docker’s arguments and split up information (See OUTPUT)</p>
<p class="rubric">Usage</p>
<p>Typically, in the calling function, you will define all the output variables as local so that they are captured by the calling function only.</p>
<dl class="simple">
<dt>Original command can be thought of as:</dt><dd><p>docker “${docker_args[&#64;]}” “${docker_command}” “${docker_command_args[&#64;]}”</p>
</dd>
</dl>
<dl class="bash function">
<dt id="function-docker_functions.bsh Exec-Nvidia-Docker">
<code class="sig-name descname">Exec-Nvidia-Docker</code><a class="headerlink" href="#function-docker_functions.bsh Exec-Nvidia-Docker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Version of Docker for Nvidia and <code class="docutils literal notranslate"><span class="pre">exec</span></code>’s</p>
<dl class="bash function">
<dt id="function-docker_functions.bsh Nvidia-Docker">
<code class="sig-name descname">Nvidia-Docker</code><a class="headerlink" href="#function-docker_functions.bsh Nvidia-Docker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Version of Docker for Nvidia</p>
<dl class="bash function">
<dt id="function-docker_functions.bsh Exec-Docker">
<code class="sig-name descname">Exec-Docker</code><a class="headerlink" href="#function-docker_functions.bsh Exec-Docker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Version of Docker that <code class="docutils literal notranslate"><span class="pre">exec</span></code>’s the command rather than call</p>
<dl class="bash function">
<dt id="function-docker_functions.bsh Docker">
<code class="sig-name descname">Docker</code><a class="headerlink" href="#function-docker_functions.bsh Docker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code>.. - Arguments to be sent to docker command</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><ul class="simple">
<li><p>[<code class="docutils literal notranslate"><span class="pre">DRYRUN</span></code>] - Optional variable inserted at the beginning of all docker commands. Useful for setting to “echo” or similar for dryrun mode</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DOCKER_EXTRA_ARGS</span></code> - Array of extra arguments inserted after docker but before the docker subcommand</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DOCKER_EXTRA_{subcommand}_ARGS</span></code> - Extra arguments inserted right after the docker subcommand</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_AUTOREMOVE</span></code>] - Automatically add the –rm flag to docker run commands. Default: 1</p></li>
</ul>
</dd>
<dt class="field-odd">Output</dt>
<dd class="field-odd"><p>Runs docker command</p>
</dd>
</dl>
<p>Helper function to execute the right docker command, or just dryrun</p>
<p>Instead of calling the docker command directly, this Docker function should
be called instead (for all dryrun-able activities. Simple commands like
inspect, ps, etc. don’t make as much sense to dryrun, as the reset of the
script will never be executed, thus rendering dryrun useless.)</p>
<p class="rubric">Bugs</p>
<p>Does not handle the <code class="docutils literal notranslate"><span class="pre">-v</span></code> or <code class="docutils literal notranslate"><span class="pre">--help</span></code> case where no command is supplied</p>
<dl class="std envvar">
<dt id="envvar-DOCKER_COMPOSE">
<code class="sig-name descname">DOCKER_COMPOSE</code><a class="headerlink" href="#envvar-DOCKER_COMPOSE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Name/path of docker-compose executable</p>
<p>Instead of hard-coding “docker-compose” everywhere, use the variable
<span class="target" id="index-3"></span><a class="reference internal" href="#envvar-DOCKER_COMPOSE"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">DOCKER_COMPOSE</span></code></a> so that when the need comes, it is easier to switch which
executable gets called</p>
<dl class="bash function">
<dt id="function-docker_functions.bsh docker-compose-volumes-old">
<code class="sig-name descname">docker-compose-volumes-old</code><a class="headerlink" href="#function-docker_functions.bsh docker-compose-volumes-old" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Name of service of interest</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">$2</span></code>] - Prefix to volume names</p></li>
</ul>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">DOCKER_VOLUME_FLAGS</span></code> - Array of the docker flags, including necessary -v’s</p>
</dd>
</dl>
<p>Get volume flags from docker-compose config</p>
<p>Reformats the output from docker-compose config to an array with -v flags
for use in passing to another docker or docker-compose run command.</p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose.yml
  version: <span class="s2">&quot;3.2&quot;</span>
  services:
    nb:
      image : some_image
      volumes:
      - /tmp:/mnt
      - test:/opt
  volumes:
    test:

docker-compose-volumes-old nb test_prefix_ &lt; &lt;<span class="o">(</span>docker-compose config<span class="o">)</span>
<span class="c1"># Or</span>
<span class="c1"># docker-compose-volumes-old nb &lt;&lt;&lt; &quot;$(docker-compose config)&quot;</span>

<span class="nb">declare</span> -p DOCKER_VOLUME_FLAGS
&gt; <span class="nb">declare</span> -a <span class="nv">DOCKER_VOLUME_FLAGS</span><span class="o">=</span><span class="s1">&#39;([0]=&quot;-v&quot; [1]=&quot;/tmp:/mnt:rw&quot; [2]=&quot;-v&quot;</span>
<span class="s1">                                   [3]=&quot;test_prefix_test:/opt&quot;)&#39;</span>
</pre></div>
</div>
<p class="rubric">Bugs</p>
<p>Currently only works on volume short format</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Useful for working around docker/compose#4728</p>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh parse-docker-compose-volumes">
<code class="sig-name descname">parse-docker-compose-volumes</code><a class="headerlink" href="#function-docker_functions.bsh parse-docker-compose-volumes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Name of service of interest</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">$2</span></code>] - Prefix to volume names</p></li>
</ul>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">DOCKER_VOLUME_LINES</span></code> - Array of the docker lines. Lines starting with an S represent the short format. Lines starting with an L represent the beginning of a long format entry. Subsequent lines starting with an l are the additional lines of the long format entry. Order matters when in this format.</p>
</dd>
</dl>
<p>Get volume lines from docker-compose config</p>
<p>Parses the output from docker-compose config so that information about the
available mounts are ready to be used by docker-compose-volumes</p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose.yml
  version: <span class="s2">&quot;3.2&quot;</span>
  services:
    nb:
      image : some_image
      volumes:
      - /tmp:/mnt
      - type: <span class="nb">bind</span>
        source: /home/user/src
        target: /src
      - test:/opt
  volumes:
    test:

parse-docker-compose-volumes nb test_prefix_ &lt; &lt;<span class="o">(</span>docker-compose config<span class="o">)</span>
<span class="c1"># Or</span>
<span class="c1"># parse-docker-compose-volumes nb &lt;&lt;&lt; &quot;$(docker-compose config)&quot;</span>

<span class="nb">declare</span> -p DOCKER_VOLUME_LINES
&gt; <span class="nb">declare</span> -a <span class="nv">DOCKER_VOLUME_LINES</span><span class="o">=</span><span class="s1">&#39;([0]=&quot;S/tmp:/mnt&quot; [1]=&quot;Ltype: bind&quot;</span>
<span class="s1">                                   [2]=&quot;lsource: /home/user/src&quot;</span>
<span class="s1">                                   [3]=&quot;ltarget: /src&quot; [4]=&quot;Stest:/opt&quot;)&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Useful for working around docker/compose#4728</p>
<p>Supports both short and long format</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>docker-compose-volumes</p>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh docker-compose-list-internal-volumes">
<code class="sig-name descname">docker-compose-list-internal-volumes</code><a class="headerlink" href="#function-docker_functions.bsh docker-compose-list-internal-volumes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Input</dt>
<dd class="field-odd"><p><strong>stdin</strong> - Docker-compose yaml file</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">DOCKER_INTERNAL_VOLUMES</span></code> - Array of the docker volumes</p>
</dd>
</dl>
<p>Parses the output from <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">config</span></code> to get the list of all internal volumes</p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose.yml
  version: <span class="s2">&quot;3.2&quot;</span>
  services:
    nb:
      image : some_image
      volumes:
      - test:/opt
  volumes:
    test:
    stuff:

docker-compose-list-internal-volumes &lt; &lt;<span class="o">(</span>docker-compose config<span class="o">)</span>
<span class="c1"># Or</span>
<span class="c1"># docker-compose-list-internal-volumes &lt;&lt;&lt; &quot;$(docker-compose config)&quot;</span>

<span class="nb">declare</span> -p DOCKER_INTERNAL_VOLUMES
&gt; <span class="nb">declare</span> -a <span class="nv">DOCKER_INTERNAL_VOLUMES</span><span class="o">=</span><span class="s1">&#39;([0]=&quot;test&quot; [1]=&quot;stuff&quot;)&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Both <code class="docutils literal notranslate"><span class="pre">test</span></code> and <code class="docutils literal notranslate"><span class="pre">stuff</span></code> will be returned, even though stuff is not used.</p>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh docker-compose-volumes">
<code class="sig-name descname">docker-compose-volumes</code><a class="headerlink" href="#function-docker_functions.bsh docker-compose-volumes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Output</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DOCKER_VOLUME_SOURCES</span></code> - List of sources</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DOCKER_VOLUME_TARGETS</span></code> - Corresponding list of targets</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DOCKER_VOLUME_FLAGS</span></code> - Corresponding list of flags. Can be a mix of short and long format flags. Needs more parsing before this mix is useful.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DOCKER_VOLUME_FORMATS</span></code> - Corresponding list specifying either “long” or “short” as the format of each volume</p></li>
</ul>
</dd>
</dl>
<p>Get volume lists from <code class="docutils literal notranslate"><span class="pre">DOCKER_VOLUME_LINES</span></code></p>
<p class="rubric">Usage</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>parse-docker-compose-volumes nb test_prefix_ &lt; &lt;<span class="o">(</span>docker-compose config<span class="o">)</span>
docker-compose-volumes
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>parse-docker-compose-volumes</p>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh parse-docker-compose">
<code class="sig-name descname">parse-docker-compose</code><a class="headerlink" href="#function-docker_functions.bsh parse-docker-compose" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code>.. - Arguments to be sent to docker-compose command</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><p>[<code class="docutils literal notranslate"><span class="pre">JUST_DOCKER_COMPOSE_DIR</span></code>] - By default, the docker-compose files will initially be searched for in the <code class="docutils literal notranslate"><span class="pre">JUSTFILE</span></code> directory, and then up the parent dirs until / is hit. However, if you wish to the disable this behavior and start searching for a docker-compose file from the current directory where “just” is called, then set this var to an empty string. You can also set to a specific directory to start searching from within that directory.</p>
</dd>
<dt class="field-odd">Output</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">docker_compose_args</span></code> - Arguments to docker-compose, before the docker-compose command (run, up, down, etc…)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker_compose_command</span></code> - Docker compose command specified</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker_compose_command_args</span></code> - Arguments for the specified command</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker_compose_files</span></code> - Array of docker compose files that are used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker_compose_project_name</span></code> - Docker compose project name</p></li>
</ul>
</dd>
</dl>
<p>Parse docker-compose’s arguments and pull out a few important pieces of
information (See OUTPUT)</p>
<p class="rubric">Usage</p>
<p>Typically, in the calling function, you will define all the output variables
as local, so that they are captured by the calling function only.</p>
<p>Original command can be thought of as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose <span class="s2">&quot;</span><span class="si">${</span><span class="nv">docker_compose_args</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">docker_compose_command</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
               <span class="s2">&quot;</span><span class="si">${</span><span class="nv">docker_compose_command_args</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p class="rubric">Example</p>
<p>To start searching for docker-compose.yml in the directory where “just” is called:
(Justfile snippet)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>target<span class="o">)</span> <span class="c1"># Test target</span>
  <span class="nv">JUST_DOCKER_COMPOSE_DIR</span><span class="o">=</span><span class="s2">&quot;&quot;</span> Just-docker-compose run target
  <span class="p">;;</span>
</pre></div>
</div>
<p>To change the default search location for a project, in the project env file
add</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>: <span class="si">${</span><span class="nv">JUST_DOCKER_COMPOSE_DIR</span><span class="p">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PROJECT_CWD</span><span class="si">}</span><span class="s2">/docker_dir&quot;</span><span class="si">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because the -f argument overrides all other forms of choosing the compose
file, the <code class="docutils literal notranslate"><span class="pre">docker_compose_args</span></code> are updated to use this notation instead of
other methods that may be used. This will not change the behavior of the
<code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> command run, but will make adding additional compose files
a lot easier.</p>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh compose_path_separator">
<code class="sig-name descname">compose_path_separator</code><a class="headerlink" href="#function-docker_functions.bsh compose_path_separator" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Output</dt>
<dd class="field-odd"><p><em>stdout</em> - IFS string</p>
</dd>
</dl>
<p>Reproduce <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> logic for pathsep</p>
<p><code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> uses some logic to determine the IFS separator for splitting
up the <code class="docutils literal notranslate"><span class="pre">COMPOSE_FILE</span></code> environment variable. This should return the exact same
result</p>
<p class="rubric">Usage</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">local</span> <span class="nv">OLD_IFS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">IFS</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nb">local</span> <span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>compose_path_separator<span class="k">)</span><span class="s2">&quot;</span>
...
<span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OLD_IFS</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh Docker-compose">
<code class="sig-name descname">Docker-compose</code><a class="headerlink" href="#function-docker_functions.bsh Docker-compose" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code>.. - Arguments to be sent to docker-compose command</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DOCKER_COMPOSE_EXTRA_ARGS</span></code> - Array of extra arguments inserted after <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> but before the docker subcommand</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DOCKER_COMPOSE_EXTRA_{subcommand}_ARGS</span></code> - Array of extra arguments inserted right after the docker subcommand</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">DOCKER_COMPOSE_AUTOREMOVE</span></code>] - Automatically add the –rm flag to <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> run commands when using the Docker-compose helper function. Default: 1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DRYRUN</span></code>] - Optional variable inserted at the beginning of all docker commands. Useful for setting to “echo” or similar for dryrun mode</p></li>
</ul>
</dd>
<dt class="field-odd">Output</dt>
<dd class="field-odd"><p>Runs docker-compose command</p>
</dd>
</dl>
<p>Helper function to execute (dryrun) the right command</p>
<p>Instead of calling the <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> command directly, the <code class="docutils literal notranslate"><span class="pre">Docker-compose</span></code>
command should be called instead (for all dryrun-able activities. Simple
commands like ps, etc. don’t make as much sense to dryrun, as the reset of
the script will never be executed, thus rendering dryrun useless.)</p>
<p class="rubric">Bugs</p>
<p><code class="docutils literal notranslate"><span class="pre">Docker-compose</span></code> should not be exec’d like Docker was. Since fifo buffers are
created in common usage of <code class="docutils literal notranslate"><span class="pre">Docker-compose</span></code>, <cite>exec Docker-compose</cite> would
result in fifo buffers being left behind in /tmp</p>
<dl class="bash function">
<dt id="function-docker_functions.bsh get_docker_compose_version">
<code class="sig-name descname">get_docker_compose_version</code><a class="headerlink" href="#function-docker_functions.bsh get_docker_compose_version" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code>… - <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> yaml filenames</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><em>stdout</em> - <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> version. Nothing if none are found</p>
</dd>
</dl>
<p>Returns the first <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> version found</p>
<dl class="bash function">
<dt id="function-docker_functions.bsh get_docker_stage_names">
<code class="sig-name descname">get_docker_stage_names</code><a class="headerlink" href="#function-docker_functions.bsh get_docker_stage_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Dockerfile filename</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><em>stdout</em> - List of stages, newline separated</p>
</dd>
</dl>
<p>Get list of named stages in a Dockerfile</p>
<dl class="bash function">
<dt id="function-docker_functions.bsh get_dockerfile_from_compose">
<code class="sig-name descname">get_dockerfile_from_compose</code><a class="headerlink" href="#function-docker_functions.bsh get_dockerfile_from_compose" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - docker-compose file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$2</span></code> - Service name</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">$3</span></code>] - <a class="reference internal" href="../../../linux/yarp.auto.html#file-yarp"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">yarp</span></code></a> of compose file</p></li>
</ul>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><em>stdout</em> - The Dockerfile. Not guaranteed to be a full path</p>
</dd>
</dl>
<p>Determine Dockerfile filename from the compose file</p>
<p>If you would like to set the “project directory” used by compose to be somewhere other then the directory in which the docker-compose.yml (<code class="docutils literal notranslate"><span class="pre">$1</span></code>) resides, you must provide the <a class="reference internal" href="../../../linux/yarp.auto.html#file-yarp"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">yarp</span></code></a> of the compose file as <code class="docutils literal notranslate"><span class="pre">$3</span></code> and set <code class="docutils literal notranslate"><span class="pre">$1</span></code> to a “file” in the directory of the project dir. Note, however, that this file does not necessarily have to exist.</p>
<dl class="bash function">
<dt id="function-docker_functions.bsh Just-docker-compose">
<code class="sig-name descname">Just-docker-compose</code><a class="headerlink" href="#function-docker_functions.bsh Just-docker-compose" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code>… - Arguments to docker-compose</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">JUST_PROJECT_PREFIX</span></code> - Typically, the project name that is prepended to all the variables. EXAMPLE would cover EXAMPLE_VARIABLE</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">COMPOSE_VERSION</span></code>] - The docker compose yaml version number is auto determined by parsing the existing files, and is used in the auto generated files. In order to bypass this, you can specify the version number manually using this variable.</p></li>
</ul>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">Docker-compose</span></code> with advance just features</p>
<p>To provide a smoother just experience, advanced features are baked into
<code class="docutils literal notranslate"><span class="pre">Just-docker-compose</span></code> to work with Just and <a class="reference internal" href="just_entrypoint_functions.auto.html#file-just_entrypoint_functions"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">just_entrypoint_functions</span></code></a> to cover the
last mile in getting docker started and setup with a predictable environment
user permissions, mounts (and more…)</p>
<p>Creates a docker override yaml file and extends the current docker-compose
configuration.</p>
<p>See <a class="reference internal" href="docker_compose_override.auto.html#function-docker_compose_override generate_docker_compose_override"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_compose_override</span> <span class="pre">generate_docker_compose_override</span></code></a> for more
information.</p>
<p>Determines which docker compose yaml files to use by mimicking the
behavior of docker-compose, which includes querying the <code class="docutils literal notranslate"><span class="pre">COMPOSE_FILE</span></code>
environment variable or trying the default files.</p>
<p class="rubric">Bugs</p>
<p>A temp file is left behind in dryrun mode so that dryrun mode will actually
work. As long as the commands echo’d by dryrun are executed, the temp file
will be cleaned up, as one of them is rm. So ultimately, this is by design.</p>
<p>Using this function with windows paths is not currently supported.</p>
<p>You can not use process substitution for the docker-compose.yml file because
<code class="docutils literal notranslate"><span class="pre">bash</span></code> has to read it before docker-compose reads it. So this will not work:
Just-docker-compose -f &lt;(echo “${compose_file}”) run test
You have to use files.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="docker_compose_override.auto.html#function-docker_compose_override generate_docker_compose_override"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">docker_compose_override</span> <span class="pre">generate_docker_compose_override</span></code></a></p>
</div>
<dl class="bash function">
<dt id="function-docker_functions.bsh docker_service_running">
<code class="sig-name descname">docker_service_running</code><a class="headerlink" href="#function-docker_functions.bsh docker_service_running" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p>[<code class="docutils literal notranslate"><span class="pre">$1</span></code>…] - service names, if none are provided, all are used</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">COMPOSE_FILE</span></code> - Colon delimited file listing docker-compose files to use</p>
</dd>
<dt class="field-odd">Output</dt>
<dd class="field-odd"><p><em>stdout</em> - State of service running, Up/Exited/Creating/etc…</p>
</dd>
<dt class="field-even">Return Value</dt>
<dd class="field-even"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Service found</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Service not found</p></li>
</ul>
</dd>
</dl>
<p>Checks to see if a service is running</p>
<p>Returns the state-status of any containers, using the docker-compose service
names.</p>
<dl class="bash function">
<dt id="function-docker_functions.bsh docker_compose_service_names">
<code class="sig-name descname">docker_compose_service_names</code><a class="headerlink" href="#function-docker_functions.bsh docker_compose_service_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - docker compose yaml file</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><em>stdout</em> - New line separated list of service names</p>
</dd>
</dl>
<p>Get service names from compose yaml file</p>
<dl class="bash function">
<dt id="function-docker_functions.bsh docker_compose_sanitize_project_name">
<code class="sig-name descname">docker_compose_sanitize_project_name</code><a class="headerlink" href="#function-docker_functions.bsh docker_compose_sanitize_project_name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Directory name. Can also be any name really. But directory name is what docker-compose uses to come up with the project name</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">$2</span></code>] - Optionally specify a prefix (like a username) to assist in making a (user) specific project name</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker_compose_sanitize_project_name <span class="s1">&#39;project/A@1.1_2&#39;</span>
  projectA112

docker_compose_sanitize_project_name <span class="s1">&#39;project/A@1.1_2&#39;</span> <span class="s1">&#39;a-user:7&#39;</span>
  auser7projectA112

docker_compose_sanitize_project_name <span class="s1">&#39;&#39;</span> <span class="s1">&#39;a-user:7&#39;</span>
  auser7
</pre></div>
</div>
<p>Make a valid project name</p>
<p>Docker compose will auto generate a project name based off of the directory
name. A docker compose project name can only have lowercase letters and
numbers. This function will reproduce that same functionality so that you
can have that value in <code class="docutils literal notranslate"><span class="pre">bash</span></code>, with some added benefits (prefix) to truly take
control of your docker-compose experience.</p>
<dl class="bash function">
<dt id="function-docker_functions.bsh docker_cp_image">
<code class="sig-name descname">docker_cp_image</code><a class="headerlink" href="#function-docker_functions.bsh docker_cp_image" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[$1]...</span></code> - Same optional arguments as <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">cp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${n-2}</span></code> Image name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${n-1}</span></code> SRC_PATH in image</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${n}</span></code> DEST_PATH on the host</p></li>
</ul>
</dd>
</dl>
<p>A helper function to emulate <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">cp</span></code> from an image instead of from a container.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">SRC_PATH</span></code> must be from an image, and the <code class="docutils literal notranslate"><span class="pre">DEST_PATH</span></code> must be on the host</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="just_docker_functions.auto.html" class="btn btn-neutral float-right" title="J.U.S.T. Docker Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="docker_compose_override.auto.html" class="btn btn-neutral float-left" title="Docker Compose Override" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Vision Systems, Inc

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>