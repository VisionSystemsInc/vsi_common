

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Functions &mdash; VSI Common 0.0.7 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="J.U.S.T. Wrap" href="just_wrap.auto.html" />
    <link rel="prev" title="Environment" href="just_env.auto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> VSI Common
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">J.U.S.T. Useful Simple Tasking</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">J.U.S.T. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart_user.html">J.U.S.T. Quickstart Guide for Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Getting started developing with <code class="docutils literal notranslate"><span class="pre">just</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="just.auto.html">J.U.S.T.</a></li>
<li class="toctree-l2"><a class="reference internal" href="files.html">J.U.S.T. Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="just-tab.auto.html">Tab completion</a></li>
<li class="toctree-l2"><a class="reference internal" href="just_common.auto.html">Just Common Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="just_env.auto.html">Environment</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#just-plugins">just_plugins</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="just_wrap.auto.html">J.U.S.T. Wrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="new_just.auto.html">New J.U.S.T.</a></li>
<li class="toctree-l2"><a class="reference internal" href="just_diff.auto.html">Updating a just environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins/index.html">J.U.S.T. Plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../linux/index.html">Linux Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows/index.html">Windows Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tests/index.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/modules.html">vsi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker/recipes/get-pipenv.auto.html">Get Pipenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker/recipes/index.html">Docker recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../style.html">Contributing Style Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VSI Common</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">J.U.S.T. Useful Simple Tasking</a> &raquo;</li>
        
      <li>Functions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/just/just_functions.auto.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="functions">
<h1>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h1>
<dl class="file">
<dt id="file-just_functions.bsh">
<code class="sig-name descname">just_functions.bsh</code><a class="headerlink" href="#file-just_functions.bsh" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A few functions are defined in a common. Sourced here for DRY</p>
<dl class="envvar">
<dt id="envvar-DRYRUN">
<code class="sig-name descname">DRYRUN</code><a class="headerlink" href="#envvar-DRYRUN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Print out some commands instead of executing.</p>
<p>${DRYRUN} &lt;command&gt;</p>
<p>Display key commands as they would be executed. This is conveniently set by using the <code class="docutils literal notranslate"><span class="pre">-n</span></code>/<code class="docutils literal notranslate"><span class="pre">--dryrun</span></code> argument. Default: <code class="docutils literal notranslate"><span class="pre">&lt;Null&gt;</span></code></p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> Docker<span class="o">()</span>
<span class="o">{</span>
  <span class="si">${</span><span class="nv">DRYRUN</span><span class="si">}</span> docker <span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><span class="target" id="index-0"></span><a class="reference internal" href="#envvar-DRYRUN"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">DRYRUN</span></code></a> doesn’t just echo out the command, it uses the <a class="reference internal" href="../linux/print_command.auto.html#function-print_command print_command"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">print_command</span> <span class="pre">print_command</span></code></a> function to print out a command that can be copied and pasted in. This handles spaces correctly unlike echo.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../linux/print_command.auto.html#function-print_command print_command"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">print_command</span> <span class="pre">print_command</span></code></a></p>
</div>
<dl class="envvar">
<dt id="envvar-JUST_SEPARATOR">
<code class="sig-name descname">JUST_SEPARATOR</code><a class="headerlink" href="#envvar-JUST_SEPARATOR" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Separator used for <a class="reference internal" href="#function-just_functions.bsh get_args"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_functions.bsh</span> <span class="pre">get_args</span></code></a></p>
<p>When passing an unknown number of arguments, the JUST_SEPARATOR can be used to begin and end a group of arguments . Default: –</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-just_functions.bsh get_args"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_args</span></code></a>, <a class="reference internal" href="#function-just_functions.bsh get_additional_args"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_additional_args</span></code></a></p>
</div>
<dl class="envvar">
<dt id="envvar-JUST_SAFE_LOAD_DELIMITER">
<code class="sig-name descname">JUST_SAFE_LOAD_DELIMITER</code><a class="headerlink" href="#envvar-JUST_SAFE_LOAD_DELIMITER" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Separator used for safe_load</p>
<p>safe_load reads a key:value file, and this variable is used to separate the keys and values. Default: =</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-just_functions.bsh safe_load"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">safe_load</span></code></a></p>
</div>
<div class="section" id="just-plugins">
<h2>just_plugins<a class="headerlink" href="#just-plugins" title="Permalink to this headline">¶</a></h2>
<p>Plugin system for just</p>
<p class="rubric">Usage</p>
<p>Certain just targets can be used for many different projects, and rather then repeating this code, just_plugins give a way to expose the common code of these targets to many different projects.</p>
<p>To add a plugins to your project, simply add the plugin filenames to your <a class="reference internal" href="#file-.justplugins"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">.justplugins</span></code></a> file.</p>
<p>When writing a new plugin, you need to follow a few rules:</p>
<ol class="arabic simple">
<li><p>A case statement in a defaultify function should be written, but with a unique name that should not be likely to be used anywhere else. All plugin functions will have to exist in the same namespace.</p></li>
<li><p>Adds the case function names to the array <span class="target" id="index-1"></span><a class="reference internal" href="#envvar-JUST_DEFAULTIFY_FUNCTIONS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_DEFAULTIFY_FUNCTIONS</span></code></a> to allow commonly used functionality to be added to the targets for just</p></li>
<li><p>Add the plugin filename to the array <span class="target" id="index-2"></span><a class="reference internal" href="#envvar-JUST_HELP_FILES"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_HELP_FILES</span></code></a></p></li>
<li><p>Must return non-zero if the argument is not matched, and return 0 on target match</p></li>
</ol>
<p class="rubric">Example</p>
<p>Source code of a just_example_functions.bsh, which looks something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">JUST_DEFAULTIFY_FUNCTIONS</span><span class="o">+=(</span>just_example_defaultify<span class="o">)</span>
<span class="nv">JUST_HELP_FILES</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span>
<span class="k">function</span> just_example_defaultify<span class="o">()</span>
<span class="o">{</span>
  <span class="nv">arg</span><span class="o">=</span><span class="nv">$1</span>
  <span class="nb">shift</span> <span class="m">1</span>
  <span class="k">case</span> <span class="nv">$arg</span> in
    foo<span class="p">|</span>bar<span class="o">)</span> <span class="c1">#Foobar test</span>
      <span class="nb">echo</span> <span class="s2">&quot;Foo or bar: </span><span class="nv">$1</span><span class="s2">&quot;</span>
      <span class="nv">extra_args</span><span class="o">=</span><span class="m">1</span>
      <span class="p">;;</span>
    *<span class="o">)</span>
      <span class="nv">plugin_not_found</span><span class="o">=</span><span class="m">1</span>
      <span class="p">;;</span>
  <span class="k">esac</span>
  <span class="k">return</span> <span class="m">0</span>
<span class="o">}</span>
</pre></div>
</div>
<dl class="envvar">
<dt id="envvar-JUST_PLUGIN_FILE">
<code class="sig-name descname">JUST_PLUGIN_FILE</code><a class="headerlink" href="#envvar-JUST_PLUGIN_FILE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Name of the just plugin file</p>
<p>Defaults to <a class="reference internal" href="#file-.justplugins"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">.justplugins</span></code></a> in the same directory as the Justfile, but can be overridden to another filename/path by exporting to this variable</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since plugins are loaded right before the project environment, you can not set the <span class="target" id="index-3"></span><a class="reference internal" href="#envvar-JUST_PLUGIN_FILE"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_PLUGIN_FILE</span></code></a> in the project env file. If you are using a custom <span class="target" id="index-4"></span><a class="reference internal" href="#envvar-JUST_PLUGIN_FILE"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_PLUGIN_FILE</span></code></a>, it will need to be set in the <a class="reference internal" href="files.html#file-setup.env"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">setup.env</span></code></a></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>just safe_env</p>
</div>
<dl class="envvar">
<dt id="envvar-JUST_DEFAULTIFY_FUNCTIONS">
<code class="sig-name descname">JUST_DEFAULTIFY_FUNCTIONS</code><a class="headerlink" href="#envvar-JUST_DEFAULTIFY_FUNCTIONS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>List of defaultify functions</p>
<p>The values of this array are executed as a command. Each plugin should have a unique name for the function, and is responsible for adding that function name to <span class="target" id="index-5"></span><a class="reference internal" href="#envvar-JUST_DEFAULTIFY_FUNCTIONS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_DEFAULTIFY_FUNCTIONS</span></code></a></p>
<dl class="envvar">
<dt id="envvar-JUST_HELP_FILES">
<code class="sig-name descname">JUST_HELP_FILES</code><a class="headerlink" href="#envvar-JUST_HELP_FILES" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This should include just_functions.bsh, which ever Justfile is used, and any plugins. The plugin is responsible for adding itself to this array.</p>
<p class="rubric">Usage</p>
<p>Every project should have a setup script, typically called <code class="docutils literal notranslate"><span class="pre">setup.env</span></code>. This script filename is stored in <span class="target" id="index-6"></span><a class="reference internal" href="just_common.auto.html#envvar-JUST_SETUP_SCRIPT"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SETUP_SCRIPT</span></code></a> and is the location where <span class="target" id="index-7"></span><a class="reference internal" href="#envvar-JUST_HELP_FILES"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_HELP_FILES</span></code></a> should be set</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="target" id="index-8"></span><a class="reference internal" href="just_common.auto.html#envvar-JUST_SETUP_SCRIPT"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SETUP_SCRIPT</span></code></a></p>
</div>
<dl class="envvar">
<dt id="envvar-JUST_PROJECT_PREFIX">
<code class="sig-name descname">JUST_PROJECT_PREFIX</code><a class="headerlink" href="#envvar-JUST_PROJECT_PREFIX" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Variable prefix for project</p>
<p>Some just functions will need to know what all the project variables are called (using compgen). This should be defined in your environment script, and does not need to be overridable</p>
<dl class="envvar">
<dt id="envvar-JUST_SETTINGS">
<code class="sig-name descname">JUST_SETTINGS</code><a class="headerlink" href="#envvar-JUST_SETTINGS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Absolute path to the project env file used</p>
<dl class="function">
<dt id="function-just_functions.bsh source_environment_files">
<code class="sig-name descname">source_environment_files</code><a class="headerlink" href="#function-just_functions.bsh source_environment_files" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Convenience function for sourcing environments</p>
<p>The just system works by sourcing environment files</p>
<ol class="arabic simple">
<li><p>First ${project_dir}/local.env. This file should never be added to version control. It should contain customizations for that particular install.</p></li>
<li><p>The project file. This file should ideally contain all the default values necessary to run without any local.env settings.</p></li>
<li><p>Last, ${project_dir}/local_post.env. This file should never be added to version control. It is rarely used, except in situations where the value of a variable is based off of another variable. This is why it is loaded last.</p></li>
<li><p>Any plugins that are identified, are also sourced</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - The project environment filename</p>
</dd>
</dl>
<dl class="field-list simple" id="source-environment-files">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p>[<code class="docutils literal notranslate"><span class="pre">JUST_LOCAL_SETTINGS</span></code>] - Path of local settings file. Default: ${same_dir}/local.env</p></li>
<li><p>[<code class="docutils literal notranslate"><span class="pre">JUST_LOCAL_SETTINGS_POST</span></code>] - Path of post local settings file. Default: ${same_dir}/local_post.env</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Usage</p>
<p><code class="docutils literal notranslate"><span class="pre">JUST_LOCAL_SETTINGS</span></code> and <code class="docutils literal notranslate"><span class="pre">JUST_LOCAL_SETTINGS_POST</span></code> must not be set in the project environment file or in the local.env file, as it will not have the desired effect. Instead, they should either be manually set in the environment or set in the setup script (see <span class="target" id="index-9"></span><a class="reference internal" href="just_common.auto.html#envvar-JUST_SETUP_SCRIPT"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SETUP_SCRIPT</span></code></a>)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Certain exceptions make sense for not storing values in the project file, such as credentials, encryption keys, etc… information that should not be hard-coded ever.</p>
<p>Only require settings in <code class="docutils literal notranslate"><span class="pre">local.env</span></code> when it cannot be avoided. For example, sometimes its better to add default behavior of create keys if possible. Such as using openssl to create ssl certs in a default location (that is ignored by version control)</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="just_common.auto.html#function-just_common.bsh _just_get_plugins"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">just_common.bsh</span> <span class="pre">_just_get_plugins</span></code></a> <span class="target" id="index-10"></span><a class="reference internal" href="just_common.auto.html#envvar-JUST_SETUP_SCRIPT"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SETUP_SCRIPT</span></code></a></p>
</div>
<dl class="function">
<dt id="function-just_functions.bsh auto_path_escape">
<code class="sig-name descname">auto_path_escape</code><a class="headerlink" href="#function-just_functions.bsh auto_path_escape" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Automatically add an escape character to paths that match a pattern</p>
<p>TODO: Explain</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="just_env.auto.html#file-just_env"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">just_env</span></code></a></p>
</div>
<dl class="function">
<dt id="function-just_functions.bsh set_temp_array">
<code class="sig-name descname">set_temp_array</code><a class="headerlink" href="#function-just_functions.bsh set_temp_array" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Name of array to check if it is already set</p>
<p><code class="docutils literal notranslate"><span class="pre">$2...</span></code> - Default values of the array</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">JUST_TEMP_ARRAY</span></code> - Destination for all the values set</p>
</dd>
</dl>
<p>DEPRECATED: Set array to default values if not already set.</p>
<p>In bash, when setting a variable to a default value if it has not already been set, it is typical to follow the pattern:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">:</span> <span class="pre">${MY_VAR=default}</span></code></p>
</div></blockquote>
<p>However, this syntax does not work for an array. Bash 3.2 does not give an equivalent 1 line version of this. To cover this scenario, <a class="reference internal" href="#function-just_functions.bsh set_temp_array"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">set_temp_array</span></code></a> is used to set a default value if an array is not already set. Using <a class="reference internal" href="#function-just_functions.bsh set_temp_array"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">set_temp_array</span></code></a>, an array can be set to a default value if not already set in two lines</p>
<p>It works by checking if an array is set. If it is set, it copies all the values to the array JUST_TEMP_ARRAY. If it is not set, it will copy the rest of the arguments (the default values) to <code class="docutils literal notranslate"><span class="pre">JUST_TEMP_ARRAY</span></code>. When using this function with set -u turned on, it is best to reference <code class="docutils literal notranslate"><span class="pre">JUST_TEMP_ARRAY</span></code> by (${JUST_TEMP_ARRAY+”${JUST_TEMP_ARRAY[&#64;]}”}) in case the array is empty, as this triggers Bash’s unbound variable test.</p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>set_temp_array MY_ARRAY default1 default<span class="se">\ </span><span class="m">2</span> <span class="s2">&quot;default 3&quot;</span>
<span class="nv">MY_ARRAY</span><span class="o">=(</span><span class="si">${</span><span class="nv">JUST_TEMP_ARRAY</span><span class="p">+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">JUST_TEMP_ARRAY</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="o">)</span>

<span class="c1"># And when done, clean up</span>
<span class="nb">unset</span> JUST_TEMP_ARRAY
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#function-just_functions.bsh set_array_default"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">set_array_default</span></code></a></p>
</div>
<dl class="function">
<dt id="function-just_functions.bsh set_array_default">
<code class="sig-name descname">set_array_default</code><a class="headerlink" href="#function-just_functions.bsh set_array_default" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Name of array to check if it is already set</p>
<p><code class="docutils literal notranslate"><span class="pre">$2...</span></code> - Default values of the array</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">JUST_TEMP_ARRAY</span></code> - Destination for all the values set</p>
</dd>
</dl>
<p>Set array to default values if not already set.</p>
<p>In bash, when setting a variable to a default value if it has not already been set, it is typical to follow the pattern:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">:</span> <span class="pre">${MY_VAR=default}</span></code></p>
</div></blockquote>
<p>However, this syntax does not work for an array. Bash 3.2 does not give an equivalent 1 line version of this. To cover this scenario, <a class="reference internal" href="#function-just_functions.bsh set_array_default"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">set_array_default</span></code></a> is used to set a default value if an array is not already set.</p>
<p>It works by checking if an array is set. If it is set, nothing happens. If it is not set, it will copy the rest of the arguments (the default values) to the array named.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An empty array counts as set</p>
</div>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>set_array_default MY_ARRAY default1 default<span class="se">\ </span><span class="m">2</span> <span class="s2">&quot;default  3&quot;</span>
</pre></div>
</div>
<dl class="function">
<dt id="function-just_functions.bsh pretty_print_help">
<code class="sig-name descname">pretty_print_help</code><a class="headerlink" href="#function-just_functions.bsh pretty_print_help" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><em>stdin</em> - Each line is an entry in the pretty printout, separated by ” ${<span class="target" id="index-11"></span><a class="reference internal" href="just_common.auto.html#envvar-JUST_HELP_SEPARATOR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_HELP_SEPARATOR</span></code></a>} ” (without the quotes, but with the spaces)</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><p>indent - How much the right side should be indented to make a uniform output</p>
</dd>
</dl>
<p>Restructures text to indented properly on wrap around</p>
<p>Each line consists of a command that will be printed on the left, and the indented description on the right. The description is wrapped around based on tput cols.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="target" id="index-12"></span><a class="reference internal" href="just_common.auto.html#envvar-JUST_HELP_SEPARATOR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_HELP_SEPARATOR</span></code></a></p>
</div>
<dl class="function">
<dt id="function-just_functions.bsh print_help">
<code class="sig-name descname">print_help</code><a class="headerlink" href="#function-just_functions.bsh print_help" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Prints the auto generated help info from Justfile</p>
<dl class="function">
<dt id="function-just_functions.bsh is_powershell">
<code class="sig-name descname">is_powershell</code><a class="headerlink" href="#function-just_functions.bsh is_powershell" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Check if the current command windows is powershell</p>
<p>Using a Window title trick, determine if the shell is running in powershell, or not, for example command prompt windows, cygwin or git bash</p>
<dl class="function">
<dt id="function-just_functions.bsh need_tty">
<code class="sig-name descname">need_tty</code><a class="headerlink" href="#function-just_functions.bsh need_tty" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Check to see if a tty is missing. Normal tty checks do not work in mintty, as the pts appears to be a tty to native apps, but external apps will see a pipe. Checking to see if stdin has a name of “None” will tell us if we don’t have a piped stdin.</p>
<p>Calling this function is an expensive operation, and takes roughtly 1-2 seconds (to call a new powershell). Setting JUST_IS_TTY to 1 will cause the function to return false instantly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p>[<code class="docutils literal notranslate"><span class="pre">JUST_IS_TTY</span></code>] - If set to <cite>1`</cite>, need_tty automatically returns 1. If set to <code class="docutils literal notranslate"><span class="pre">0</span></code>, then <a class="reference internal" href="#function-just_functions.bsh need_tty"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">need_tty</span></code></a> will automatically returns 0 once.</p>
</dd>
</dl>
<p>If <code class="docutils literal notranslate"><span class="pre">JUST_IS_TTY</span></code> is set in a <code class="docutils literal notranslate"><span class="pre">local.env</span></code> file, then it should be set conditionally:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>: <span class="si">${</span><span class="nv">JUST_IS_TTY</span><span class="p">=0</span><span class="si">}</span>
</pre></div>
</div>
<p>This way it is triggered only once, instead of everytime <code class="docutils literal notranslate"><span class="pre">local.env</span></code> is source, which can be quite frequently.</p>
<p>One use case for this is “ssh from linux into windows, start git bash, . setup.env, and then run python”. This will detect a fake tty name, because it is piped. However, you still need a tty because in python up and down will not work. I do not know why in this case…</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://tinyurl.com/yb5jjzqt">https://tinyurl.com/yb5jjzqt</a></p>
</div>
<dl class="function">
<dt id="function-just_functions.bsh setup_tty">
<code class="sig-name descname">setup_tty</code><a class="headerlink" href="#function-just_functions.bsh setup_tty" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Pops up a new powershell window and runs just</p>
<p>Cygwin bash is pretty bad. The new git bash (MINGW64) does not have a tty. This is a problem for docker. Powershell does have a tty, buy can not run bash scrips natively. The solution is to run bash in powershell (which is not as straight forward as it sounds). This function is designed to re-execute in a new powershell on Windows if not in powershell</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p>[<code class="docutils literal notranslate"><span class="pre">JUST_PTY</span></code>] - PTY app to use create a psuedoterminal for windows apps. By default, uses <code class="docutils literal notranslate"><span class="pre">winpty</span></code>. Set to <code class="docutils literal notranslate"><span class="pre">powershell</span></code> for the old behavior</p>
</dd>
</dl>
<p class="rubric">Usage</p>
<p>setup_tty ${&#64;+”${&#64;}”}</p>
<dl class="function">
<dt id="function-just_functions.bsh defaultify">
<code class="sig-name descname">defaultify</code><a class="headerlink" href="#function-just_functions.bsh defaultify" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Default commands for just</p>
<p>Handles a few default commands for just:</p>
<ul class="simple">
<li><p>Calls plugins specified in <span class="target" id="index-13"></span><a class="reference internal" href="#envvar-JUST_DEFAULTIFY_FUNCTIONS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_DEFAULTIFY_FUNCTIONS</span></code></a></p></li>
<li><p>–dryrun|-n - Sets DRYRUN to <a class="reference internal" href="../linux/print_command.auto.html#function-print_command print_command"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">print_command</span> <span class="pre">print_command</span></code></a>. This way ${DRYRUN} can be put in front of any command and be printed instead of executed when in dryrun mode</p></li>
<li><p>–separator - Used to override the <span class="target" id="index-14"></span><a class="reference internal" href="#envvar-JUST_SEPARATOR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SEPARATOR</span></code></a> (default –) to anything else. This only affect commands that use get_args</p></li>
<li><p>-h|–help|help - Prints out help using print_help</p></li>
<li><p>_null - A target that does nothing. This is seldom needed.</p></li>
<li><ul>
<li><ul>
<li><p>For all other commands not captured yet, called unknownify (which can
be overridden for other behavior) to print an error message.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<dl class="function">
<dt id="function-just_functions.bsh unknownify">
<code class="sig-name descname">unknownify</code><a class="headerlink" href="#function-just_functions.bsh unknownify" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">JUST_FILE_NOT_FOUND</span></code> - Prints out a different message if <code class="docutils literal notranslate"><span class="pre">JUST_FILE_NOT_FOUND</span></code> is set to <code class="docutils literal notranslate"><span class="pre">1</span></code></p>
</dd>
</dl>
<p>The function executed when an unknown target is specified</p>
<p>The default behavior is to print an error and exit 1. However, a custom unknownify can be declared in Justfile to override this behavior</p>
<dl class="var">
<dt id="var-just_functions.bsh unknownify extra_args">
<code class="sig-name descname">extra_args</code><a class="headerlink" href="#var-just_functions.bsh unknownify extra_args" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The number of additional arguments consumed in a caseify target</p>
<p>When writing a caseify target, by default one argument is consumed. This is enough for any simple target. However some targets need additional arguments.</p>
<p>There are really three situation when extra arguments are needed</p>
<ol class="arabic simple">
<li><p>A fixed number of arguments. For example, if 3 arguments are needed, just use $1, $2, $3, and set <code class="docutils literal notranslate"><span class="pre">extra_args=3</span></code></p></li>
<li><p>The rest of the arguments are going to be consumed. In this case, use all the arguments (typically by $&#64;) and set extra_args=$#</p></li>
<li><p>An unknown number of arguments need to be used, and maybe multiple groups of unknown arguments. This is the case where JUST_SEPARATOR is used. (See EXAMPLE)</p></li>
</ol>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lets say we call:</span>

just <span class="nb">test</span> <span class="m">11</span> <span class="m">22</span> <span class="m">33</span> -- aa bb cc dd -- _null

<span class="c1"># test is called with 3 arguments</span>
<span class="c1"># aa is called with 3 arguments</span>
<span class="c1"># _null is called</span>
</pre></div>
</div>
<p class="rubric">The deprecated way</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lets say we call:</span>

  just <span class="nb">test</span> -- <span class="m">11</span> <span class="m">22</span> <span class="m">33</span> -- aa bb cc dd -- _null

  <span class="c1"># And I have a target test that takes two sets of arguments of unknown length</span>

<span class="nb">test</span><span class="o">)</span>
  get_args <span class="si">${</span><span class="p">@+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
  <span class="nv">first</span><span class="o">=</span><span class="si">${</span><span class="nv">args</span><span class="p">+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">args</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
  get_additional_args <span class="si">${</span><span class="p">@+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
  <span class="nv">second</span><span class="o">=</span><span class="si">${</span><span class="nv">args</span><span class="p">+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">args</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
  <span class="p">;;</span>
</pre></div>
</div>
<p>In this case, there is no need to add <a class="reference internal" href="#var-just_functions.bsh unknownify extra_args"><code class="xref bash bash-var docutils literal notranslate"><span class="pre">extra_args</span></code></a>, <a class="reference internal" href="#function-just_functions.bsh get_args"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_args</span></code></a> does this already</p>
<dl class="function">
<dt id="function-just_functions.bsh justify">
<code class="sig-name descname">justify</code><a class="headerlink" href="#function-just_functions.bsh justify" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">$1...</span></code> - list of targets</p>
</dd>
</dl>
<p>The main loop of just</p>
<p>Handles determining what subcommands are, and calling commands and subcommands.</p>
<p>When one target is called from another target, justify should be used to do the calling, for example:</p>
<blockquote>
<div><p>justify target2</p>
</div></blockquote>
<dl class="function">
<dt id="function-just_functions.bsh callify">
<code class="sig-name descname">callify</code><a class="headerlink" href="#function-just_functions.bsh callify" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Helper for consuming arguments and calling a function with them</p>
<p>Takes: cmd – $1 $2 $3 … $n – $m $m+1 …
and calls: cmd $1 $2 $3 … $n and consumes n+2 args
Trailing – is optional</p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>target<span class="o">)</span>
  callify python <span class="si">${</span><span class="p">@+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
  <span class="p">;;</span>

just target -- -c <span class="s2">&quot;print 1+3&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Not sure this is worth keeping</p>
</div>
<dl class="function">
<dt id="function-just_functions.bsh get_args">
<code class="sig-name descname">get_args</code><a class="headerlink" href="#function-just_functions.bsh get_args" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p>Inputs <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code> - All the unconsumed arguments</p>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">args</span></code> - Array of unknown number of arguments consumed
<code class="docutils literal notranslate"><span class="pre">get_args_args_used</span></code> - Number of arguments used, including separator</p>
</dd>
</dl>
<p>Get and consume an unknown collection of arguments</p>
<p>Gets an unknown number of arguments. The ending of the collection of arguments is annotated with the <span class="target" id="index-15"></span><a class="reference internal" href="#envvar-JUST_SEPARATOR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SEPARATOR</span></code></a>. The trailing annotation is optional as long as there are no more just commands following</p>
<p class="rubric">Bugs</p>
<p>This will conveniently update <code class="docutils literal notranslate"><span class="pre">extra_args</span></code> inside of the Justfile caseify function. However, if you are calling from another function (i.e., not writing a caseify section), this will produce incorrect behavior; therefore, extra_args should be made a local variable in the calling function</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">get_args_args_used</span></code> is a global variable. Unsetting it can cause unexpected
behavior</p>
</div>
<dl class="function">
<dt id="function-just_functions.bsh get_additional_args">
<code class="sig-name descname">get_additional_args</code><a class="headerlink" href="#function-just_functions.bsh get_additional_args" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Get and consume additional collections of arguments</p>
<p><a class="reference internal" href="#function-just_functions.bsh get_args"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_args</span></code></a> can only be called once, but <a class="reference internal" href="#function-just_functions.bsh get_additional_args"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_additional_args</span></code></a> can be called continuously after the first call of <a class="reference internal" href="#function-just_functions.bsh get_args"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_args</span></code></a></p>
<p class="rubric">Example</p>
<p>Must be called after <a class="reference internal" href="#function-just_functions.bsh get_args"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">get_args</span></code></a> with all arguments passed in. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span> target<span class="o">)</span>
   get_args <span class="si">${</span><span class="p">@+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
   <span class="nv">args1</span><span class="o">=(</span><span class="si">${</span><span class="nv">args</span><span class="p">+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">args</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="o">)</span>
   get_additional_args <span class="si">${</span><span class="p">@+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
   <span class="nv">args2</span><span class="o">=(</span><span class="si">${</span><span class="nv">args</span><span class="p">+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">args</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="o">)</span>
   get_additional_args <span class="si">${</span><span class="p">@+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
   <span class="nv">args3</span><span class="o">=(</span><span class="si">${</span><span class="nv">args</span><span class="p">+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">args</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="o">)</span>
   <span class="p">;;</span>

just target <span class="m">11</span> <span class="m">22</span> <span class="m">33</span> -- aa bb cc -- <span class="s1">&#39;!!&#39;</span> <span class="s1">&#39;@@&#39;</span> <span class="s1">&#39;##&#39;</span>

<span class="c1">#args1=(11 22 33)</span>
<span class="c1">#args2=(aa bb cc)</span>
<span class="c1">#args3=(!! @@ ##)</span>
</pre></div>
</div>
<dl class="function">
<dt id="function-just_functions.bsh safe_load">
<code class="sig-name descname">safe_load</code><a class="headerlink" href="#function-just_functions.bsh safe_load" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A non-eval method for loading and exporting a text file of keys/values</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments</dt>
<dd class="field-odd"><p>Inputs <code class="docutils literal notranslate"><span class="pre">$1</span></code> - Filename of file to be loaded.</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><p>[<span class="target" id="index-16"></span><a class="reference internal" href="#envvar-JUST_SAFE_LOAD_DELIMITER"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_SAFE_LOAD_DELIMITER</span></code></a>] - By default, = is use between key and value. If = is needed, then this environment variable can override the delimiter</p>
</dd>
<dt class="field-odd">Output</dt>
<dd class="field-odd"><p>All keys are set as environment variables, and exported</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">key1</span><span class="o">=</span>value_one
<span class="nv">key2</span><span class="o">=</span>this is another value
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Does not support comments, blank lines, or anything else other than key=value</p>
</div>
<p class="rubric">Bugs</p>
<p>As with anything in a language like Bash, it’s not guaranteed that an arbitrary command won’t be executed with this, but as far as is known, there are no known issues with this function.</p>
<dl class="file">
<dt id="file-.justplugins">
<code class="sig-name descname">.justplugins</code><a class="headerlink" href="#file-.justplugins" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Plugin file</p>
<p>The filename defaults to .justplugins, next to your Justfile, but can be overridden by exporting the environment variable <span class="target" id="index-17"></span><a class="reference internal" href="#envvar-JUST_PLUGIN_FILE"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">JUST_PLUGIN_FILE</span></code></a>.</p>
<p>Lists the various plugin files. Blank lines and # comment lines are allowed</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="just_wrap.auto.html" class="btn btn-neutral float-right" title="J.U.S.T. Wrap" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="just_env.auto.html" class="btn btn-neutral float-left" title="Environment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Vision Systems, Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>