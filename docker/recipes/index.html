

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Docker recipes &mdash; VSI Common 0.2.2+1dev documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Get Pipenv" href="get-pipenv.auto.html" />
    <link rel="prev" title="vsi.windows package" href="../../python/vsi.windows.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> VSI Common
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../just/index.html">J.U.S.T. Useful Simple Tasking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux/index.html">Linux Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../windows/index.html">Windows Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tests/index.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/modules.html">vsi</a></li>
<li class="toctree-l1"><a class="reference internal" href="get-pipenv.auto.html">Get Pipenv</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Docker recipes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-to-use">How to use</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-this-is-not">What this is not</a></li>
<li class="toctree-l2"><a class="reference internal" href="#recipes">Recipes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vsi-common">VSI Common</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tini">tini</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gosu">gosu</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ep-envplate">ep - envplate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jq-json-processor">jq - JSON Processor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ninja">ninja</a></li>
<li class="toctree-l3"><a class="reference internal" href="#docker">Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#docker-compose">Docker compose</a></li>
<li class="toctree-l3"><a class="reference internal" href="#git-large-file-support">git Large File Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cmake">CMake</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pipenv">Pipenv</a></li>
<li class="toctree-l3"><a class="reference internal" href="#amanda-debian-packages">Amanda debian packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#one-true-awk">One True Awk</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gdal">GDAL</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conda-s-python">Conda’s python</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#j-u-s-t">J.U.S.T.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../style.html">Contributing Style Guide</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VSI Common</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Docker recipes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/docker/recipes/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound">
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="get-pipenv.auto.html">Get Pipenv</a></li>
</ul>
</div>
<div class="section" id="docker-recipes">
<h1>Docker recipes<a class="headerlink" href="#docker-recipes" title="Permalink to this headline">¶</a></h1>
<a class="reference external image-reference" href="https://circleci.com/gh/VisionSystemsInc/docker_recipes"><img alt="CirclCI" src="https://circleci.com/gh/VisionSystemsInc/docker_recipes.svg?style=svg" /></a>
<p>A docker recipe is a (usually very small) docker image that is included in a multi-stage build so that you don’t always have to find and repeat that “prefect set of Dockerfile lines to include software XYZ”, such as gosu, tini, etc… They are based heavily on ONBUILD and meant to be used as their own stage.</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span>Dockerfile
<span class="k">FROM</span> <span class="s">vsiri/recipe:tini</span> <span class="k">as</span> <span class="s">tini</span>
<span class="k">FROM</span> <span class="s">vsiri/recipe:gosu</span> <span class="k">as</span> <span class="s">gosu</span>
<span class="k">FROM</span> <span class="s">debian:9</span> <span class="c">#My real docker image</span>

<span class="k">RUN</span> <span class="nb">echo</span> stuff  # This line is just an example

<span class="k">COPY</span> --from<span class="o">=</span>tini /usr/local /usr/local
<span class="k">COPY</span> --from<span class="o">=</span>gosu /usr/local /usr/local

<span class="c"># Universal patch command that all recipes could use</span>
<span class="k">RUN</span> <span class="nb">shopt</span> -s nullglob<span class="p">;</span> <span class="k">for</span> patch <span class="k">in</span> /usr/local/share/just/container_build_patch/*<span class="p">;</span> <span class="k">do</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</div>
<div class="section" id="how-to-use">
<h2>How to use<a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<p>The recipes can be used directly from dockerhub. It is also possible to include this repo as a submodule in the greater project, and building directly from the dockerfiles.</p>
<p>Many recipes have build arguments. This allows you to control what versions (usually) the recipe will use. This means the build arg needs to be set when the docker build command is issued, unless you want to use the default value.</p>
<ul class="simple">
<li><p>When using <code class="docutils literal notranslate"><span class="pre">docker</span></code>, this is done by <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span> <span class="pre">--build-arg</span> <span class="pre">key=val</span> <span class="pre">...</span></code>.</p></li>
<li><p>With <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> this can be done by <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">build</span> <span class="pre">--build-arg</span> <span class="pre">key=val</span> <span class="pre">...</span></code>.</p>
<ul>
<li><p>But it is usually better to add it to the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p></li>
</ul>
</li>
<li><p>What you cannot do is add a build <code class="docutils literal notranslate"><span class="pre">ARG</span></code> to the global section of the <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> and expect that default value to affect the recipe, that is not how they work.</p></li>
</ul>
</div>
<div class="section" id="what-this-is-not">
<h2>What this is not<a class="headerlink" href="#what-this-is-not" title="Permalink to this headline">¶</a></h2>
<p>A universal way to “INCLUDE” or “IMPORT” one Dockerfile into another. It only works under a certain set of circumstances</p>
<ul class="simple">
<li><p>Your file recipe output can be <em>easily</em> added using the Dockerfile <code class="docutils literal notranslate"><span class="pre">ADD</span></code> command</p></li>
<li><p>You are ok with customizing the version number using build args to override the default value</p></li>
<li><p>When your code is relatively portable. A python virtualenv is not, unfortunately. Go (when compiled statically) is almost always ultra portable.</p>
<ul>
<li><p>musl versions have to be done separately. For example: tini (glibc) and tini-musl (musl)</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="recipes">
<h2>Recipes<a class="headerlink" href="#recipes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="vsi-common">
<h3>VSI Common<a class="headerlink" href="#vsi-common" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>VSI Common</p></td>
</tr>
<tr class="row-even"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/vsi</span></code></p></td>
</tr>
</tbody>
</table>
<p>Some VSI Common functions are needed in the container, this provides a mechanism to copy them in, even if the <code class="file docutils literal notranslate"><span class="pre">just</span></code> executable is used.</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:vsi</span> <span class="k">as</span> <span class="s">vsi</span>
<span class="k">FROM</span> <span class="s">debian:9</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get install -y vim  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>vsi /vsi /vsi
</pre></div>
</div>
</div>
<div class="section" id="tini">
<h3>tini<a class="headerlink" href="#tini" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 79%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>tini</p></td>
</tr>
<tr class="row-even"><td><p>Build Args</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TINI_VERSION</span></code> - Version of tini to download</p></td>
</tr>
<tr class="row-odd"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local</span></code></p></td>
</tr>
</tbody>
</table>
<p>Tini is a process reaper, and should be used in dockers that spawn new processes</p>
<p>There is a similar version for alpine: tini-musl</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:tini</span> <span class="k">as</span> <span class="s">tini</span>
<span class="k">FROM</span> <span class="s">debian:9</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get install -y vim  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>tini COPY /usr/local /usr/local
</pre></div>
</div>
</div>
<div class="section" id="gosu">
<h3>gosu<a class="headerlink" href="#gosu" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 79%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>gosu</p></td>
</tr>
<tr class="row-even"><td><p>Build Args</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GOSU_VERSION</span></code> - Version of gosu to download</p></td>
</tr>
<tr class="row-odd"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local</span></code></p></td>
</tr>
</tbody>
</table>
<p>sudo written with docker automation in mind (no passwords ever)</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:gosu</span> <span class="k">as</span> <span class="s">gosu</span>
<span class="c"># The following line will NOT work. docker bug?</span>
<span class="c"># RUN chmod u+s /usr/local/bin/gosu</span>

<span class="k">FROM</span> <span class="s">debian:9</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get install -y vim  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>gosu /usr/local /usr/local
<span class="c"># Optionally add SUID bit so an unprivileged user can run as root (like sudo)</span>
<span class="k">RUN</span> chmod u+s /usr/local/bin/gosu
</pre></div>
</div>
</div>
<div class="section" id="ep-envplate">
<h3>ep - envplate<a class="headerlink" href="#ep-envplate" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 78%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>ep</p></td>
</tr>
<tr class="row-even"><td><p>Build Args</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">EP_VERSION</span></code> - Version of ep to download</p></td>
</tr>
<tr class="row-odd"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local</span></code></p></td>
</tr>
</tbody>
</table>
<p>ep is a simple way to apply bourne shell style variable name substitution to any generic configuration file for applications that do not support environment variable name substitution</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:ep</span> <span class="k">as</span> <span class="s">ep</span>
<span class="k">FROM</span> <span class="s">debian:9</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get install -y vim  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>ep /usr/local /usr/local
</pre></div>
</div>
</div>
<div class="section" id="jq-json-processor">
<h3>jq - JSON Processor<a class="headerlink" href="#jq-json-processor" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 78%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>jq</p></td>
</tr>
<tr class="row-even"><td><p>Build Args</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">JQ_VERSION</span></code> - Version of jq to download</p></td>
</tr>
<tr class="row-odd"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local</span></code></p></td>
</tr>
</tbody>
</table>
<p>jq is a lightweight and flexible command-line JSON processor</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:jq</span> <span class="k">as</span> <span class="s">jq</span>
<span class="k">FROM</span> <span class="s">debian:9</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get install -y vim  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>jq /usr/local /usr/local
</pre></div>
</div>
</div>
<div class="section" id="ninja">
<h3>ninja<a class="headerlink" href="#ninja" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>ninja</p></td>
</tr>
<tr class="row-even"><td><p>Build Args</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NINJA_VERSION</span></code> - Version of Ninja to download</p></td>
</tr>
<tr class="row-odd"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local</span></code></p></td>
</tr>
</tbody>
</table>
<p>Ninja is generally a better/faster alternative to GNU Make.</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:ninja</span> <span class="k">as</span> <span class="s">ninja</span>
<span class="k">FROM</span> <span class="s">debian:9</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get install -y vim  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>ninja /usr/local /usr/local
</pre></div>
</div>
</div>
<div class="section" id="docker">
<h3>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>Docker</p></td>
</tr>
<tr class="row-even"><td><p>Build Args</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DOCKER_VERSION</span></code> - Version of docker to download</p></td>
</tr>
<tr class="row-odd"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local</span></code> including <code class="docutils literal notranslate"><span class="pre">docker</span></code> and several other files.</p></td>
</tr>
</tbody>
</table>
<p>Docker is a tool for running container applications</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:docker</span> <span class="k">as</span> <span class="s">docker</span>
<span class="k">FROM</span> <span class="s">debian:9</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get install -y vim  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>docker /usr/local /usr/local
</pre></div>
</div>
</div>
<div class="section" id="docker-compose">
<h3>Docker compose<a class="headerlink" href="#docker-compose" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 86%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>docker compose</p></td>
</tr>
<tr class="row-even"><td><p>Build Args</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DOCKER_COMPOSE_VERSION</span></code> - Version of docker-compose to download</p></td>
</tr>
<tr class="row-odd"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local</span></code></p></td>
</tr>
</tbody>
</table>
<p>Tool for running simple docker orchestratioon, giving an organized way to run one or more dockers.</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:docker-compose</span> <span class="k">as</span> <span class="s">docker-compose</span>
<span class="k">FROM</span> <span class="s">debian:9</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get install -y vim  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>docker-compose /usr/local /usr/local
</pre></div>
</div>
<p>This recipe will work glibc and musl for verion 2.0.0 and newer. Version 1 would need to use docker-compose provided images for alpine: <code class="docutils literal notranslate"><span class="pre">docker/compose:alpine-${DOCKER_COMPOSE_VERSION}</span></code></p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">ARG</span> <span class="si">${</span><span class="nv">DOCKER_COMPOSE_VERSION</span><span class="p">-1.26.2</span><span class="si">}</span>
<span class="k">FROM</span> <span class="s">docker/compose:alpine-${DOCKER_COMPOSE_VERSION}</span> <span class="k">as</span> <span class="s">docker-compose</span>
<span class="k">FROM</span> <span class="s">alpine:3.11</span>
<span class="k">RUN</span> apk add --no-cache git  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>docker-compose /usr/local /usr/local
</pre></div>
</div>
</div>
<div class="section" id="git-large-file-support">
<h3>git Large File Support<a class="headerlink" href="#git-large-file-support" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>git lfs</p></td>
</tr>
<tr class="row-even"><td><p>Build Args</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GIT_LFS_VERSION</span></code> - Version of git-lfs to download</p></td>
</tr>
<tr class="row-odd"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local</span></code></p></td>
</tr>
</tbody>
</table>
<p>git-lfs gives git the ability to handle large files gracefully.</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:git-lfs</span> <span class="k">as</span> <span class="s">git-lfs</span>
<span class="k">FROM</span> <span class="s">debian:9</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get install -y vim  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>git-lfs /usr/local /usr/local
...
<span class="c"># Only needs to be run once for all recipes</span>
<span class="k">RUN</span> <span class="k">for</span> patch <span class="k">in</span> /usr/local/share/just/container_build_patch/*<span class="p">;</span> <span class="k">do</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</div>
</div>
<div class="section" id="cmake">
<h3>CMake<a class="headerlink" href="#cmake" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>CMake</p></td>
</tr>
<tr class="row-even"><td><p>Build Args</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CMAKE_VERSION</span></code> - Version of CMake to download</p></td>
</tr>
<tr class="row-odd"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local</span></code></p></td>
</tr>
</tbody>
</table>
<p>CMake is a cross-platform family of tools designed to build, test and package software</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:cmake</span> <span class="k">as</span> <span class="s">cmake</span>
<span class="k">FROM</span> <span class="s">debian:9</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get install -y vim  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>cmake /usr/local /usr/local
</pre></div>
</div>
</div>
<div class="section" id="pipenv">
<h3>Pipenv<a class="headerlink" href="#pipenv" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 8%" />
<col style="width: 92%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>Pipenv</p></td>
</tr>
<tr class="row-even"><td><p>Env Var</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PIPENV_VERSION</span></code> - Version of pipenv source to download</p></td>
</tr>
<tr class="row-odd"><td><p>Env Var</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PIPENV_VIRTUALENV</span></code> - The location of the pipenv virtualenv</p></td>
</tr>
<tr class="row-even"><td><p>Env Var</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PIPENV_PYTHON</span></code> - Optional default python executable to use. This is useful when combined with the “Conda’s Python” recipe</p></td>
</tr>
<tr class="row-odd"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local</span></code></p></td>
</tr>
</tbody>
</table>
<p>Pipenv is the new way to manage python requirements (within a virtualenv) on project.</p>
<p>Since this is setting up a virtualenv, you can’t just move <code class="docutils literal notranslate"><span class="pre">/usr/local/pipenv</span></code> to anywhere in the destination image, it must created in the correct location. If this needs to be changed, adjust the <code class="docutils literal notranslate"><span class="pre">PIPENV_VIRTUALENV</span></code> arg.</p>
<p>The default python will be used when <a class="reference internal" href="get-pipenv.auto.html#get-pipenv"><span class="std std-ref">Get Pipenv</span></a> is called. The default python is used for all other pipenv calls. In order to customize the default python interpreter used, set the <code class="docutils literal notranslate"><span class="pre">PYTHON</span></code> build arg, or else you will need to use the <code class="docutils literal notranslate"><span class="pre">--python/--two/--three</span></code> flags when calling <code class="docutils literal notranslate"><span class="pre">pipenv</span></code>.</p>
<p>This recipe is a little different from other recipes in that it’s just a script to set up the virtualenv in the destination image. Virtualenvs have to be done this way due to their non-portable nature; this is especially true because this virtualenv creates other virtutalenvs that need to point to the system python.</p>
<p>A script called <code class="docutils literal notranslate"><span class="pre">fake_package</span></code> is added to the pipenv virtualenv, this script is useful for creating fake editable packages, that will be mounted in at run time.</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:pipenv</span> <span class="k">as</span> <span class="s">pipenv</span>
<span class="k">FROM</span> <span class="s">debian:9</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get install -y vim  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>pipenv /usr/local /usr/local
...
<span class="c"># Only needs to be run once for all recipes</span>
<span class="k">RUN</span> <span class="k">for</span> patch <span class="k">in</span> /usr/local/share/just/container_build_patch/*<span class="p">;</span> <span class="k">do</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</div>
</div>
<div class="section" id="amanda-debian-packages">
<h3>Amanda debian packages<a class="headerlink" href="#amanda-debian-packages" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 84%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>Amanda</p></td>
</tr>
<tr class="row-even"><td><p>Build Args</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AMANDA_VERSION</span></code> - Branch name to build off of (can be a SHA)</p></td>
</tr>
<tr class="row-odd"><td><p>Output files</p></td>
<td><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/amanda-backup-client_${AMANDA_VERSION}-1Debian82_amd64.deb</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/amanda-backup-server{AMANDA_VERSION}-1Debian82_amd64.deb</span></code></p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Complies Debian packages for the tape backup software Amanda</p>
</div>
<div class="section" id="one-true-awk">
<h3>One True Awk<a class="headerlink" href="#one-true-awk" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>One True Awk</p></td>
</tr>
<tr class="row-even"><td><p>Build Args</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ONETRUEAWK_VERSION</span></code> - Version of one true awk to download</p></td>
</tr>
<tr class="row-odd"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local</span></code></p></td>
</tr>
</tbody>
</table>
<p><a class="reference external" href="https://github.com/onetrueawk/awk">https://github.com/onetrueawk/awk</a> is a severly limited version awk that some primative operating systems use. This recipe will help in testing against that version.</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:onetrueawk</span> <span class="k">as</span> <span class="s">onetrueawk</span>
<span class="k">FROM</span> <span class="s">debian:9</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get install -y vim  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>onetrueawk /usr/local /usr/local
</pre></div>
</div>
</div>
<div class="section" id="gdal">
<h3>GDAL<a class="headerlink" href="#gdal" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 79%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>GDAL</p></td>
</tr>
<tr class="row-even"><td><p>Build Args</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GDAL_VERSION</span></code> - Version of GDAL to download</p></td>
</tr>
<tr class="row-odd"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local</span></code></p></td>
</tr>
</tbody>
</table>
<p>Compiles GDAL v3, including OPENJPEG 2.4, ECW J2K 5.5, libtiff4.3, libgeotiff 1.7, PROJ v8</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:gdal</span> <span class="k">as</span> <span class="s">gdal</span>
<span class="k">FROM</span> <span class="s">python:3.8</span>
<span class="k">COPY</span> --from<span class="o">=</span>gdal /usr/local /usr/local

<span class="c"># numpy must be installed before GDAL python bindings</span>
<span class="k">RUN</span> pip install numpy<span class="p">;</span> <span class="se">\</span>
    pip install <span class="nv">GDAL</span><span class="o">==</span><span class="k">$(</span>cat /usr/local/gdal_version<span class="k">)</span><span class="p">;</span>

<span class="c"># Only needs to be run once for all recipes</span>
<span class="k">RUN</span> <span class="k">for</span> patch <span class="k">in</span> /usr/local/share/just/container_build_patch/*<span class="p">;</span> <span class="k">do</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</div>
</div>
<div class="section" id="conda-s-python">
<h3>Conda’s python<a class="headerlink" href="#conda-s-python" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>Python</p></td>
</tr>
<tr class="row-even"><td><p>Build Args</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PYTHON_VERSION</span></code> - Version of python to download</p></td>
</tr>
<tr class="row-odd"><td><p>Output dir</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local</span></code></p></td>
</tr>
</tbody>
</table>
<p>This is not a recipe for installing anaconda or miniconda, rather it internally uses miniconda to install a “not” conda python. This python will still bare the markings of Anaconda, but does not have all the conda modifications, and works as a normal and extremely portable version of python for glibc linux.</p>
<p>See <a class="reference external" href="https://anaconda.org/anaconda/python/files">https://anaconda.org/anaconda/python/files</a> for values of <code class="docutils literal notranslate"><span class="pre">PYTHON_VERSION</span></code></p>
<p>This is the easiest way to install an arbitrary version of python on an arbitrary linux distro.</p>
<p class="rubric">Example</p>
<div class="highlight-Dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">vsiri/recipe:conda-python</span> <span class="k">as</span> <span class="s">python</span>
<span class="k">FROM</span> <span class="s">ubuntu:16.04</span>
<span class="k">RUN</span> apt-get update<span class="p">;</span> apt-get install -y vim  # This line is just an example
<span class="k">COPY</span> --from<span class="o">=</span>python /usr/local /usr/local
</pre></div>
</div>
</div>
</div>
<div class="section" id="j-u-s-t">
<h2>J.U.S.T.<a class="headerlink" href="#j-u-s-t" title="Permalink to this headline">¶</a></h2>
<p>To define the “build recipes” target, add this to your <code class="docutils literal notranslate"><span class="pre">Justfile</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/just_files/just_docker_functions.bsh&quot;</span>
</pre></div>
</div>
<p>And add <code class="docutils literal notranslate"><span class="pre">justify</span> <span class="pre">build</span> <span class="pre">recipes</span></code> to any Justfile target that is responsible for building docker images.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="get-pipenv.auto.html" class="btn btn-neutral float-right" title="Get Pipenv" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../../python/vsi.windows.html" class="btn btn-neutral float-left" title="vsi.windows package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Vision Systems, Inc.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>