<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Compatibility Variables &mdash; VSI Common 0.2.2+1dev documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Singularity Compatibility Variables" href="compat_singularity.auto.html" />
    <link rel="prev" title="Common Source" href="common_source.auto.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            VSI Common
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../just/index.html">J.U.S.T. Useful Simple Tasking</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Linux Utilities</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="aliases.auto.html">Executable Aliases</a></li>
<li class="toctree-l2"><a class="reference internal" href="ask_question.auto.html">Ask Question</a></li>
<li class="toctree-l2"><a class="reference internal" href="bash_utils.auto.html">Bash Utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="bin_utils.auto.html">Binary Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="check_shell.auto.html">Check Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="circular_source.auto.html">Circular source</a></li>
<li class="toctree-l2"><a class="reference internal" href="colors.auto.html">Colors Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_tools.auto.html">Command Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_source.auto.html">Common Source</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Compatibility Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sed-flags">Sed flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="#date">Date</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bash">Bash</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#detecting-declared-unset-variables">Detecting declared unset variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#git">Git</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tar">Tar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#readlink">readlink</a></li>
<li class="toctree-l3"><a class="reference internal" href="#realpath">realpath</a></li>
<li class="toctree-l3"><a class="reference internal" href="#singularity">singularity</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="compat_singularity.auto.html">Singularity Compatibility Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="cuda_info.auto.html">CUDA Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="dir_tools.auto.html">Directory Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="elements.auto.html">Array Manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="file_tools.auto.html">File Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="findin.auto.html">Find In</a></li>
<li class="toctree-l2"><a class="reference internal" href="findinpaths.auto.html">Find In Paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="git_airgap_submodule_helper.auto.html">Git Airgap Submodule Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="git_commit_description.auto.html">Git Commit Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="git_functions.auto.html">Git Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="git_mirror.auto.html">Git Mirror</a></li>
<li class="toctree-l2"><a class="reference internal" href="group_names.auto.html">Group Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="inisin.auto.html">In Is In</a></li>
<li class="toctree-l2"><a class="reference internal" href="isin.auto.html">Is In</a></li>
<li class="toctree-l2"><a class="reference internal" href="linux_accounts.auto.html">Linux Accounts</a></li>
<li class="toctree-l2"><a class="reference internal" href="lwhich.auto.html">Lwhich</a></li>
<li class="toctree-l2"><a class="reference internal" href="mount_tools.auto.html">Mount Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="nvidia_tools.auto.html">NVIDIA TOOLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="parser.auto.html">Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="pdbd.auto.html">PBDB - Primitive Bash Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="picker.auto.html">Picker</a></li>
<li class="toctree-l2"><a class="reference internal" href="pipenv_functions.auto.html">Pipenv Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="portable_patch.auto.html">Poratble Patch</a></li>
<li class="toctree-l2"><a class="reference internal" href="postisin.auto.html">Postisin</a></li>
<li class="toctree-l2"><a class="reference internal" href="preisin.auto.html">Preisin</a></li>
<li class="toctree-l2"><a class="reference internal" href="print_command.auto.html">Print Command</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_tools.auto.html">Python Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="quotemire.auto.html">Quotemire</a></li>
<li class="toctree-l2"><a class="reference internal" href="random.auto.html">Random</a></li>
<li class="toctree-l2"><a class="reference internal" href="real_path.auto.html">Real Path</a></li>
<li class="toctree-l2"><a class="reference internal" href="reisin.auto.html">Regular Expression Is In</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.auto.html">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="set_flags.auto.html">Set Flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="signal_tools.auto.html">String Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="source_once.auto.html">Source once</a></li>
<li class="toctree-l2"><a class="reference internal" href="string_tools.auto.html">String Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="time_tools.auto.html">Time Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="uwecho.auto.html">Unwrapping Echo</a></li>
<li class="toctree-l2"><a class="reference internal" href="versions.auto.html">Versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_tools.auto.html">Web Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="yarp.auto.html">Yarp</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_scripts/modules.html">Pyhton Scripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../windows/index.html">Windows Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tests/index.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/modules.html">vsi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker/recipes/get-pipenv.auto.html">Get Pipenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker/recipes/pip-8210.auto.html">pip 8210</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker/recipes/index.html">Docker recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../style.html">Contributing Style Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VSI Common</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Linux Utilities</a></li>
      <li class="breadcrumb-item active">Compatibility Variables</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/linux/compat.auto.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="compatibility-variables">
<h1>Compatibility Variables<a class="headerlink" href="#compatibility-variables" title="Permalink to this heading"></a></h1>
<dl class="bash file">
<dt class="sig sig-object bash" id="file-compat.bsh">
<span class="sig-name descname"><span class="pre">compat.bsh</span></span><a class="headerlink" href="#file-compat.bsh" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>A collection of variables to help cope with the differences between different operating systems and versions.</p>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh load_vsi_compat">
<span class="sig-name descname"><span class="pre">load_vsi_compat</span></span><a class="headerlink" href="#function-compat.bsh load_vsi_compat" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Typically, this does not need to be called directly. <a class="reference internal" href="#function-compat.bsh load_vsi_compat"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">load_vsi_compat</span></code></a> is run automatically when <a class="reference internal" href="#file-compat.bsh"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">compat.bsh</span></code></a> is sourced. However, if you need to reload the variables, e.g. <span class="target" id="index-0"></span><a class="reference internal" href="#envvar-VSI_SED_COMPAT"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">VSI_SED_COMPAT</span></code></a> is set and you want to get the forced compatibility flags, then you could call <a class="reference internal" href="#function-compat.bsh load_vsi_compat"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">load_vsi_compat</span></code></a>, but this would be extremely rare.</p>
<section id="sed-flags">
<h2>Sed flags<a class="headerlink" href="#sed-flags" title="Permalink to this heading"></a></h2>
<p>While most flags between GNU and BSD (macOS) sed are fairly compatible, a few create issues in corner cases.</p>
<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-VSI_SED_COMPAT">
<span class="sig-name descname"><span class="pre">VSI_SED_COMPAT</span></span><a class="headerlink" href="#envvar-VSI_SED_COMPAT" title="Permalink to this definition"></a></dt>
<dd><p>Force <code class="docutils literal notranslate"><span class="pre">bsd</span></code> or <code class="docutils literal notranslate"><span class="pre">gnu</span></code> mode when loading the <code class="docutils literal notranslate"><span class="pre">sed</span></code> flags</p>
</dd></dl>

<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh load_vsi_compat sed_flag_rE">
<span class="sig-name descname"><span class="pre">sed_flag_rE</span></span><a class="headerlink" href="#var-compat.bsh load_vsi_compat sed_flag_rE" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Flag to enable extended regex support in sed. The GNU flag is <code class="docutils literal notranslate"><span class="pre">-r</span></code>, while the BSD flag is <code class="docutils literal notranslate"><span class="pre">-E</span></code>. macOS does not support <code class="docutils literal notranslate"><span class="pre">-r</span></code> and GNU sed prior to 4.2 does not accept <code class="docutils literal notranslate"><span class="pre">-E</span></code>. Using this variable should always yield the correct flag.</p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sed<span class="w"> </span><span class="s2">&quot;-</span><span class="si">${</span><span class="nv">sed_flag_rE</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s1">&#39;s|foo(.*)|bar\1.|&#39;</span>
</pre></div>
</div>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh load_vsi_compat sed_flags_i">
<span class="sig-name descname"><span class="pre">sed_flags_i</span></span><a class="headerlink" href="#var-compat.bsh load_vsi_compat sed_flags_i" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>When using inplace replacement on sed, the macOS version requires an argument to the <code class="docutils literal notranslate"><span class="pre">-i</span></code> flag, the extension added to the output file. The GNU version does not support this. Using this flag will perform an inplace replacement with no added extension. The <a class="reference internal" href="#var-compat.bsh load_vsi_compat sed_flags_i"><code class="xref bash bash-var docutils literal notranslate"><span class="pre">sed_flags_i</span></code></a> cannot be combined with other flags (see example below).</p>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sed<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">sed_flags_i</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s1">&#39;s|foo|bar|&#39;</span><span class="w"> </span>some_file.txt

<span class="c1"># Not ok</span>
sed<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">sed_flags_i</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>...
<span class="c1"># Not ok</span>
sed<span class="w"> </span>-<span class="s2">&quot;</span><span class="si">${</span><span class="nv">sed_flags_i</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>...
<span class="c1"># Not ok</span>
sed<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">sed_flags_i</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>n<span class="w"> </span>...
<span class="c1"># This is ok</span>
sed<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">sed_flags_i</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-n<span class="w"> </span>...
</pre></div>
</div>
</section>
<section id="date">
<h2>Date<a class="headerlink" href="#date" title="Permalink to this heading"></a></h2>
<p>The following variables will help cope with the difference in the <code class="docutils literal notranslate"><span class="pre">date</span></code> command as seamlessly as possible.</p>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh load_vsi_compat date_feature_nanoseconds">
<span class="sig-name descname"><span class="pre">date_feature_nanoseconds</span></span><a class="headerlink" href="#var-compat.bsh load_vsi_compat date_feature_nanoseconds" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Non-GNU versions of <code class="docutils literal notranslate"><span class="pre">date</span></code> do not support the nanosecond sequence for a date format (e.g. BSD and busybox).</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Supports nanosecond precision <code class="docutils literal notranslate"><span class="pre">%N</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Does not support nanoseconds</p></li>
</ul>
</dd>
</dl>
</section>
<section id="bash">
<h2>Bash<a class="headerlink" href="#bash" title="Permalink to this heading"></a></h2>
<p>The following variables will help cope with the difference in bash versions as seamlessly as possible.</p>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh load_vsi_compat bash_feature_posix_process_substitution">
<span class="sig-name descname"><span class="pre">bash_feature_posix_process_substitution</span></span><a class="headerlink" href="#var-compat.bsh load_vsi_compat bash_feature_posix_process_substitution" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>In bash 5.0 and older, process substitution isn’t allowed when in posix mode. This issue can arise if a function contains non-posix commands and is exported before calling <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">--posix</span></code>. Bash will complain about each and every function that is non-posix.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Bash does not allow process substitution in posix mode</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Bash allows process substitution in posix mode</p></li>
</ul>
</dd>
</dl>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>foo<span class="o">()</span>
<span class="o">{</span>
<span class="w">  </span>cat<span class="w"> </span>&lt;<span class="o">(</span><span class="nb">echo</span><span class="w"> </span>hi<span class="o">)</span>
<span class="o">}</span>
<span class="nb">export</span><span class="w"> </span>-f<span class="w"> </span>foo
bash<span class="w"> </span>--posix
</pre></div>
</div>
<p>One solution is to unexport any functions that might be causing an issue. Another is to ignore the error messages, and start bash without <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-e</span></code> and then enable <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-e</span></code> after starting the new shell.</p>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh load_vsi_compat bash_behavior_declare_array_quote">
<span class="sig-name descname"><span class="pre">bash_behavior_declare_array_quote</span></span><a class="headerlink" href="#var-compat.bsh load_vsi_compat bash_behavior_declare_array_quote" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>In bash version 4.3 and older, <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span></code> of an array adds an extra <code class="docutils literal notranslate"><span class="pre">'</span></code> around the array. This variable stores the state of that variable</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>(null)</strong> - Bash 4.4 or newer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'</span></code> - Bash 4.3 or older</p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh load_vsi_compat bash_feature_parameter_transformation">
<span class="sig-name descname"><span class="pre">bash_feature_parameter_transformation</span></span><a class="headerlink" href="#var-compat.bsh load_vsi_compat bash_feature_parameter_transformation" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Does bash support Parameter Transformations, e.g. <code class="docutils literal notranslate"><span class="pre">${var&#64;a}</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Bash does support parameter transformations (Bash 4.4 or newer)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Bash does not support parameter transformations</p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh load_vsi_compat bash_feature_declare_array_escape_special_characters">
<span class="sig-name descname"><span class="pre">bash_feature_declare_array_escape_special_characters</span></span><a class="headerlink" href="#var-compat.bsh load_vsi_compat bash_feature_declare_array_escape_special_characters" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Starting in bash 4.4, <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span></code> of an array, will escape special characters such as tab (<code class="docutils literal notranslate"><span class="pre">\t</span></code>) and newline (<code class="docutils literal notranslate"><span class="pre">\n</span></code>)</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Declare will escape special characters for arrays</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Declare uses literal versions of special characters, but still escapes quotes as <code class="docutils literal notranslate"><span class="pre">\&quot;</span></code></p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh load_vsi_compat bash_bug_exported_function_corrupt_bash_source">
<span class="sig-name descname"><span class="pre">bash_bug_exported_function_corrupt_bash_source</span></span><a class="headerlink" href="#var-compat.bsh load_vsi_compat bash_bug_exported_function_corrupt_bash_source" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Older versions of bash have a bug where exported functions can corrupt the <code class="docutils literal notranslate"><span class="pre">BASH_SOURCE</span></code> environment variable, and possibly <code class="docutils literal notranslate"><span class="pre">BASH_LINENO</span></code> too. A workaround is not always possible.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Bash source bug is present</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Bash source bug is not present</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span>x<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">3</span>.2<span class="w"> </span><span class="m">4</span>.0<span class="w"> </span><span class="m">4</span>.1<span class="w"> </span><span class="m">4</span>.2<span class="w"> </span><span class="m">4</span>.3<span class="w"> </span><span class="m">4</span>.4<span class="w"> </span><span class="m">5</span>.0<span class="w"> </span><span class="m">5</span>.1<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span><span class="s2">&quot;bash:</span><span class="si">${</span><span class="nv">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">      echo &#39;blah(){ declare -p BASH_SOURCE; }</span>
<span class="s2">            export -f blah</span>
<span class="s2">            bash /tmp/bar&#39; &gt; /tmp/foo</span>
<span class="s2">      echo &#39;declare -p BASH_SOURCE</span>
<span class="s2">            blah</span>
<span class="s2">            declare -p BASH_SOURCE&#39; &gt; /tmp/bar</span>
<span class="s2">      bash /tmp/foo&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>

<span class="c1"># Bash 4.3</span>
<span class="c1"># declare -a BASH_SOURCE=&#39;([0]=&quot;/tmp/bar&quot;)&#39;</span>
<span class="c1"># declare -a BASH_SOURCE=&#39;([1]=&quot;/tmp/bar&quot;)&#39;</span>
<span class="c1"># declare -a BASH_SOURCE=&#39;()&#39;</span>
<span class="c1"># Bash 4.4</span>
<span class="c1"># declare -a BASH_SOURCE=([0]=&quot;/tmp/bar&quot;)</span>
<span class="c1"># declare -a BASH_SOURCE=([0]=&quot;environment&quot; [1]=&quot;/tmp/bar&quot;)</span>
<span class="c1"># declare -a BASH_SOURCE=([0]=&quot;/tmp/bar&quot;)</span>
</pre></div>
</div>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh load_vsi_compat bash_feature_declare_name_reffing">
<span class="sig-name descname"><span class="pre">bash_feature_declare_name_reffing</span></span><a class="headerlink" href="#var-compat.bsh load_vsi_compat bash_feature_declare_name_reffing" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Do bash variables support name reffing</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Bash does support name reffing (Bash 4.3 or newer)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Bash does not support name reffing</p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh load_vsi_compat bash_feature_declare_print_function">
<span class="sig-name descname"><span class="pre">bash_feature_declare_print_function</span></span><a class="headerlink" href="#var-compat.bsh load_vsi_compat bash_feature_declare_print_function" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Does <code class="docutils literal notranslate"><span class="pre">declare</span></code> support printing a function via <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-pf</span> <span class="pre">function_name</span></code>. Work around: use <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-F</span></code> to list all functions and <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">function_name</span></code> or <code class="docutils literal notranslate"><span class="pre">command</span> <span class="pre">-V</span> <span class="pre">function_name</span></code>, however the first line needs to be removed.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - <code class="docutils literal notranslate"><span class="pre">declare</span></code> supports printing a function</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - <code class="docutils literal notranslate"><span class="pre">declare</span></code> does not support printing a specific function.</p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh load_vsi_compat bash_bug_local_shadow_exported_variable">
<span class="sig-name descname"><span class="pre">bash_bug_local_shadow_exported_variable</span></span><a class="headerlink" href="#var-compat.bsh load_vsi_compat bash_bug_local_shadow_exported_variable" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>In bash 4.2 and older, a local variable can shadow an exported variable, obscuring it from children processes. This is a confusing behavior that has to occasionally be corrected.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Local variables shadow exported variable in children processes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Local variables do not shadow exported variable</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">12</span>
<span class="k">function</span><span class="w"> </span>foo<span class="o">()</span>
<span class="o">{</span>
<span class="w">  </span><span class="nb">local</span><span class="w"> </span>x
<span class="w">  </span><span class="nb">declare</span><span class="w"> </span>-p<span class="w"> </span>x<span class="w">        </span><span class="c1"># in the x=11 case, this is 11?!</span>
<span class="w">  </span><span class="c1"># export x          # Doesn&#39;t make a difference. x is already exported</span>
<span class="w">  </span><span class="nb">compgen</span><span class="w"> </span>-A<span class="w"> </span><span class="nb">export</span><span class="w"> </span>x<span class="w"> </span><span class="c1"># compgen always sees x, shadowed or not.</span>
<span class="w">  </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;declare -p x&quot;</span>
<span class="o">}</span>
foo
<span class="c1"># x will be undefined when bash_bug_local_shadow_exported_variable is 0</span>
<span class="c1"># x will be 12 when bash_bug_local_shadow_exported_variable is 1</span>
<span class="nb">export</span><span class="w"> </span>-f<span class="w"> </span>foo<span class="p">;</span><span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">11</span><span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span>foo<span class="w"> </span><span class="c1"># Same result as above</span>
<span class="nv">x</span><span class="o">=</span><span class="m">13</span><span class="w"> </span>foo<span class="w"> </span><span class="c1"># x is always 13 and in the bash child too. No explanation for this behavior</span>
</pre></div>
</div>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh load_vsi_compat bash_bug_allocate_xtracefd">
<span class="sig-name descname"><span class="pre">bash_bug_allocate_xtracefd</span></span><a class="headerlink" href="#var-compat.bsh load_vsi_compat bash_bug_allocate_xtracefd" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>In Bash 4.1 and 4.2, there is a bug where the following command does not work right:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">exec</span><span class="w"> </span><span class="o">{</span>BASH_XTRACEFD<span class="o">}</span>&gt;<span class="s2">&quot;somefile&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">BASH_XTRACEFD</span></code>’s value is set, but whatever triggers <code class="docutils literal notranslate"><span class="pre">BASH_XTRACEFD</span></code> to work, is not triggered.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">BASH_XTRACEFD</span></code> and automatic file descriptor allocation are not available features in bash 4.0 or older, but <a class="reference internal" href="#var-compat.bsh load_vsi_compat bash_bug_allocate_xtracefd"><code class="xref bash bash-var docutils literal notranslate"><span class="pre">bash_bug_allocate_xtracefd</span></code></a> will still be set to <code class="docutils literal notranslate"><span class="pre">0</span></code></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://github.com/cylc/cylc-flow/pull/3572#pullrequestreview-398453037">https://github.com/cylc/cylc-flow/pull/3572#pullrequestreview-398453037</a></p>
</div>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote">
<span class="sig-name descname"><span class="pre">bash_behavior_pattern_substitution_slash_escape_with_single_quote</span></span><a class="headerlink" href="#function-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>A pattern substitution with single quotes and backslashes is hard to get right. In bash 4.2 and older, if the string contains backslashes, the results of pattern substitution changes when quotes are added around the expression. In bash 4.3, surrounding quotes don’t affect the substitution, however, extra slashes are needed if the string contains a single quote.</p>
<p>When surrounding quotes are always used, <a class="reference internal" href="#function-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">bash_behavior_pattern_substitution_slash_escape_with_single_quote</span></code></a> gives a way to determine if extra back slashes are needed.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>‘0’ - On bash 4.3 and newer</p></li>
<li><p>‘1’ - On bash 4.2 and older</p></li>
</ul>
</dd>
</dl>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bash 4.2</span>
$<span class="w"> </span><span class="o">(</span><span class="nv">FOOBAR</span><span class="o">=</span><span class="s2">&quot;o&#39;o&quot;</span><span class="p">;</span><span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">FOOBAR</span><span class="p">//</span><span class="se">\&#39;</span><span class="p">/</span><span class="se">\\\&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="nb">declare</span><span class="w"> </span>-p<span class="w"> </span>x<span class="o">)</span>
<span class="nb">declare</span><span class="w"> </span>--<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="s2">&quot;o\\\\&#39;o&quot;</span>
$<span class="w"> </span><span class="o">(</span><span class="nv">FOOBAR</span><span class="o">=</span><span class="s2">&quot;o&#39;o&quot;</span><span class="p">;</span><span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="si">${</span><span class="nv">FOOBAR</span><span class="p">//</span><span class="se">\&#39;</span><span class="p">/</span><span class="se">\\\&#39;</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="nb">declare</span><span class="w"> </span>-p<span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="c1"># Notice the no quotes after =</span>
<span class="nb">declare</span><span class="w"> </span>--<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="s2">&quot;o\\&#39;o&quot;</span>

<span class="c1"># Bash 4.3</span>
$<span class="w"> </span><span class="o">(</span><span class="nv">FOOBAR</span><span class="o">=</span><span class="s2">&quot;o&#39;o&quot;</span><span class="p">;</span><span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="si">${</span><span class="nv">FOOBAR</span><span class="p">//</span><span class="se">\&#39;</span><span class="p">/</span><span class="se">\\\\\&#39;</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="nb">declare</span><span class="w"> </span>-p<span class="w"> </span>x<span class="o">)</span><span class="w"> </span><span class="c1"># Notice the no quotes after =</span>
<span class="nb">declare</span><span class="w"> </span>--<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="s2">&quot;o\\\\&#39;o&quot;</span>
$<span class="w"> </span><span class="o">(</span><span class="nv">FOOBAR</span><span class="o">=</span><span class="s2">&quot;o&#39;o&quot;</span><span class="p">;</span><span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">FOOBAR</span><span class="p">//</span><span class="se">\&#39;</span><span class="p">/</span><span class="se">\\\\\&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="nb">declare</span><span class="w"> </span>-p<span class="w"> </span>x<span class="o">)</span>
<span class="nb">declare</span><span class="w"> </span>--<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="s2">&quot;o\\\\&#39;o&quot;</span>

<span class="c1"># Compatible way</span>
$<span class="w"> </span><span class="nv">FOOBAR</span><span class="o">=</span><span class="s2">&quot;o&#39;o&quot;</span>
$<span class="w"> </span><span class="k">if</span><span class="w"> </span>bash_behavior_pattern_substitution_slash_escape_with_single_quote<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">x</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">FOOBAR</span><span class="p">//</span><span class="se">\&#39;</span><span class="p">/</span><span class="se">\\\\\&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nv">y</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">FOOBAR</span><span class="p">//</span><span class="se">\&#39;</span><span class="p">/</span><span class="se">\\\&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="nv">x</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">FOOBAR</span><span class="p">//</span><span class="se">\&#39;</span><span class="p">/</span><span class="se">\\\&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nv">y</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">FOOBAR</span><span class="p">//</span><span class="se">\&#39;</span><span class="p">/</span><span class="se">\&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">  </span><span class="k">fi</span>
$<span class="w"> </span><span class="nb">declare</span><span class="w"> </span>-p<span class="w"> </span>FOOBAR<span class="w"> </span>x<span class="w"> </span>y
<span class="nb">declare</span><span class="w"> </span>--<span class="w"> </span><span class="nv">FOOBAR</span><span class="o">=</span><span class="s2">&quot;o&#39;o&quot;</span>
<span class="nb">declare</span><span class="w"> </span>--<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="s2">&quot;o\\\\&#39;o&quot;</span>
<span class="nb">declare</span><span class="w"> </span>--<span class="w"> </span><span class="nv">y</span><span class="o">=</span><span class="s2">&quot;o\\&#39;o&quot;</span>
</pre></div>
</div>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_declare_global">
<span class="sig-name descname"><span class="pre">bash_feature_declare_global</span></span><a class="headerlink" href="#var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_declare_global" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Does bash support declaring global variables with the <code class="docutils literal notranslate"><span class="pre">declare</span></code> command.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Bash supports <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-g</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Bash does not support <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-g</span></code></p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_behavior_all_traps_display_inherited">
<span class="sig-name descname"><span class="pre">bash_behavior_all_traps_display_inherited</span></span><a class="headerlink" href="#var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_behavior_all_traps_display_inherited" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>When a subshell is spawned, the ERR/RETURN/DEBUG traps always show up in <code class="docutils literal notranslate"><span class="pre">trap</span> <span class="pre">-p</span></code> even if they are not actually inherited. (<code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-E</span></code> and <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-T</span></code> control whether these traps are actually inherited or not). This is an annoying behavior bash has and it makes determining which traps are actually active impossible to determine. Starting in bash 4.2, all signals started observing this behavior. This was done on purpose, but really makes tracking traps harder.</p>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_printf_array_assignment">
<span class="sig-name descname"><span class="pre">bash_feature_printf_array_assignment</span></span><a class="headerlink" href="#var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_printf_array_assignment" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Does <code class="docutils literal notranslate"><span class="pre">printf</span> <span class="pre">-v</span></code> support storing to array variables</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - <code class="docutils literal notranslate"><span class="pre">printf</span></code> does support storing to arrays (Bash 4.1 or newer)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - <code class="docutils literal notranslate"><span class="pre">printf</span></code> only supports storing to non-array variables</p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_allocate_file_descriptor">
<span class="sig-name descname"><span class="pre">bash_feature_allocate_file_descriptor</span></span><a class="headerlink" href="#var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_allocate_file_descriptor" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Does <code class="docutils literal notranslate"><span class="pre">exec</span> <span class="pre">{varname}&gt;&amp;1</span></code> work.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - <code class="docutils literal notranslate"><span class="pre">exec</span></code> can auto allocate an unused file descriptor</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - File descriptors must be manually allocated.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="file_tools.auto.html#function-file_tools.bsh find_open_fd"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">file_tools.bsh</span> <span class="pre">find_open_fd</span></code></a></p>
</div>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_xtracefd">
<span class="sig-name descname"><span class="pre">bash_feature_xtracefd</span></span><a class="headerlink" href="#var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_xtracefd" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Does bash support the <code class="docutils literal notranslate"><span class="pre">BASH_XTRACEFD</span></code> environment variable</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Bash supports <code class="docutils literal notranslate"><span class="pre">BASH_XTRACEFD</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Bash does not support <code class="docutils literal notranslate"><span class="pre">BASH_XTRACEFD</span></code></p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_associative_array">
<span class="sig-name descname"><span class="pre">bash_feature_associative_array</span></span><a class="headerlink" href="#var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_associative_array" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Does bash have associative arrays</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> Bash does have associative arrays (4.0 or newer)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> Bash does not have associative arrays (3.2)</p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_bashpid">
<span class="sig-name descname"><span class="pre">bash_feature_bashpid</span></span><a class="headerlink" href="#var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_bashpid" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Does bash have a <code class="docutils literal notranslate"><span class="pre">BASHPID</span></code> variable. This is more accurate than <code class="docutils literal notranslate"><span class="pre">$$</span></code> when it comes to subshells.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> Bash sets <code class="docutils literal notranslate"><span class="pre">BASHPID</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> Only <code class="docutils literal notranslate"><span class="pre">$$</span></code> is set, see <a class="reference internal" href="signal_tools.auto.html#function-signal_tools.bsh set_bashpid"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">signal_tools.bsh</span> <span class="pre">set_bashpid</span></code></a></p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_case_modification">
<span class="sig-name descname"><span class="pre">bash_feature_case_modification</span></span><a class="headerlink" href="#var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_feature_case_modification" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Does bash support <code class="docutils literal notranslate"><span class="pre">${x^}/${x^^}/${x,}/${x,,}</span></code> parameter substitution</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> Bash supports case modification</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> Bash does not supports case modification</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="string_tools.auto.html#function-string_tools.bsh lowercase"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">string_tools.bsh</span> <span class="pre">lowercase</span></code></a>, <a class="reference internal" href="string_tools.auto.html#function-string_tools.bsh uppercase"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">string_tools.bsh</span> <span class="pre">uppercase</span></code></a></p>
</div>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_bug_unassigned_variable_set_to_null">
<span class="sig-name descname"><span class="pre">bash_bug_unassigned_variable_set_to_null</span></span><a class="headerlink" href="#var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_bug_unassigned_variable_set_to_null" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>There is a bug, fixed in bash 4.0, that causes an unassigned variable to be set to null</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> Bash has the bug</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> An unassigned variable works as expected</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>x<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">3</span>.2<span class="w"> </span><span class="m">4</span>.0<span class="w"> </span><span class="m">4</span>.1<span class="w"> </span><span class="m">4</span>.2<span class="w"> </span><span class="m">4</span>.3<span class="w"> </span><span class="m">4</span>.4<span class="w"> </span><span class="m">5</span>.0<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span>bash:<span class="si">${</span><span class="nv">x</span><span class="si">}</span><span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="se">\</span>
<span class="w">      </span><span class="s1">&#39;function foo() { \</span>
<span class="s1">         local y; \</span>
<span class="s1">         echo &quot;y=${y+y_set}&quot;; \</span>
<span class="s1">       }; \</span>
<span class="s1">       foo; \</span>
<span class="s1">       echo $?&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="k">done</span>
<span class="c1"># In bash 3.2:</span>
<span class="c1"># y=y_set</span>
<span class="c1"># 0</span>
<span class="c1"># In bash &gt;= 4:</span>
<span class="c1"># y=</span>
<span class="c1"># 0</span>
</pre></div>
</div>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_bug_uncaught_unbound_on_exit_trap">
<span class="sig-name descname"><span class="pre">bash_bug_uncaught_unbound_on_exit_trap</span></span><a class="headerlink" href="#var-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote bash_bug_uncaught_unbound_on_exit_trap" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>There is a bug in bash 3.2, where <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-u</span></code> will not return non-zero for an unbound variable if an <code class="docutils literal notranslate"><span class="pre">EXIT</span></code> trap is set. Unfortunately, there is no way to detect this happens in the <code class="docutils literal notranslate"><span class="pre">EXIT</span></code> trap code, nor is there any way to cope with it. This means an unbound variable could potentially go undetected.</p>
<p>This is probably related to a similar phenomena where and error code is lost by the trap being called.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> Bash has the bug</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> Unbound variables error as expected</p></li>
</ul>
</dd>
</dl>
<p>There is a bug in bash 3.2, where <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-e</span></code> will not trigger an error in the parent process when a subshell command fails. The subshell does trigger the error as expected, but it is not propagated to the parent, even though the return code is.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> Bash has the bug</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> Error from subshell statements are thrown as expected</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="w"> </span>-e
<span class="nb">echo</span><span class="w"> </span>hi
<span class="o">(</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span>inner
<span class="w">  </span><span class="nb">false</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;you won&#39;t ever see this&quot;</span>
<span class="o">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;You will only see this on some bash 3.2: </span><span class="nv">$?</span><span class="s2">&quot;</span>
</pre></div>
</div>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh bash_bug_bash_env_process_substitution">
<span class="sig-name descname"><span class="pre">bash_bug_bash_env_process_substitution</span></span><a class="headerlink" href="#function-compat.bsh bash_bug_bash_env_process_substitution" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>With most bash 3.2’s, using process substitution for the BASH_ENV env variable does not work as expected (for some reason.) A work around is to write to a temporary file instead. Since this can be expensive to test, it is not evaluated into a variable on load. Instead, this is a function that is called. The result is cached so that is does not need to be tested again. The feature has less to do with the exact version of bash, but rather how it is compiled or patched.</p>
<dl class="field-list simple">
<dt class="field-odd">Return Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - <code class="docutils literal notranslate"><span class="pre">BASH_ENV</span></code> does not support process substitution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - <code class="docutils literal notranslate"><span class="pre">BASH_ENV</span></code> works normally</p></li>
</ul>
</dd>
</dl>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh bash_feature_rcfile">
<span class="sig-name descname"><span class="pre">bash_feature_rcfile</span></span><a class="headerlink" href="#function-compat.bsh bash_feature_rcfile" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Depending on how bash is compiled (<code class="docutils literal notranslate"><span class="pre">-DSYS_BASHRC</span></code>), bash will use or ignore the <code class="docutils literal notranslate"><span class="pre">--rcfile</span></code> argument. This has to be tested by actually seeing if this works, so it is a function that is called on demand, instead of on <a class="reference internal" href="#file-compat.bsh"><code class="xref bash bash-file docutils literal notranslate"><span class="pre">compat.bsh</span></code></a> load.</p>
<dl class="field-list simple">
<dt class="field-odd">Return Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Bash supports <code class="docutils literal notranslate"><span class="pre">--rcfile</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Bash ignored <code class="docutils literal notranslate"><span class="pre">--rcfile</span></code></p></li>
</ul>
</dd>
</dl>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh __bash_bug_at_expansion_null_ifs">
<span class="sig-name descname"><span class="pre">__bash_bug_at_expansion_null_ifs</span></span><a class="headerlink" href="#function-compat.bsh __bash_bug_at_expansion_null_ifs" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>There is a bug, fixed in bash 4.4, that causes ${&#64;+”${&#64;}”} not to expand to multiple words when IFS is set to the empty string.</p>
<dl class="field-list simple">
<dt class="field-odd">Return Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - <code class="docutils literal notranslate"><span class="pre">${&#64;}</span></code> does not expand as expected when the IFS is set to ‘’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - <code class="docutils literal notranslate"><span class="pre">${&#64;}</span></code> expansion works as expected</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://tiswww.case.edu/php/chet/bash/CHANGES">https://tiswww.case.edu/php/chet/bash/CHANGES</a> Section ‘bash-4.4-rc1’ Change w</p>
</div>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh __bash_bug_at_expansion_null_ifs bash_feature_bashpid_read_only">
<span class="sig-name descname"><span class="pre">bash_feature_bashpid_read_only</span></span><a class="headerlink" href="#var-compat.bsh __bash_bug_at_expansion_null_ifs bash_feature_bashpid_read_only" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">BASHPID</span></code> variable is only only protected as read only in bash 4. Bash 5 releases this restriction (but does not release the restriction for any other read only variable)</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> <code class="docutils literal notranslate"><span class="pre">BASHPID</span></code> is read only</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> <code class="docutils literal notranslate"><span class="pre">BASHPID</span></code> is not read only</p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh __bash_bug_at_expansion_null_ifs bash_behavior_regex_special_characters_non_literal">
<span class="sig-name descname"><span class="pre">bash_behavior_regex_special_characters_non_literal</span></span><a class="headerlink" href="#var-compat.bsh __bash_bug_at_expansion_null_ifs bash_behavior_regex_special_characters_non_literal" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Most instances of bash require special characters to be literal in regular expressions (e.g. <code class="docutils literal notranslate"><span class="pre">$'\n'</span></code>). However, on operating systems such as alpine, a special character will be matched based in its non-literal form (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;\n&quot;</span></code>). This has nothing to do with the version of bash, but rather how it was compiled (regex might come from g++’s implementation).</p>
<p><a class="reference internal" href="#var-compat.bsh __bash_bug_at_expansion_null_ifs bash_behavior_regex_special_characters_non_literal"><code class="xref bash bash-var docutils literal notranslate"><span class="pre">bash_behavior_regex_special_characters_non_literal</span></code></a> will be set if the non-literal form works. Currently, the literal form always appears to work.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Non literal form works (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;\t&quot;</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Non literal form does not work</p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_regex_null_string">
<span class="sig-name descname"><span class="pre">bash_bug_regex_null_string</span></span><a class="headerlink" href="#var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_regex_null_string" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Most instances of bash allow a null string to be a valid regular expression, basically any string matches. However, on operating systems such as macOS, it fails to compile the regular expression, and does not match correctly, giving the opposite answer as all other operating systems. This has nothing to do with the version of bash, but rather how it was compiled (regex might come from g++’s implementation).</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - The null string for a pattern does not match correctly</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - The null string for a pattern does match correctly</p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_declare_fails_local_declared_unset_variable">
<span class="sig-name descname"><span class="pre">bash_bug_declare_fails_local_declared_unset_variable</span></span><a class="headerlink" href="#var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_declare_fails_local_declared_unset_variable" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Bash 4.3 has a bug where <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span> <span class="pre">var</span></code> fails if a local variable is declared, but unset. The workaround is to find the variable in <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Has declare fails bug</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Does not have the declare fails bug</p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_declare_fails_global_declared_unset_variable">
<span class="sig-name descname"><span class="pre">bash_bug_declare_fails_global_declared_unset_variable</span></span><a class="headerlink" href="#var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_declare_fails_global_declared_unset_variable" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Bash 4.0 to 4.3 has a bug where <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span> <span class="pre">var</span></code> fails if a global variable is declared, but has no set value. The workaround is to find the variable in <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Has declare fails bug</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Does not have the declare fails bug</p></li>
</ul>
</dd>
</dl>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_declared_unset_value">
<span class="sig-name descname"><span class="pre">bash_bug_declared_unset_value</span></span><a class="headerlink" href="#var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_declared_unset_value" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Bash 3.2 through 4.1 has a confusing behavior where unset declared variables appear to be set to null <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> instead of unset, in the output of <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span></code>. However these versions of bash do indeed have an “unset but declared state”, it just can’t be queried using the output of <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">=&quot;&quot;</span></code> - The characters seen after <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">varname</span></code></p></li>
<li><p><strong>(null)</strong></p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">declare</span><span class="w"> </span>x
<span class="k">if</span><span class="w"> </span><span class="nb">declare</span><span class="w"> </span>-p<span class="w"> </span>x<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>assert_str_eq<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">declare</span><span class="w"> </span>-p<span class="w"> </span>x<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;declare -p x</span><span class="si">${</span><span class="nv">bash_bug_declared_unset_value</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">fi</span>

<span class="c1"># How to detect if variable is unset but declared?</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Bash 3.2, <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span> <span class="pre">var</span></code> doesn’t look the same as <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span></code></p>
</div>
<section id="detecting-declared-unset-variables">
<h3>Detecting declared unset variables<a class="headerlink" href="#detecting-declared-unset-variables" title="Permalink to this heading"></a></h3>
<p>Unfortunately, there is no fool proof simple way to detect a declared unset variable. The <code class="docutils literal notranslate"><span class="pre">${var+set}</span></code> parameter substitution will let you know if a a variable is unset, and using if <a class="reference internal" href="#var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_declare_fails_local_declared_unset_variable"><code class="xref bash bash-var docutils literal notranslate"><span class="pre">bash_bug_declare_fails_local_declared_unset_variable</span></code></a>/<a class="reference internal" href="#var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_declare_fails_global_declared_unset_variable"><code class="xref bash bash-var docutils literal notranslate"><span class="pre">bash_bug_declare_fails_global_declared_unset_variable</span></code></a> is <code class="docutils literal notranslate"><span class="pre">1</span></code>, then <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span> <span class="pre">var_name</span></code> will let you know it is declared. If either of those bugs are set to <code class="docutils literal notranslate"><span class="pre">0</span></code>, then you have to fall back on <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span></code> and match the regex <code class="docutils literal notranslate"><span class="pre">$'(^|\n)declare</span> <span class="pre">--</span> <span class="pre">'&quot;${var_name}${bash_bug_declared_unset_value}&quot;$'(\n|$)'</span></code> to determine if it was declared. Unfortunately, in Bash 4.3 it is possible for another variable to be set to a value that can falsely match the regex. This is highly unlikely to happen by accident, but can be worked around using some sed (specific to bash 4.3’s <code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span></code> output)</p>
<p class="rubric">Bash 4.3 Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">declare</span><span class="w"> </span>x_15
$<span class="w"> </span><span class="nv">x_13</span><span class="o">=</span><span class="s1">$&#39;foo\ndeclare -- x_14\nbar&#39;</span>
$<span class="w"> </span><span class="nb">declare</span><span class="w"> </span>-p<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>x_15
<span class="nb">declare</span><span class="w"> </span>--<span class="w"> </span>x_15
$<span class="w"> </span><span class="nb">declare</span><span class="w"> </span>-p<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>x_14
<span class="nb">declare</span><span class="w"> </span>--<span class="w"> </span>x_14
$<span class="w"> </span><span class="nb">compgen</span><span class="w"> </span>-A<span class="w"> </span>variables<span class="w"> </span>x_1
x_13
$<span class="w"> </span><span class="nb">declare</span><span class="w"> </span>-p<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-E<span class="w"> </span><span class="s1">&#39;:combine</span>
<span class="s1">                       $bdone</span>
<span class="s1">                       N</span>
<span class="s1">                       bcombine</span>
<span class="s1">                       :done</span>
<span class="s1">                       # Remove all escaped quotes</span>
<span class="s1">                       s|\\&quot;||g</span>
<span class="s1">                       # Remove all values, so everything looks like a null value (and is guaranteed to be one line now)</span>
<span class="s1">                       s|&quot;[^&quot;]*&quot;|&quot;&quot;|g&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>x_
<span class="nb">declare</span><span class="w"> </span>--<span class="w"> </span><span class="nv">x_13</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nb">declare</span><span class="w"> </span>--<span class="w"> </span>x_15
</pre></div>
</div>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_substitute_empty_funcname">
<span class="sig-name descname"><span class="pre">bash_bug_substitute_empty_funcname</span></span><a class="headerlink" href="#var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_substitute_empty_funcname" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">FUNCNAME</span></code> is the only builtin array in bash that is likely to be declared but unset (when stack depth is zero). In bash 4.3 and 4.4, there is a bug where an using parameter expansion on <code class="docutils literal notranslate"><span class="pre">FUNCNAME</span></code> when unset will incorrectly expand (e.g. <code class="docutils literal notranslate"><span class="pre">${FUNCNAME[&#64;]+example}</span></code>). This could be due to funcname not really being empty in global scope, but just doesn’t show up as populated until in its first function scope</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Typing this into an interactive bash session will not show this bug. It has to be in a file that is sourced or run for this bug to show up.</p>
</div>
<dl class="bash var">
<dt class="sig sig-object bash" id="var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_ifs_array_slice_expansion">
<span class="sig-name descname"><span class="pre">bash_bug_ifs_array_slice_expansion</span></span><a class="headerlink" href="#var-compat.bsh __bash_bug_at_expansion_null_ifs bash_bug_ifs_array_slice_expansion" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>In some versions of bash (3.2 is the only known version), <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> expanding an array and slicing it when IFS is not space will fail to expand into multiple arguments.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Bug present</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Not bugged</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nv">x</span><span class="o">=(</span><span class="m">11</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">33</span><span class="w"> </span><span class="m">44</span><span class="o">)</span>
$<span class="w"> </span><span class="nv">IFS</span><span class="o">=</span>x
$<span class="w"> </span><span class="nv">z</span><span class="o">=(</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">x</span><span class="p">[@]:</span><span class="nv">2</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span>
<span class="c1"># @ expansion should be unaffected by IFS, unlike * expansion</span>
<span class="nb">declare</span><span class="w"> </span>-a<span class="w"> </span><span class="nv">z</span><span class="o">=</span><span class="s1">&#39;([0]=&quot;33 44&quot;)&#39;</span><span class="w">       </span><span class="c1"># Wrong</span>
<span class="nb">declare</span><span class="w"> </span>-a<span class="w"> </span><span class="nv">z</span><span class="o">=</span><span class="s1">&#39;([0]=&quot;33&quot; [1]=&quot;44&quot;)&#39;</span><span class="w"> </span><span class="c1"># Right</span>
</pre></div>
</div>
</section>
</section>
<section id="git">
<h2>Git<a class="headerlink" href="#git" title="Permalink to this heading"></a></h2>
<p>The following variables will help cope with the difference in git versions as seamlessly as possible.</p>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh git_bug_submodule_path_with_special_characters">
<span class="sig-name descname"><span class="pre">git_bug_submodule_path_with_special_characters</span></span><a class="headerlink" href="#function-compat.bsh git_bug_submodule_path_with_special_characters" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>There is a bug in git, fixed in git 1.8.3.3, that caused many <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span></code> operations not to work on a submodule at a path whose name contains a tab or ” (double quote) (and presumably other characters). See the fourth entry in <a class="reference external" href="https://github.com/git/git/blob/master/Documentation/RelNotes/1.8.3.3.txt">Fixes since v1.8.3.2</a> (I think).</p>
<dl class="field-list simple">
<dt class="field-odd">Return Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - <code class="docutils literal notranslate"><span class="pre">git</span></code> does not support submodule paths containing special characters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - <code class="docutils literal notranslate"><span class="pre">git</span></code> works as expected</p></li>
</ul>
</dd>
</dl>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh git_feature_support_tls">
<span class="sig-name descname"><span class="pre">git_feature_support_tls</span></span><a class="headerlink" href="#function-compat.bsh git_feature_support_tls" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Parts of git (e.g. git-remote-http) link to libcurl, so the version of TLS it can support depends on what is in the OS</p>
<dl class="field-list simple">
<dt class="field-odd">Return Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Supports TLS Version 1.0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Supports TLS Version 1.1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code> - Supports TLS Version 1.2</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3</span></code> - Supports TLS Version 1.3 (Not testable yet)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">125</span></code> - Unable to determine</p></li>
</ul>
</dd>
</dl>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh git_feature_submodule_update_with_custom_command">
<span class="sig-name descname"><span class="pre">git_feature_submodule_update_with_custom_command</span></span><a class="headerlink" href="#function-compat.bsh git_feature_submodule_update_with_custom_command" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>In Git 1.8.4, support was added to <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">update</span></code> to run a custom command via the config key submodule.&lt;name&gt;.update. See the 11th entry in <a class="reference external" href="https://github.com/git/git/blob/master/Documentation/RelNotes/1.8.4.txt#L86">UI, Workflows &amp; Features</a></p>
<dl class="field-list simple">
<dt class="field-odd">Return Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Supports submodule updates with a custom command</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Does not support submodule updates with a custom command</p></li>
</ul>
</dd>
</dl>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh git_feature_cli_config_option">
<span class="sig-name descname"><span class="pre">git_feature_cli_config_option</span></span><a class="headerlink" href="#function-compat.bsh git_feature_cli_config_option" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>In Git 1.8.2, the “-c name=value” option was added to <code class="docutils literal notranslate"><span class="pre">git</span></code> to override configuration variable from the command line. See the seventh entry in <a class="reference external" href="https://github.com/git/git/blob/master/Documentation/RelNotes/1.7.2.txt#L34">Updates since v1.7.1</a></p>
<dl class="field-list simple">
<dt class="field-odd">Return Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - Supports the -c option</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - Does not support the -c option</p></li>
</ul>
</dd>
</dl>
</section>
<section id="tar">
<h2>Tar<a class="headerlink" href="#tar" title="Permalink to this heading"></a></h2>
<p>The following variables will help cope with the difference in tar versions as seamlessly as possible.</p>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh tar_feature_incremental_backup">
<span class="sig-name descname"><span class="pre">tar_feature_incremental_backup</span></span><a class="headerlink" href="#function-compat.bsh tar_feature_incremental_backup" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>BSD versions of <code class="docutils literal notranslate"><span class="pre">tar</span></code> do not support incremental backups.</p>
<dl class="field-list simple">
<dt class="field-odd">Return Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - <code class="docutils literal notranslate"><span class="pre">tar</span></code> supports incremental backups</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - <code class="docutils literal notranslate"><span class="pre">tar</span></code> does not support incremental backups</p></li>
</ul>
</dd>
</dl>
</section>
<section id="readlink">
<h2>readlink<a class="headerlink" href="#readlink" title="Permalink to this heading"></a></h2>
<p>The following variables will help cope with the difference in readlink versions as seamlessly as possible.</p>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh readlink_behavior_nonexistent_path">
<span class="sig-name descname"><span class="pre">readlink_behavior_nonexistent_path</span></span><a class="headerlink" href="#function-compat.bsh readlink_behavior_nonexistent_path" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Darwin versions of <code class="docutils literal notranslate"><span class="pre">readlink</span></code> refuse to work when part of the path does not exist.</p>
<dl class="field-list simple">
<dt class="field-odd">Return Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - <code class="docutils literal notranslate"><span class="pre">readlink</span></code> supports non-existing paths</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - <code class="docutils literal notranslate"><span class="pre">readlink</span></code> does not support non-existing paths</p></li>
</ul>
</dd>
</dl>
</section>
<section id="realpath">
<h2>realpath<a class="headerlink" href="#realpath" title="Permalink to this heading"></a></h2>
<p>The following variables will help cope with the difference in realpath versions as seamlessly as possible.</p>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh readpath_behavior_nonexistent_path">
<span class="sig-name descname"><span class="pre">readpath_behavior_nonexistent_path</span></span><a class="headerlink" href="#function-compat.bsh readpath_behavior_nonexistent_path" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Darwin versions of <code class="docutils literal notranslate"><span class="pre">readpath</span></code> refuse to work when part of the path does not exist.</p>
<dl class="field-list simple">
<dt class="field-odd">Return Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - <code class="docutils literal notranslate"><span class="pre">readpath</span></code> supports non-existing paths</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - <code class="docutils literal notranslate"><span class="pre">readpath</span></code> does not support non-existing paths</p></li>
</ul>
</dd>
</dl>
</section>
<section id="singularity">
<h2>singularity<a class="headerlink" href="#singularity" title="Permalink to this heading"></a></h2>
<p>The following variables will help cope with the difference in singularity versions as seamlessly as possible.</p>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh singularity_feature_nvccli">
<span class="sig-name descname"><span class="pre">singularity_feature_nvccli</span></span><a class="headerlink" href="#function-compat.bsh singularity_feature_nvccli" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Determines if singularity has the nvccli flag feature. This does not guarantee nvidia-container-cli_path is set in singularity.conf</p>
<dl class="field-list simple">
<dt class="field-odd">Return Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - <code class="docutils literal notranslate"><span class="pre">singularity</span></code> supports the –nvccli feature</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - <code class="docutils literal notranslate"><span class="pre">singularity</span></code> does not support the –nvccli feature</p></li>
</ul>
</dd>
</dl>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh singularity_feature_nvccli_wsl2_gpu">
<span class="sig-name descname"><span class="pre">singularity_feature_nvccli_wsl2_gpu</span></span><a class="headerlink" href="#function-compat.bsh singularity_feature_nvccli_wsl2_gpu" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Determines if the singularity <code class="docutils literal notranslate"><span class="pre">--nvccli</span></code> flag supports WSL2 GPUs. This does not guarantee <code class="docutils literal notranslate"><span class="pre">nvidia-container-cli_path</span></code> is set in <code class="docutils literal notranslate"><span class="pre">singularity.conf</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Return Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - <code class="docutils literal notranslate"><span class="pre">singularity</span></code> <code class="docutils literal notranslate"><span class="pre">--nvccli</span></code> supports WSL2 GPUs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - <code class="docutils literal notranslate"><span class="pre">singularity</span></code> does not support WSL2 GPUS</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#function-compat.bsh singularity_bug_writable_tmpfs_without_root"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">singularity_bug_writable_tmpfs_without_root</span></code></a>:</dt><dd><p>While WSL2 GPUs may work, this bug may prevent WSL from running successfully without root</p>
</dd>
</dl>
</div>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-compat.bsh singularity_bug_writable_tmpfs_without_root">
<span class="sig-name descname"><span class="pre">singularity_bug_writable_tmpfs_without_root</span></span><a class="headerlink" href="#function-compat.bsh singularity_bug_writable_tmpfs_without_root" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>In Apptainer 1.1.0, they stared using <code class="docutils literal notranslate"><span class="pre">fuse-overlay</span></code> filesystems for non-root users. This introduced a bug that made using <code class="docutils literal notranslate"><span class="pre">--writable-tmpfs</span></code> as non-root error out (at least on WSL). This was fixed finally in 1.1.3. Singularity-CE is unaffected by this bug, as they only ever use <code class="docutils literal notranslate"><span class="pre">overlay</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Value<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> Apptainer has the bug</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> Singularity works as expected</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference external" href="https://github.com/apptainer/apptainer/blob/main/CHANGELOG.md#v113---2022-10-25">Apptainer bug</a></dt><dd><p>Avoid failures with <code class="docutils literal notranslate"><span class="pre">--writable-tmpfs</span></code> in non-setuid mode when using fuse-overlayfs versions 1.8 or greater by adding the fuse-overlayfs noacl mount option to disable support for POSIX Access Control Lists.</p>
</dd>
</dl>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="common_source.auto.html" class="btn btn-neutral float-left" title="Common Source" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="compat_singularity.auto.html" class="btn btn-neutral float-right" title="Singularity Compatibility Variables" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Vision Systems, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>