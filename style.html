

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Contributing Style Guide &mdash; VSI Common 0.2.2+1dev documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Get Pipenv" href="docker/recipes/get-pipenv.auto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> VSI Common
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="just/index.html">J.U.S.T. Useful Simple Tasking</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux/index.html">Linux Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="windows/index.html">Windows Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/index.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="python/modules.html">vsi</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker/recipes/get-pipenv.auto.html">Get Pipenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker/recipes/index.html">Docker recipes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Contributing Style Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#bash">Bash</a></li>
<li class="toctree-l2"><a class="reference internal" href="#python">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="#j-u-s-t-plugins">J.U.S.T. Plugins</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">VSI Common</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Contributing Style Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/style.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="contributing-style-guide">
<h1>Contributing Style Guide<a class="headerlink" href="#contributing-style-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="bash">
<h2>Bash<a class="headerlink" href="#bash" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Two spaces per indent</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">then</span></code> and <code class="docutils literal notranslate"><span class="pre">do</span></code> on the same line</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> x in <span class="k">$(</span>ls<span class="k">)</span><span class="p">;</span> <span class="k">do</span>
  :
<span class="k">done</span>

<span class="k">while</span> check_something<span class="p">;</span> <span class="k">do</span>
  :
<span class="k">done</span>
</pre></div>
</div>
</li>
</ul>
<p>We like to use <cite>&gt;&amp;</cite> for file descriptors (numbers), and <cite>&amp;&gt;</cite> for filenames</p>
<ul>
<li><p>Redirecting to open file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> hi <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span> <span class="c1"># No extra spaces, as bash doesn&#39;t allow that</span>

<span class="nb">echo</span> bye &gt;<span class="p">&amp;</span><span class="m">2</span> <span class="c1"># No extra spaces</span>
</pre></div>
</div>
</li>
<li><p>Closing an open file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">exec</span> <span class="m">3</span>&gt;<span class="p">&amp;</span>-

<span class="nb">exec</span> <span class="m">3</span><span class="p">&amp;</span>&gt;- <span class="c1"># WRONG style. This is dealing with descriptors</span>
</pre></div>
</div>
</li>
<li><p>Redirecting to a file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>run_some_command <span class="p">&amp;</span>&gt; /dev/null <span class="c1"># Spaces added around &amp;&gt;</span>

run_some_command &gt;<span class="p">&amp;</span> /dev/null <span class="c1"># WRONG style. This is dealing with filenames</span>
</pre></div>
</div>
</li>
<li><p>Always quote variables</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">avar</span><span class="o">=</span>foo
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nb">echo</span> <span class="si">${</span><span class="nv">avar</span><span class="si">}</span> <span class="c1"># WRONG style. It is safer to always quote the variable,</span>
             <span class="c1"># even if it is not strictly necessary</span>
</pre></div>
</div>
</li>
<li><p>Prefer <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code> tests to the <code class="docutils literal notranslate"><span class="pre">[[</span> <span class="pre">]]</span></code> construct and = to ==</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;foo bar&quot;</span> <span class="o">]</span>  <span class="c1"># Variables are always quoted in [] tests</span>

<span class="o">[[</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;foo bar&quot;</span> <span class="o">]]</span> <span class="c1"># WRONG style. Use []</span>

<span class="o">[[</span> <span class="si">${</span><span class="nv">avar</span><span class="si">}</span> <span class="o">=</span> foobar* <span class="o">]]</span> <span class="c1"># Ok. Pattern matching is not possible with []</span>

<span class="o">[[</span> <span class="si">${</span><span class="nv">avar</span><span class="si">}</span> <span class="o">=</span> <span class="s2">&quot;foo bar&quot;</span>* <span class="o">]]</span> <span class="c1"># WRONG style. If quotes are needed, use a variable</span>
<span class="nv">pattern</span><span class="o">=</span><span class="s2">&quot;foo bar*&quot;</span>
<span class="o">[[</span> <span class="si">${</span><span class="nv">avar</span><span class="si">}</span> <span class="o">=</span> <span class="si">${</span><span class="nv">pattern</span><span class="si">}</span> <span class="o">]]</span> <span class="c1"># Ok. Also, never quote variables in [[ ]] as</span>
                           <span class="c1"># this disables pattern matching---in which case,</span>
                           <span class="c1"># [] can be used instead</span>

<span class="o">[[</span> <span class="si">${</span><span class="nv">avar</span><span class="si">}</span> <span class="o">=</span>~ foobar.+ <span class="o">]]</span>  <span class="c1"># Ok. Regex&#39;s are not possible with []</span>

<span class="o">[[</span> <span class="si">${</span><span class="nv">avar</span><span class="si">}</span> <span class="o">=</span>~ <span class="s2">&quot;foo bar&quot;</span>.+ <span class="o">]]</span> <span class="c1"># WRONG style. If quotes are needed, use a variable</span>
<span class="nv">pattern</span><span class="o">=</span><span class="s1">&#39;foo bar.+&#39;</span>
<span class="o">[[</span> <span class="si">${</span><span class="nv">avar</span><span class="si">}</span> <span class="o">=</span>~ <span class="si">${</span><span class="nv">pattern</span><span class="si">}</span> <span class="o">]]</span>  <span class="c1"># Ok. Again, don&#39;t quote variables in [[ ]]</span>
</pre></div>
</div>
</li>
<li><p>Checking to see if a variable exists</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="si">${</span><span class="nv">variable</span><span class="p">+set</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="c1"># If not set</span>
  do_something
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;</span><span class="si">${</span><span class="nv">variable</span><span class="p">+set</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="c1"># If set</span>
  do_something
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="si">${</span><span class="nv">variable</span><span class="p">:+set</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="c1"># If not set OR set to null</span>
  do_something
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;</span><span class="si">${</span><span class="nv">variable</span><span class="p">:+set</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="c1"># If set AND not null</span>
  do_something
<span class="k">fi</span>
</pre></div>
</div>
</li>
<li><p>Checking to see if an array exists before accessing it</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">arr</span><span class="o">=(</span><span class="si">${</span><span class="nv">foo</span><span class="p">+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">foo</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="o">)</span> <span class="c1"># WRONG</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">arr</span></code> will be empty if the first element of <code class="docutils literal notranslate"><span class="pre">foo</span></code> (<code class="docutils literal notranslate"><span class="pre">&quot;${foo[0]}&quot;</span></code>) doesn’t exist. Unless this is desired, instead use</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="si">${</span><span class="nv">foo</span><span class="p">[@]+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">foo</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
<span class="si">${</span><span class="nv">foo</span><span class="p">[@]+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">!foo[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
<span class="si">${</span><span class="nv">foo</span><span class="p">[@]+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">foo</span><span class="p">[*]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
</pre></div>
</div>
</li>
<li><p>Scripting file naming and shebangs</p>
<ul>
<li><p>Files that are only meant to be sourced should have a <code class="docutils literal notranslate"><span class="pre">.bsh</span></code> extension, and should have the following header:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env false bash</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$-</span> !<span class="o">=</span> *i* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  source_once <span class="p">&amp;</span>&gt; /dev/null <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
<span class="k">fi</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> signifies this file is for sourcing only. The <code class="docutils literal notranslate"><span class="pre">bash</span></code> at the end of the line tricks most editors into parsing the file as bash.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source_once</span></code> is a component that will cause the file to only be sourced one time, even if other files attempt to source the file multiple times. This improves load time and debugging as the same files are not loaded multiple times. See <code class="file docutils literal notranslate"><span class="pre">source_once.bsh</span></code> for more information</p></li>
</ul>
</li>
<li><p>Some files need to retain <code class="docutils literal notranslate"><span class="pre">sh</span></code> compatibility, and should have a <code class="docutils literal notranslate"><span class="pre">.sh</span></code> extension instead</p></li>
<li><p>Files that should be run as executable, should have 755 permissions and the following shebang:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
</pre></div>
</div>
</li>
<li><p>Files that can be sourced or executed should follow the same rules as executable scripts in addition to:</p>
<ul>
<li><p>Most of the code should be contained in functions</p></li>
<li><p>The main function should have the same name as the file</p></li>
<li><p>The following footer should be used:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">0</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="k">$(</span>basename <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">0</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  the_main_function_name <span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="nb">exit</span> <span class="nv">$?</span>
<span class="k">fi</span>
</pre></div>
</div>
<ul class="simple">
<li><p>This will only execute <code class="docutils literal notranslate"><span class="pre">the_main_function_name</span></code> when the script is being called, not sourced.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Circular imports</strong>: While <a class="reference internal" href="linux/source_once.auto.html#function-source_once.bsh source_once"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">source_once.bsh</span> <span class="pre">source_once</span></code></a> will prevent some circular source issues, this does not help in interactive mode. <a class="reference internal" href="linux/source_once.auto.html#function-source_once.bsh source_once"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">source_once.bsh</span> <span class="pre">source_once</span></code></a> is disabled in interactive mode because is someone changes a file, and sources it again, they should expect to get those changes, not have it “sourced only once ever” (it is also disabled for cnf speed reasons). Circular dependencies are handled using the <a class="reference internal" href="linux/circular_source.auto.html#function-circular_source.bsh circular_source"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">circular_source.bsh</span> <span class="pre">circular_source</span></code></a> function instead.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> something_normal.bsh
<span class="nb">source</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/circular_source.bsh&quot;</span>
circular_source <span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/docker_functions.bsh&quot;</span> <span class="o">||</span> <span class="k">return</span> <span class="m">0</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">||</span> <span class="pre">return</span> <span class="pre">0</span></code> makes it so that the current file is sourced the first time in the infinite loop, and stops the loop the second go around. Otherwise it might actually get sourced a total of two times, which is not detrimental but may have undesired effects (especially for CLI’s)</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Coverage: bashcov can be used to create a coverage report. In order to designation a section of code as “no coverage”, use <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">:nocov:</span></code> before and after the code you want to not be reported on. There are additional flags for that can be excluded on macos (<code class="docutils literal notranslate"><span class="pre">:nocov_mac:</span></code>), Linux (<code class="docutils literal notranslate"><span class="pre">:nocov_linux:</span></code>), and Windows (<code class="docutils literal notranslate"><span class="pre">:nocov_nt:</span></code>). You can also designate an area to not be covered based on the version of bash: <code class="docutils literal notranslate"><span class="pre">:nocov_bash_4.1:</span></code> for no coverage on bash 4.1 and newer, or <code class="docutils literal notranslate"><span class="pre">:nocov_lt_bash_4.4</span></code> for no coverage on bash 4.4 and older. Multiple flags may be combined, where <code class="docutils literal notranslate"><span class="pre">:nocov_nt:</span> <span class="pre">:nocov_bash_4.0:</span></code> means no coverage on windows OR bash 4.0 or newer.</p></li>
</ul>
</div>
<div class="section" id="python">
<h2>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>We use pep8, except two spaces per indent</p></li>
<li><p>(Not yet implemented) Coverage: pycoverage is used to create a coverage report. A line or branch of code can be excluded by adding a comment that includes <code class="docutils literal notranslate"><span class="pre">pragma:</span> <span class="pre">no</span> <span class="pre">cover</span></code>. An os specific pragma can be added, such as <code class="docutils literal notranslate"><span class="pre">pragma:</span> <span class="pre">no</span> <span class="pre">linux</span> <span class="pre">cover</span></code> for only on Windows, or <code class="docutils literal notranslate"><span class="pre">pragma:</span> <span class="pre">no</span> <span class="pre">nt</span> <span class="pre">cover</span></code> for only on mac and linux.</p></li>
</ul>
</div>
<div class="section" id="j-u-s-t-plugins">
<h2>J.U.S.T. Plugins<a class="headerlink" href="#j-u-s-t-plugins" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Just plugins that use docker-compose should specify the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file with every command, to prevent unintended consequences in case the user sets <code class="docutils literal notranslate"><span class="pre">COMPOSE_FILE</span></code></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="docker/recipes/get-pipenv.auto.html" class="btn btn-neutral float-left" title="Get Pipenv" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Vision Systems, Inc

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>