<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contributing Style Guide &mdash; VSI Common 0.2.2+1dev documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="pip opencv" href="docker/recipes/pip-opencv.auto.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            VSI Common
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="just/index.html">J.U.S.T. Useful Simple Tasking</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux/index.html">Linux Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="windows/index.html">Windows Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/index.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="python/modules.html">vsi</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker/recipes/get-pipenv.auto.html">Get Pipenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker/recipes/pip-8210.auto.html">pip 8210</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker/recipes/pip-opencv.auto.html">pip opencv</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker/recipes/index.html">Docker recipes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Contributing Style Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#bash">Bash</a></li>
<li class="toctree-l2"><a class="reference internal" href="#python">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="#j-u-s-t-plugins">J.U.S.T. Plugins</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">VSI Common</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Contributing Style Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/style.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="contributing-style-guide">
<h1>Contributing Style Guide<a class="headerlink" href="#contributing-style-guide" title="Permalink to this heading"></a></h1>
<section id="bash">
<h2>Bash<a class="headerlink" href="#bash" title="Permalink to this heading"></a></h2>
<ul>
<li><p>Two spaces per indent</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">then</span></code> and <code class="docutils literal notranslate"><span class="pre">do</span></code> on the same line</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span>x<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>ls<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span>:
<span class="k">done</span>

<span class="k">while</span><span class="w"> </span>check_something<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span>:
<span class="k">done</span>
</pre></div>
</div>
</li>
</ul>
<p>We like to use <cite>&gt;&amp;</cite> for file descriptors (numbers), and <cite>&amp;&gt;</cite> for filenames</p>
<ul>
<li><p>Redirecting to open file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span>hi<span class="w"> </span><span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="c1"># No extra spaces, as bash doesn&#39;t allow that</span>

<span class="nb">echo</span><span class="w"> </span>bye<span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="c1"># No extra spaces</span>
</pre></div>
</div>
</li>
<li><p>Closing an open file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">exec</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span>-

<span class="nb">exec</span><span class="w"> </span><span class="m">3</span><span class="p">&amp;</span>&gt;-<span class="w"> </span><span class="c1"># Wrong style. This is dealing with descriptors</span>
</pre></div>
</div>
</li>
<li><p>Redirecting to a file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>run_some_command<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="c1"># Spaces added around &amp;&gt;</span>

run_some_command<span class="w"> </span>&gt;<span class="p">&amp;</span><span class="w"> </span>/dev/null<span class="w"> </span><span class="c1"># Wrong style. This is dealing with filenames</span>
</pre></div>
</div>
</li>
<li><p>Always quote variables and complex strings</p>
<p>There are many conditions when you need to use quotes, very few when you need to not, and many when quotes seem optional. Always using quotes (aside from the few exceptions mentioned below) vastly reduces the chance of errors from unexpected (and erroneous) input and simplifies remembering when you do and don’t need quotes</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">bvar</span><span class="o">=</span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="w">   </span><span class="c1"># Wrong style. Always add quotes</span>
<span class="nv">bvar</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="c1"># Right</span>
<span class="nv">cvar</span><span class="o">=</span>foo<span class="w"> </span>bar<span class="w">   </span><span class="c1"># Wrong style and syntax. This is a complex string, and requires quotes</span>
<span class="w">               </span><span class="c1"># This actually executes a command called bar. Instead, make it clear:</span>
<span class="nv">cvar</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="w"> </span>bar<span class="w"> </span><span class="c1"># Right if you want to execute a command called bar</span>
<span class="nv">cvar</span><span class="o">=</span><span class="s2">&quot;foo bar&quot;</span><span class="w"> </span><span class="c1"># Right if bar is part of the string</span>
<span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="w">   </span><span class="c1"># Wrong style. Variables may contain whitespace that would be messed up</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="c1"># Right</span>

<span class="c1"># There are a few reason to not quote a variable. Be sure to add a &quot;# noquotes&quot;</span>
<span class="c1"># comment so code reviewers knows these are intended:</span>

<span class="c1"># One is an empty variable that should not be treated as an empty string</span>
<span class="c1"># E.g., DRYRUN could be &quot;echo&quot; or empty string</span>
<span class="si">${</span><span class="nv">DRYRUN</span><span class="si">}</span><span class="w"> </span>some<span class="w"> </span><span class="nb">command</span><span class="w"> </span><span class="c1"># noquotes</span>
<span class="c1"># E.g., optional_flag could be &quot;-stuff&quot; or empty string</span>
some_command<span class="w"> </span><span class="si">${</span><span class="nv">optional_flag</span><span class="si">}</span><span class="w"> </span>foo<span class="w"> </span>bar<span class="w"> </span><span class="c1"># noquotes</span>
<span class="c1"># The preferred way is to use arrays, if it is not overly cumbersome.</span>
<span class="si">${</span><span class="nv">DRYRUN</span><span class="p">[@]+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DRYRUN</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="w"> </span>some<span class="w"> </span><span class="nb">command</span>
some_command<span class="w"> </span><span class="si">${</span><span class="nv">optional_flag</span><span class="p">[@]+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">optional_flag</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="w"> </span>foo<span class="w"> </span>bar
<span class="c1"># Although because arrays cannot be exported, this is often not viable.</span>

<span class="c1"># Another reason quotes must not be used is when splitting up a string into an array</span>
<span class="nv">foo</span><span class="o">=</span><span class="s2">&quot;aa:bb:cc:dd&quot;</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;:&quot;</span>
<span class="c1"># This is actively splitting apart a string, and must not be in quotes</span>
<span class="nv">bar</span><span class="o">=(</span><span class="si">${</span><span class="nv">foo</span><span class="si">}</span><span class="o">)</span><span class="w"> </span><span class="c1"># noquotes</span>
</pre></div>
</div>
<p>Quotes should not be used on the LHS in <code class="docutils literal notranslate"><span class="pre">[[]]</span></code> expressions—there are a few corner cases where the quotes will be treated literally. <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">noquotes</span></code> is not needed for <code class="docutils literal notranslate"><span class="pre">[[]]</span></code> expressions. The RHS should use quotes for literal strings, and no quotes for wildcard or regex patterns.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">var</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">foo</span><span class="si">}</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span><span class="si">${</span><span class="nv">pattern</span><span class="si">}</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;hi&quot;</span>
<span class="k">fi</span>
</pre></div>
</div>
<p>Simple assignments _may_ skip quotes, <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">noquotes</span></code> is not needed as this is easy enough for a code reviewer to see</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">local</span><span class="w"> </span><span class="nv">a</span><span class="o">=</span><span class="m">1</span>
<span class="nv">b</span><span class="o">=</span><span class="m">2</span>
<span class="nv">x</span><span class="o">=(</span><span class="m">11</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">33</span><span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="s2">&quot;5 5&quot;</span><span class="w"> </span><span class="s2">&quot;6  6&quot;</span><span class="o">)</span>
<span class="nv">cvar</span><span class="o">=</span>foo
<span class="nv">dvar</span><span class="o">=</span>foo<span class="se">\ </span>bar<span class="w">  </span><span class="c1"># Wrong style. This is no longer simple. Use quotes</span>
<span class="nv">dvar</span><span class="o">=</span><span class="s2">&quot;foo bar&quot;</span><span class="w"> </span><span class="c1"># Right</span>
</pre></div>
</div>
<p>It is best not to use quotes when inside of <code class="docutils literal notranslate"><span class="pre">{}</span></code>. The expressions inside of <code class="docutils literal notranslate"><span class="pre">{}</span></code> can be thought of as already being implicitly quoted (<code class="docutils literal notranslate"><span class="pre">&quot;</span></code>). Adding quotes (<code class="docutils literal notranslate"><span class="pre">'</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;</span></code>) may seem to work at first, but the behavior of explicitly quoting will change between the different versions of bash.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">foo</span><span class="p">-</span><span class="s2">&quot;b a  r&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="w">        </span><span class="c1"># Wrong style</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">foo</span><span class="p">-b a  r</span><span class="si">}</span><span class="s2">&quot;</span><span class="w">          </span><span class="c1"># Right</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">foo</span><span class="p">/</span><span class="s2">&quot;o&quot;</span><span class="p">/</span><span class="s2">&quot;O&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="w">         </span><span class="c1"># Wrong style</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">foo</span><span class="p">/o/O</span><span class="si">}</span><span class="s2">&quot;</span><span class="w">             </span><span class="c1"># Right</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">foo</span><span class="p">/</span><span class="s2">&quot;  &quot;</span><span class="p">/two spaces</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="c1"># Wrong style</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">foo</span><span class="p">/  /two spaces</span><span class="si">}</span><span class="s2">&quot;</span><span class="w">   </span><span class="c1"># Right</span>
</pre></div>
</div>
<p><a class="reference internal" href="linux/compat.auto.html#function-compat.bsh bash_behavior_pattern_substitution_slash_escape_with_single_quote"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">compat.bsh</span> <span class="pre">bash_behavior_pattern_substitution_slash_escape_with_single_quote</span></code></a> is a special case that still needs special care, due to differences in bash behavior between versions.</p>
</li>
<li><p>Always use ${var} vs $var</p>
<p>The reason for this policy is consistency and to clarify that certain features in bash only work in the <code class="docutils literal notranslate"><span class="pre">{}</span></code>, e.g. variable substitution. It’s very easy for someone to mistake <code class="docutils literal notranslate"><span class="pre">$foo+set</span></code> for <code class="docutils literal notranslate"><span class="pre">${foo}+set</span></code> and not <code class="docutils literal notranslate"><span class="pre">${foo+set}</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PATH</span><span class="s2">&quot;</span><span class="w">                   </span><span class="c1"># Wrong style</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="w">                 </span><span class="c1"># Right</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span>$<span class="si">}</span><span class="s2">&quot;</span><span class="w">                    </span><span class="c1"># Right</span>
<span class="c1"># Built-ins * and @ need some extra care so that set -eu doesn&#39;t error on empty in bash 3.2</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="p">-</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="p">?</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="p">*-</span><span class="si">}</span><span class="s2">&quot;</span><span class="w">         </span><span class="c1"># Right</span>
run<span class="w"> </span><span class="nb">command</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">_</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="si">${</span><span class="p">@+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="w"> </span><span class="c1"># Right</span>
</pre></div>
</div>
</li>
<li><p>Shorthand for arithmetic expressions</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">x</span><span class="o">=(</span><span class="m">11</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">33</span><span class="w"> </span><span class="m">44</span><span class="o">)</span>
<span class="nv">y</span><span class="o">=</span><span class="m">2</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">x</span><span class="p">[y]</span><span class="si">}</span><span class="s2"> is perfectly acceptable&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">x</span><span class="p">[</span><span class="nv">$y</span><span class="p">]</span><span class="si">}</span><span class="s2"> violates the {} policy, even though it is valid bash&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">x</span><span class="p">[</span><span class="si">${</span><span class="nv">y</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2"> is ok too, but the shorthand looks better&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$((</span><span class="nv">x</span><span class="o">[</span><span class="nv">y</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">y</span><span class="k">))</span><span class="s2"> is also perfectly acceptable&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">x</span><span class="p">:</span><span class="nv">1</span><span class="p">:</span><span class="nv">y</span><span class="si">}</span><span class="s2"> is also perfectly acceptable&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">x</span><span class="p">:</span><span class="nv">1</span><span class="p">:</span><span class="nv">y</span><span class="p">+1</span><span class="si">}</span><span class="s2"> is also perfectly acceptable&quot;</span>

<span class="c1"># Do no add quotes to inner expressions</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">x</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="nv">x</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="c1"># Wrong style</span>

<span class="c1"># Associative arrays are not bash 3.2 compatible, and are not</span>
<span class="c1"># arithmetic expressions in []</span>
<span class="nb">declare</span><span class="w"> </span>-A<span class="w"> </span>z
<span class="nv">y</span><span class="o">=</span><span class="m">2</span>
z<span class="o">[</span>y<span class="o">]=</span><span class="s2">&quot;This is index y not 2&quot;</span>
z<span class="o">[</span><span class="nv">$y</span><span class="o">]=</span><span class="s2">&quot;This is index 2&quot;</span><span class="w"> </span><span class="c1"># Wrong style, violates the {} policy</span>
z<span class="o">[</span><span class="si">${</span><span class="nv">y</span><span class="si">}</span><span class="o">]=</span><span class="s2">&quot;This is index 2&quot;</span>
z<span class="o">[</span><span class="si">${</span><span class="nv">y</span><span class="si">}</span>-1<span class="o">]=</span><span class="s2">&quot;This is index &#39;2-1&#39;, not 1&quot;</span>
z<span class="o">[</span><span class="k">$((</span><span class="nv">y</span><span class="o">-</span><span class="m">1</span><span class="k">))</span><span class="o">]=</span><span class="s2">&quot;This is index 1&quot;</span>
</pre></div>
</div>
</li>
<li><p>Prefer <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code> tests to the <code class="docutils literal notranslate"><span class="pre">[[</span> <span class="pre">]]</span></code> construct, prefer <code class="docutils literal notranslate"><span class="pre">=</span></code> to <code class="docutils literal notranslate"><span class="pre">==</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;foo bar&quot;</span><span class="w"> </span><span class="o">]</span><span class="w">      </span><span class="c1"># Variables are always quoted in [] tests</span>

<span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;foo bar&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w">     </span><span class="c1"># Wrong style. Use [] and = for normal equality</span>

<span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>foobar*<span class="w"> </span><span class="o">]]</span><span class="w">        </span><span class="c1"># Right. Pattern matching is not possible with []</span>

<span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;foo bar&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="w">     </span><span class="c1"># Right. If quotes are needed, you can use a variable</span>
<span class="nv">pattern</span><span class="o">=</span><span class="s2">&quot;foo bar*&quot;</span>
<span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="si">${</span><span class="nv">pattern</span><span class="si">}</span><span class="w"> </span><span class="o">]]</span><span class="w">     </span><span class="c1"># Ok. Never quote patterned variables in [[ ]] as</span>
<span class="w">                               </span><span class="c1"># this disables pattern matching---in which case,</span>
<span class="w">                               </span><span class="c1"># [] can be used instead</span>
If<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>mixing<span class="w"> </span>literal<span class="w"> </span>and<span class="w"> </span>wild<span class="w"> </span>cards,<span class="w"> </span>you<span class="w"> </span>will<span class="w"> </span>use<span class="w"> </span>quotes
<span class="nv">avar</span><span class="o">=</span><span class="s2">&quot;foo*bar&quot;</span>
<span class="nv">pattern</span><span class="o">=</span><span class="s2">&quot;foo*b&quot;</span>
<span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">pattern</span><span class="si">}</span><span class="s2">&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="w">  </span><span class="c1"># If you want the pattern to refer to a literal asterisk, you need these quotes.</span>
<span class="o">[[</span><span class="w"> </span>foo-bar<span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="si">${</span><span class="nv">pattern</span><span class="si">}</span>*<span class="w"> </span><span class="o">]]</span><span class="w">   </span><span class="c1"># This would fail because the * in the pattern would be a wild card, not an *</span>

<span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>foobar.+<span class="w"> </span><span class="o">]]</span><span class="w">      </span><span class="c1"># Right. Regex&#39;s are not possible with []</span>

<span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span><span class="s2">&quot;foo bar&quot;</span>.+<span class="w"> </span><span class="o">]]</span><span class="w">   </span><span class="c1"># Right. If quotes are needed, you can use a variable</span>
<span class="nv">pattern</span><span class="o">=</span><span class="s1">&#39;foo bar.+&#39;</span>
<span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w">  </span><span class="c1"># Wrong, this disables regex matching</span>
<span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span><span class="si">${</span><span class="nv">pattern</span><span class="si">}</span><span class="w"> </span><span class="o">]]</span><span class="w">    </span><span class="c1"># Good. Don&#39;t quote variables in [[ ]]</span>
<span class="nv">pattern</span><span class="o">=</span><span class="s1">&#39;f\+ bar.+&#39;</span><span class="w">            </span><span class="c1"># The first + is an escaped literal +</span>
<span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">avar</span><span class="si">}</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span><span class="si">${</span><span class="nv">pattern</span><span class="si">}</span><span class="w"> </span><span class="o">]]</span><span class="w">    </span><span class="c1"># Good. Don&#39;t quote variables in [[ ]]</span>

<span class="o">[[</span><span class="w"> </span><span class="m">3</span><span class="w"> </span>&lt;<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">]]</span><span class="w">                    </span><span class="c1"># Wrong style</span>
<span class="o">[</span><span class="w"> </span><span class="s2">&quot;3&quot;</span><span class="w"> </span>-lt<span class="w"> </span><span class="s2">&quot;4&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w">               </span><span class="c1"># Right</span>

<span class="o">[[</span><span class="w"> </span><span class="m">3</span>.5<span class="w"> </span>&lt;<span class="w"> </span><span class="m">4</span>.0<span class="w"> </span><span class="o">]]</span><span class="w">                </span><span class="c1"># Wrong. Floating point comparison not possible with [], [[]] or (())</span>
<span class="k">if</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{if (3.5 &lt; 4.0) {exit 0} else {exit 1}}&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># Floating point is possible with awk</span>
</pre></div>
</div>
</li>
<li><p>Checking to see if a variable exists</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">variable</span><span class="p">+set</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># If not set</span>
<span class="w">  </span>do_something
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">variable</span><span class="p">+set</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># If set</span>
<span class="w">  </span>do_something
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">variable</span><span class="p">:+set</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># If not set OR set to null</span>
<span class="w">  </span>do_something
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">variable</span><span class="p">:+set</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># If set AND not null</span>
<span class="w">  </span>do_something
<span class="k">fi</span>

<span class="c1"># Arrays need a little extra syntactical sugar (the space is important for bash 3.2)</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot; &quot;&quot;</span><span class="si">${</span><span class="nv">myarray</span><span class="p">[@]+set</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># If not set</span>
<span class="w">  </span>do_something
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot; &quot;&quot;</span><span class="si">${</span><span class="nv">myarray</span><span class="p">[@]+set</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; set&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c1"># If set</span>
<span class="w">  </span>do_something
<span class="k">fi</span>
</pre></div>
</div>
</li>
<li><p>Checking to see if an array exists before accessing it</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">arr</span><span class="o">=(</span><span class="si">${</span><span class="nv">foo</span><span class="p">+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">foo</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="o">)</span><span class="w"> </span><span class="c1"># WRONG</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">arr</span></code> will be empty if the first element of <code class="docutils literal notranslate"><span class="pre">foo</span></code> (<code class="docutils literal notranslate"><span class="pre">&quot;${foo[0]}&quot;</span></code>) doesn’t exist. Unless this is desired, instead use</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="si">${</span><span class="nv">foo</span><span class="p">[@]+</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">foo</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
<span class="si">${</span><span class="nv">foo</span><span class="p">[@]+</span><span class="s2">&quot;</span><span class="si">${</span><span class="p">!foo[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">foo</span><span class="p">[*]+</span><span class="si">${</span><span class="nv">foo</span><span class="p">[*]</span><span class="si">}}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</li>
<li><p>Scripting file naming and shebangs</p>
<ul>
<li><p>Files that are only meant to be sourced should have a <code class="docutils literal notranslate"><span class="pre">.bsh</span></code> extension, and should have the following header:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env false bash</span>

<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="p">-</span><span class="si">}</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span>*i*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>source_once<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="k">fi</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> signifies this file is for sourcing only. The <code class="docutils literal notranslate"><span class="pre">bash</span></code> at the end of the line tricks most editors into parsing the file as bash.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source_once</span></code> is a component that will cause the file to only be sourced one time, even if other files attempt to source the file multiple times. This improves load time and debugging as the same files are not loaded multiple times. See <code class="file docutils literal notranslate"><span class="pre">source_once.bsh</span></code> for more information</p></li>
</ul>
</li>
<li><p>Some files need to retain <code class="docutils literal notranslate"><span class="pre">sh</span></code> compatibility, and should have a <code class="docutils literal notranslate"><span class="pre">.sh</span></code> extension instead</p></li>
<li><p>Files that should be run as executable, should have 755 permissions and the following shebang:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
</pre></div>
</div>
</li>
<li><p>Files that can be sourced or executed should follow the same rules as executable scripts in addition to:</p>
<ul>
<li><p>Most of the code should be contained in functions</p></li>
<li><p>The main function should have the same name as the file</p></li>
<li><p>The following footer should be used:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">0</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>basename<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">0</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>the_main_function_name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="p">@</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">  </span><span class="nb">exit</span><span class="w"> </span><span class="nv">$?</span>
<span class="k">fi</span>
</pre></div>
</div>
<ul class="simple">
<li><p>This will only execute <code class="docutils literal notranslate"><span class="pre">the_main_function_name</span></code> when the script is being called, not sourced.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Circular imports</strong>: While <a class="reference internal" href="linux/source_once.auto.html#function-source_once.bsh source_once"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">source_once.bsh</span> <span class="pre">source_once</span></code></a> will prevent some circular source issues, this does not help in interactive mode. <a class="reference internal" href="linux/source_once.auto.html#function-source_once.bsh source_once"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">source_once.bsh</span> <span class="pre">source_once</span></code></a> is disabled in interactive mode because is someone changes a file, and sources it again, they should expect to get those changes, not have it “sourced only once ever” (it is also disabled for cnf speed reasons). Circular dependencies are handled using the <a class="reference internal" href="linux/circular_source.auto.html#function-circular_source.bsh circular_source"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">circular_source.bsh</span> <span class="pre">circular_source</span></code></a> function instead.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>something_normal.bsh
<span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/circular_source.bsh&quot;</span>
circular_source<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VSI_COMMON_DIR</span><span class="si">}</span><span class="s2">/linux/docker_functions.bsh&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">||</span> <span class="pre">return</span> <span class="pre">0</span></code> makes it so that the current file is sourced the first time in the infinite loop, and stops the loop the second go around. Otherwise it might actually get sourced a total of two times, which is not detrimental but may have undesired effects (especially for CLI’s)</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Coverage: bashcov can be used to create a coverage report. In order to designation a section of code as “no coverage”, use <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">:nocov:</span></code> before and after the code you want to not be reported on. There are additional flags for that can be excluded on macos (<code class="docutils literal notranslate"><span class="pre">:nocov_mac:</span></code>), Linux (<code class="docutils literal notranslate"><span class="pre">:nocov_linux:</span></code>), and Windows (<code class="docutils literal notranslate"><span class="pre">:nocov_nt:</span></code>). You can also designate an area to not be covered based on the version of bash: <code class="docutils literal notranslate"><span class="pre">:nocov_bash_4.1:</span></code> for no coverage on bash 4.1 and newer, or <code class="docutils literal notranslate"><span class="pre">:nocov_lt_bash_4.4</span></code> for no coverage on bash 4.4 and older. Multiple flags may be combined, where <code class="docutils literal notranslate"><span class="pre">:nocov_nt:</span> <span class="pre">:nocov_bash_4.0:</span></code> means no coverage on windows OR bash 4.0 or newer.</p></li>
</ul>
</section>
<section id="python">
<h2>Python<a class="headerlink" href="#python" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>We use pep8, except two spaces per indent</p></li>
<li><p>(Not yet implemented) Coverage: pycoverage is used to create a coverage report. A line or branch of code can be excluded by adding a comment that includes <code class="docutils literal notranslate"><span class="pre">pragma:</span> <span class="pre">no</span> <span class="pre">cover</span></code>. An os specific pragma can be added, such as <code class="docutils literal notranslate"><span class="pre">pragma:</span> <span class="pre">no</span> <span class="pre">linux</span> <span class="pre">cover</span></code> for only on Windows, or <code class="docutils literal notranslate"><span class="pre">pragma:</span> <span class="pre">no</span> <span class="pre">nt</span> <span class="pre">cover</span></code> for only on mac and linux.</p></li>
</ul>
</section>
<section id="j-u-s-t-plugins">
<h2>J.U.S.T. Plugins<a class="headerlink" href="#j-u-s-t-plugins" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Just plugins that use docker compose should specify the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file with every command, to prevent unintended consequences in case the user sets <code class="docutils literal notranslate"><span class="pre">COMPOSE_FILE</span></code></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="docker/recipes/pip-opencv.auto.html" class="btn btn-neutral float-left" title="pip opencv" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Vision Systems, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>